# robo_chat/robo_brain.py

from datetime import datetime

class RoboAdvisor:
    def __init__(self, user_profile, alerts_today):
        self.user = user_profile
        self.alerts = alerts_today

    def answer(self, question: str) -> str:
        package = self.user.get("package", "ูุฌุงููุฉ")
        city = self.user.get("city")

        # ๐ข ุงูุจุงูุฉ ุงููุฌุงููุฉ
        if package == "ูุฌุงููุฉ":
            return self._basic_answer(question)

        # ๐ต ุงููุถูุฉ + ุงูุฐูุจูุฉ
        if package in ["ูุถูุฉ", "ุฐูุจูุฉ"]:
            return self._advanced_answer(question)

        # ๐ฃ ุงููุงุณูุฉ
        if package == "ูุงุณูุฉ":
            return self._diamond_answer(question, city)

        # ๐ ุงููุงุณูุฉ ุงููุชููุฒุฉ
        if package == "ูุงุณูุฉ ูุชููุฒุฉ":
            return self._premium_answer(question, city)

        return "ุณุคุงูู ุบูุฑ ูุงุถุญุ ูู ูููู ุชูุถูุญู ุจุดูู ุฃุฏูุ"

    # ===== ุฃููุงุน ุงูุฑุฏูุฏ =====

    def _basic_answer(self, question):
        return (
            "ูููููู ุชูุถูุญ ุงูููุฑุฉ ุงูุนุงูุฉ ููุฐุง ุงูุณุคุงู ูู ููุธูุฑ ุงุณุชุซูุงุฑูุ "
            "ููู ุงูุชุญููู ุงูุฏููู ูุชุทูุจ ุจูุงูุงุช ุณูู ุฃุนูู ูุฑุจุทูุง ุจุงููุฏููุฉ."
        )

    def _advanced_answer(self, question):
        return (
            "ูุฐุง ุงูุณุคุงู ูุฑุชุจุท ุจุณููู ุงูุณูู ูุงูุชูููุช.\n\n"
            "ุจุดูู ุนุงูุ ุงููุฑุงุฑ ุงูุณููู ูุนุชูุฏ ุนูู:\n"
            "โข ูุณุชูู ุงูุณูููุฉ\n"
            "โข ุงุชุฌุงู ุงูุฃุณุนุงุฑ\n"
            "โข ุญุฌู ุงููุนุฑูุถ ููุงุฑูุฉ ุจุงูุทูุจ\n\n"
            "ุงูุชุญููู ุงููุชูุฏู ูุณุงุนุฏ ุนูู ุชูููู ุงููุฑุงุฑุงุช ุงูุนุดูุงุฆูุฉ."
        )

    def _diamond_answer(self, question, city):
        city_alerts = [a for a in self.alerts if a.get("city") == city]

        if city_alerts:
            alert = city_alerts[0]
            return f"""
ุจุงููุณุจุฉ ูุณูู **{city}**:

ููุฌุฏ ุชูุจูู ููู ุงูููู ูุดูุฑ ุฅูู:
{alert.get("description")}

ูุฐุง ุงูููุน ูู ุงูุฅุดุงุฑุงุช ููุณุชุฎุฏู ุนุงุฏุฉู ูููู:
โข ุฃูู ูุชุฑููุฒ ุงูุถุบุท ุงูุณุนุฑู
โข ููู ุงูุญุฑูุฉ ุงูุญุงููุฉ ูุคูุชุฉ ุฃู ุจุฏุงูุฉ ุงุชุฌุงู

ุงูุชูุตูุฉ ููุง ููุณุช ูุฑุงุฑูุง ูุจุงุดุฑูุงุ
ุจู **ุฅุดุงุฑุฉ ุชุญููููุฉ** ูุฌุจ ุฑุจุทูุง ุจูุฏูู ุงูุงุณุชุซูุงุฑู.
"""
        else:
            return (
                f"ูุง ุชุธูุฑ ุชูุจููุงุช ูููุฉ ุงูููู ูู {city}.\n\n"
                "ุบูุงุจ ุงูุฅุดุงุฑุฉ ุฃุญูุงููุง ูุนูู ุฃู ุงูุณูู ูู ูุฑุญูุฉ ุงูุชุธุงุฑุ "
                "ููู ููุช ููุงุณุจ ูููุฑุงูุจุฉ ูููุณ ุงูุชุณุฑูุน."
            )

    def _premium_answer(self, question, city):
        city_alerts = [a for a in self.alerts if a.get("city") == city]

        if city_alerts:
            alert = city_alerts[0]
            return f"""
๐ **ุชุญููู ูุฎุตุต ูุณูู {city}**

ุงูุชูุจูู ุงูุญุงูู:
{alert.get("description")}

ูุง ููููุฒ ูุฐู ุงูุฅุดุงุฑุฉ:
โข ุชูููุชูุง ููุงุฑูุฉ ุจุญุฑูุฉ ุงูุณูู
โข ุธููุฑูุง ูุจู ุงูุนูุงุณ ูุงุถุญ ูู ุงูุฃุณุนุงุฑ
โข ุชูุงูููุง ูุน ุณููู ูุณุชุซูุฑูู ุฃุฐููุงุก

ุงูุณุคุงู ุงูุฃูู ุงูุขู:
ูู ูุฏูู **ุงูุฏุฎูู ุงูุฐูู** ุฃู **ุงูุชูุงูุถ ุนูู ุณุนุฑ ุฃูู**ุ

ุทุฑููุฉ ุงูุชุนุงูู ุชุฎุชูู ุฌุฐุฑููุง ุจูู ุงูุงุซููู.
"""
        else:
            return (
                f"๐ **ุณูู {city} ุงูููู**\n\n"
                "ูุง ุชูุฌุฏ ุฅุดุงุฑุงุช ูููุฉ ุญุงูููุง.\n"
                "ูุฐุง ุบุงูุจูุง ูุนูู ุฃู ุฃูุถู ุงููุฑุงุฑุงุช ุงูุขู ูู:\n"
                "โข ุฌูุน ุงููุนูููุงุช\n"
                "โข ุงูุชุธุงุฑ ูุณุฑ ููุท ูุงุถุญ\n"
                "โข ุฃู ุงูุชุญุถูุฑ ููุชูุงูุถ ุจุฏู ุงูุฏุฎูู ุงูููุฑู"
            )
