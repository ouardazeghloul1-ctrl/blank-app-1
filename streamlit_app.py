import streamlit as st
import pandas as pd
import numpy as np
from datetime import datetime
from data_config import ุงูุฃุณุนุงุฑ_ุงูุญุงููุฉ, ุขุฎุฑ_ุชุญุฏูุซ
from real_fetcher import fetch_real_data

st.set_page_config(page_title="ููุตุฉ ูุฑุฏุฉ ุงูุนูุงุฑูุฉ", page_icon="๐", layout="wide")
st.title("๐ก ููุตุฉ ูุฑุฏุฉ ููุชุญููู ุงูุนูุงุฑู ุงูุฐูู")

st.sidebar.info(f"๐ ุขุฎุฑ ุชุญุฏูุซ ูุญูู: {ุขุฎุฑ_ุชุญุฏูุซ}")

city = st.selectbox("๐๏ธ ุงุฎุชุฑ ุงููุฏููุฉ", list(ุงูุฃุณุนุงุฑ_ุงูุญุงููุฉ.keys()))
ptype = st.selectbox("๐ ููุน ุงูุนูุงุฑ", ["ุดูู", "ููู", "ููุงุชุจ"])

if st.button("๐ ุชุญููู ุงูุณูู ุงูุขู"):
    with st.spinner("ุฌุงุฑู ุฌูุจ ุฃุญุฏุซ ุงูุฃุณุนุงุฑ ูู ุงูุฅูุชุฑูุช..."):
        data = fetch_real_data(city, ptype)
        
        if data:
            st.success("โ ุชู ุฌูุจ ุจูุงูุงุช ุญููููุฉ ูู ุงูุฅูุชุฑูุช!")
            avg = data["ูุชูุณุท_ุงูุณุนุฑ"]
            st.metric("๐ฐ ูุชูุณุท ุงูุณุนุฑ ุงูุญุงูู", f"{avg:,.0f} ุฑูุงู")
            st.write(f"๐งญ ูุทุงู ุงูุฃุณุนุงุฑ ุงููุงูุนู: {data['ูุทุงู_ุงูุณุนุฑ'][0]:,} - {data['ูุทุงู_ุงูุณุนุฑ'][1]:,} ุฑูุงู")
            st.write(f"๐ ุนุฏุฏ ุงูุนูุงุฑุงุช ุงูุชู ุชู ุชุญููููุง: {data['ุนุฏุฏ_ุงููุชุงุฆุฌ']}")
        else:
            st.warning("โ๏ธ ูู ูุชููู ุงูุชุทุจูู ูู ุฌูุจ ุจูุงูุงุช ูุจุงุดุฑุฉุ ุณูุชู ุงุณุชุฎุฏุงู ุงูุจูุงูุงุช ุงููุญููุฉ ุงูุญุงููุฉ.")
            backup = ุงูุฃุณุนุงุฑ_ุงูุญุงููุฉ[city][ptype]
            st.metric("๐ฐ ูุชูุณุท ุงูุณุนุฑ ุงููุญูู", f"{backup['ูุชูุณุท_ุงูุณุนุฑ']:,} ุฑูุงู")
            st.write(f"๐งญ ุงููุทุงู ุงููุญูู: {backup['ูุทุงู_ุงูุณุนุฑ'][0]:,} - {backup['ูุทุงู_ุงูุณุนุฑ'][1]:,} ุฑูุงู")

st.markdown("---")
st.caption("๐ก ููุงุญุธุฉ: ูุชู ุชุญุฏูุซ ุงูุจูุงูุงุช ุงูุญููููุฉ ุฃุณุจูุนููุง ุชููุงุฆููุง ูู ููุงูุน ูุชุนุฏุฏุฉ (ุญุฑุงุฌุ ุจููุชุ ุนูุงุฑ ุงูุณุนูุฏูุฉุ Zillow).")
