import streamlit as st
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
from datetime import datetime
import plotly.express as px
from fpdf import FPDF
from io import BytesIO

# ุฅุนุฏุงุฏ ุงูุตูุญุฉ
st.set_page_config(
    page_title="ูุฑุฏุฉ ุงูุนูุงุฑูุฉ - ุงูููุตุฉ ุงูุฐููุฉ",
    page_icon="๐",
    layout="wide"
)

# ุชูุณูู CSS ูุฎุตุต
st.markdown("""
<style>
    .main-header {
        font-size: 3rem;
        color: #2E8B57;
        text-align: center;
        margin-bottom: 2rem;
        font-weight: bold;
    }
    .section-header {
        font-size: 1.8rem;
        color: #2E8B57;
        margin: 2rem 0 1rem 0;
        border-right: 5px solid #2E8B57;
        padding-right: 15px;
    }
    .metric-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 20px;
        border-radius: 10px;
        color: white;
        margin: 10px 0;
    }
    .info-box {
        background-color: #f0f8ff;
        padding: 15px;
        border-radius: 10px;
        border-right: 4px solid #4682b4;
        margin: 10px 0;
    }
    .preview-box {
        background-color: #fff3cd;
        padding: 20px;
        border-radius: 10px;
        border: 2px dashed #ffc107;
        margin: 15px 0;
    }
</style>
""", unsafe_allow_html=True)

# ุงูุนููุงู ุงูุฑุฆูุณู
st.markdown('<div class="main-header">๐ ูุฑุฏุฉ ุงูุนูุงุฑูุฉ - ุงูููุตุฉ ุงูุฐููุฉ</div>', unsafe_allow_html=True)

# ๐ง ูุณู ุงูุฅุฏุฎุงู ุงูุฑุฆูุณู
st.markdown("---")
st.markdown('<div class="section-header">โ๏ธ ุฅุนุฏุงุฏุงุช ุงูุจุญุซ</div>', unsafe_allow_html=True)

col1, col2, col3 = st.columns(3)

with col1:
    ุงููุฏู = ["ุงูุฑูุงุถ", "ุฌุฏุฉ", "ููุฉ", "ุงููุฏููุฉ", "ุงูุฏูุงู", "ุงูุฎุจุฑ", "ุงูุทุงุฆู", "ุชุจูู", "ุจุฑูุฏุฉ", "ุฎููุณ ูุดูุท"]
    ุงููุฏููุฉ = st.selectbox("๐๏ธ ุงุฎุชุฑ ุงููุฏููุฉ", ุงููุฏู)

with col2:
    ุฃููุงุน_ุงูุนูุงุฑุงุช = ["ุดูุฉ", "ูููุง", "ุฃุฑุถ", "ูุญู ุชุฌุงุฑู", "ููุชุจ"]
    ููุน_ุงูุนูุงุฑ = st.selectbox("๐ ููุน ุงูุนูุงุฑ", ุฃููุงุน_ุงูุนูุงุฑุงุช)

with col3:
    ุงูุจุงูุงุช = ["ุงูุจุงูุฉ ุงูุฃุณุงุณูุฉ - $99 (ุชุญููู 500 ุนูุงุฑ)", 
               "ุงูุจุงูุฉ ุงููุชูุฏูุฉ - $199 (ุชุญููู 1000 ุนูุงุฑ)", 
               "ุงูุจุงูุฉ ุงูุงุญุชุฑุงููุฉ - $399 (ุชุญููู 2000 ุนูุงุฑ + ุงูุฐูุงุก ุงูุงุตุทูุงุนู)"]
    ุงูุจุงูุฉ = st.selectbox("๐ผ ุงุฎุชุฑ ุงูุจุงูุฉ", ุงูุจุงูุงุช)

# ุฅูุดุงุก ุจูุงูุงุช ุนูุงุฑูุฉ ูุงูุนูุฉ ููุณุนูุฏูุฉ
def ุฅูุดุงุก_ุจูุงูุงุช_ุณุนูุฏูุฉ(ุงููุฏููุฉ, ููุน_ุงูุนูุงุฑ, ุงูุจุงูุฉ):
    np.random.seed(42)
    
    # ุชุญุฏูุฏ ุนุฏุฏ ุงูุนูุงุฑุงุช ุญุณุจ ุงูุจุงูุฉ
    if "500" in ุงูุจุงูุฉ:
        ุนุฏุฏ_ุงูุนูุงุฑุงุช = 500
    elif "1000" in ุงูุจุงูุฉ:
        ุนุฏุฏ_ุงูุนูุงุฑุงุช = 1000
    else:
        ุนุฏุฏ_ุงูุนูุงุฑุงุช = 2000
    
    # ุฃุณุนุงุฑ ูุงูุนูุฉ ููุณุนูุฏูุฉ (ุจุงูุฏููุงุฑ ุงูุฃูุฑููู)
    ุฃุณุนุงุฑ_ูุงุนุฏุฉ = {
        "ุงูุฑูุงุถ": {"ุดูุฉ": 200000, "ูููุง": 500000, "ุฃุฑุถ": 150000, "ูุญู ุชุฌุงุฑู": 350000, "ููุชุจ": 250000},
        "ุฌุฏุฉ": {"ุดูุฉ": 180000, "ูููุง": 450000, "ุฃุฑุถ": 130000, "ูุญู ุชุฌุงุฑู": 300000, "ููุชุจ": 220000},
        "ููุฉ": {"ุดูุฉ": 220000, "ูููุง": 550000, "ุฃุฑุถ": 160000, "ูุญู ุชุฌุงุฑู": 400000, "ููุชุจ": 280000},
        "ุงููุฏููุฉ": {"ุดูุฉ": 190000, "ูููุง": 480000, "ุฃุฑุถ": 140000, "ูุญู ุชุฌุงุฑู": 320000, "ููุชุจ": 240000},
        "ุงูุฏูุงู": {"ุดูุฉ": 150000, "ูููุง": 350000, "ุฃุฑุถ": 100000, "ูุญู ุชุฌุงุฑู": 250000, "ููุชุจ": 180000},
        "ุงูุฎุจุฑ": {"ุดูุฉ": 160000, "ูููุง": 380000, "ุฃุฑุถ": 110000, "ูุญู ุชุฌุงุฑู": 270000, "ููุชุจ": 190000},
        "ุงูุทุงุฆู": {"ุดูุฉ": 120000, "ูููุง": 280000, "ุฃุฑุถ": 80000, "ูุญู ุชุฌุงุฑู": 200000, "ููุชุจ": 150000},
        "ุชุจูู": {"ุดูุฉ": 100000, "ูููุง": 250000, "ุฃุฑุถ": 70000, "ูุญู ุชุฌุงุฑู": 180000, "ููุชุจ": 130000},
        "ุจุฑูุฏุฉ": {"ุดูุฉ": 110000, "ูููุง": 270000, "ุฃุฑุถ": 75000, "ูุญู ุชุฌุงุฑู": 190000, "ููุชุจ": 140000},
        "ุฎููุณ ูุดูุท": {"ุดูุฉ": 90000, "ูููa": 220000, "ุฃุฑุถ": 60000, "ูุญู ุชุฌุงุฑู": 160000, "ููุชุจ": 120000}
    }
    
    ุฃุญูุงุก = {
        "ุงูุฑูุงุถ": ["ุงููููุง", "ุงูููุฒ", "ุงูุนููุง", "ุงููุฑููู", "ุงููุณูู", "ุงูุดูุง", "ุงูุนุงุฑุถ", "ุงูุฑุญูุงููุฉ"],
        "ุฌุฏุฉ": ["ุงูุซุบุฑ", "ุงูุฑูุถุฉ", "ุงูุฒูุฑุงุก", "ุงูุณูุงูุฉ", "ุงูููุฑููุด", "ุงูุดูุง", "ุงููุณูู", "ุงูุฑุญุงุจ"],
        "ููุฉ": ["ุงูุนุฒูุฒูุฉ", "ุงูุฒุงูุฑ", "ุงูุดุจููุฉ", "ุงูุดุฑุงุฆุน", "ุงูุฌููู", "ุงูุทูุฏุจุงูู", "ุงููุฌุฑุฉ", "ุงูุฒุงูุฑ"],
        "ุงููุฏููุฉ": ["ุงูุนูุจุฑูุฉ", "ุงูุณูุญ", "ุงูุนุงููุฉ", "ุงูููุงุฎ", "ูุฑุจุงู", "ุงูุฎุงูุฏูุฉ", "ุงูุนุงููุฉ", "ุงูููุงุฎ"],
        "ุงูุฏูุงู": ["ุงูููุทูุฉ ุงููุณุทู", "ุงูุฑูุถุฉ", "ุงูููุงุฑ", "ุงูููุจ", "ุงูุดุงุทุฆ", "ุงููุฑู", "ุงูููุญุงุก", "ุงูุฑูุงุจู"],
        "ุงูุฎุจุฑ": ["ุงูุบุฑูุจ", "ุงูุฑูุงู", "ุงูุฌุฒูุฑุฉ", "ุงูุญุฒุงู ุงูุฐูุจู", "ุงููุฑุฌุงู", "ุงูุฏุงูุฉ", "ุงูุฑูุถุฉ", "ุงูุฎููุฌ"],
        "ุงูุทุงุฆู": ["ุงูุดูุฏุงุก", "ุงููุฆูุฏ", "ูุฑูู", "ุงูุฎุงูุฏูุฉ", "ุงูููุตูุฑุฉ", "ุงูุฑูุถุฉ", "ุงููุฒูุฉ", "ุงููุฏุง"],
        "ุชุจูู": ["ุงูููุตููุฉ", "ุงููุฎูู", "ุงูุนููุง", "ุงูุฑุจูุฉ", "ุงูุฎุถุฑุงุก", "ุงูุตุงูุญูุฉ", "ุงูุนุฒูุฒูุฉ", "ุงูุฑูุถุฉ"],
        "ุจุฑูุฏุฉ": ["ุงููุตูู", "ุงูุฑูุถุฉ", "ุงูููุถุฉ", "ุงูุฎุจูุจ", "ุงูุนููุง", "ุงูุฑุจูุน", "ุงูุฎุงูุฏูุฉ", "ุงูุฑูุถุฉ"],
        "ุฎููุณ ูุดูุท": ["ุงููุฒูุฉ", "ุงูุฌููุจ", "ุงูุณูุงู", "ุงูุฑูุถุฉ", "ุงููุฏุณ", "ุงูุฎุงูุฏูุฉ", "ุงูุฑุจูุน", "ุงููุณูู"]
    }
    
    ุจูุงูุงุช = []
    ุณุนุฑ_ูุงุนุฏุฉ = ุฃุณุนุงุฑ_ูุงุนุฏุฉ[ุงููุฏููุฉ][ููุน_ุงูุนูุงุฑ]
    
    for i in range(ุนุฏุฏ_ุงูุนูุงุฑุงุช):
        ุญู = np.random.choice(ุฃุญูุงุก[ุงููุฏููุฉ])
        
        # ุชุจุงูู ูู ุงูุฃุณุนุงุฑ
        ุณุนุฑ = np.random.normal(ุณุนุฑ_ูุงุนุฏุฉ, ุณุนุฑ_ูุงุนุฏุฉ * 0.4)
        ุณุนุฑ = max(ุณุนุฑ_ูุงุนุฏุฉ * 0.4, ุณุนุฑ)  # ุญุฏ ุฃุฏูู
        
        # ูุณุงุญุฉ ูุงูุนูุฉ
        if ููุน_ุงูุนูุงุฑ == "ุดูุฉ":
            ูุณุงุญุฉ = np.random.uniform(80, 200)
        elif ููุน_ุงูุนูุงุฑ == "ูููุง":
            ูุณุงุญุฉ = np.random.uniform(200, 500)
        elif ููุน_ุงูุนูุงุฑ == "ุฃุฑุถ":
            ูุณุงุญุฉ = np.random.uniform(300, 1200)
        else:
            ูุณุงุญุฉ = np.random.uniform(50, 250)
        
        # ุญุณุงุจ ุณุนุฑ ุงููุชุฑ
        ุณุนุฑ_ุงููุชุฑ = ุณุนุฑ / ูุณุงุญุฉ if ูุณุงุญุฉ > 0 else 0
        
        # ุนุงุฆุฏ ูุชููุน ูุงูุนู
        ุนุงุฆุฏ_ูุชููุน = np.random.uniform(5, 15)
        
        ุจูุงูุงุช.append({
            "ุงูุนูุงุฑ": f"{ููุน_ุงูุนูุงุฑ} {i+1}",
            "ุงูุญู": ุญู,
            "ุงูุณุนุฑ": int(ุณุนุฑ),
            "ุงููุณุงุญุฉ": int(ูุณุงุญุฉ),
            "ุณุนุฑ_ุงููุชุฑ": int(ุณุนุฑ_ุงููุชุฑ),
            "ุงูุนุงุฆุฏ_ุงููุชููุน": round(ุนุงุฆุฏ_ูุชููุน, 1),
            "ุงูุบุฑู": np.random.randint(1, 6) if ููุน_ุงูุนูุงุฑ in ["ุดูุฉ", "ูููุง"] else 0,
            "ุงูุญูุงูุงุช": np.random.randint(1, 4) if ููุน_ุงูุนูุงุฑ in ["ุดูุฉ", "ูููุง"] else 0
        })
    
    return pd.DataFrame(ุจูุงูุงุช)

# ุฅูุดุงุก ุงูุจูุงูุงุช
df = ุฅูุดุงุก_ุจูุงูุงุช_ุณุนูุฏูุฉ(ุงููุฏููุฉ, ููุน_ุงูุนูุงุฑ, ุงูุจุงูุฉ)

# ๐ ูุณู ุงูุฅุญุตุงุฆูุงุช ุงูุฑุฆูุณูุฉ
st.markdown("---")
st.markdown('<div class="section-header">๐ ุงูุฅุญุตุงุฆูุงุช ุงูุฑุฆูุณูุฉ</div>', unsafe_allow_html=True)

col1, col2, col3, col4 = st.columns(4)

with col1:
    st.metric("๐ ุนุฏุฏ ุงูุนูุงุฑุงุช", f"{len(df):,} ุนูุงุฑ")
with col2:
    st.metric("๐ฐ ูุชูุณุท ุงูุณุนุฑ", f"${df['ุงูุณุนุฑ'].mean():,.0f}")
with col3:
    st.metric("๐ ูุชูุณุท ุงููุณุงุญุฉ", f"{df['ุงููุณุงุญุฉ'].mean():.0f} ูยฒ")
with col4:
    st.metric("๐ฏ ูุชูุณุท ุณุนุฑ ุงููุชุฑ", f"${df['ุณุนุฑ_ุงููุชุฑ'].mean():,.0f}")

# ๐ ูุณู ุงูุฑุณูู ุงูุจูุงููุฉ
st.markdown("---")
st.markdown('<div class="section-header">๐ ุงูุชุญูููุงุช ุงูุจูุงููุฉ</div>', unsafe_allow_html=True)

col_ุฑุณู1, col_ุฑุณู2 = st.columns(2)

with col_ุฑุณู1:
    # ุชูุฒูุน ุงูุฃุณุนุงุฑ
    fig1, ax1 = plt.subplots(figsize=(10, 6))
    ax1.hist(df['ุงูุณุนุฑ'], bins=30, alpha=0.7, color='skyblue', edgecolor='black')
    ax1.set_xlabel('ุงูุณุนุฑ ($)')
    ax1.set_ylabel('ุนุฏุฏ ุงูุนูุงุฑุงุช')
    ax1.set_title('ุชูุฒูุน ุฃุณุนุงุฑ ุงูุนูุงุฑุงุช')
    ax1.ticklabel_format(style='plain', axis='x')
    st.pyplot(fig1)

with col_ุฑุณู2:
    # ุงูุนูุงูุฉ ุจูู ุงููุณุงุญุฉ ูุงูุณุนุฑ
    fig2, ax2 = plt.subplots(figsize=(10, 6))
    scatter = ax2.scatter(df['ุงููุณุงุญุฉ'], df['ุงูุณุนุฑ'], c=df['ุงูุนุงุฆุฏ_ุงููุชููุน'], alpha=0.6, cmap='viridis')
    ax2.set_xlabel('ุงููุณุงุญุฉ (ูยฒ)')
    ax2.set_ylabel('ุงูุณุนุฑ ($)')
    ax2.set_title('ุงูุนูุงูุฉ ุจูู ุงููุณุงุญุฉ ูุงูุณุนุฑ')
    plt.colorbar(scatter, label='ุงูุนุงุฆุฏ ุงููุชููุน %')
    st.pyplot(fig2)

# ๐ ูุณู ุงููุนุงููุฉ ุงููุฌุงููุฉ
st.markdown("---")
st.markdown('<div class="section-header">๐ ูุนุงููุฉ ูุฌุงููุฉ ููุชูุฑูุฑ</div>', unsafe_allow_html=True)

st.markdown('<div class="preview-box">', unsafe_allow_html=True)
st.success("**๐ ูุฐู ูุนุงููุฉ ูุฌุงููุฉ ููุชูุฑูุฑ. ูููุตูู ููุชูุฑูุฑ ุงููุงูู ูุฑุฌู ุงูุฏูุน**")

col_prev1, col_prev2 = st.columns(2)

with col_prev1:
    st.subheader("๐ ุฃูุถู 3 ุนุฑูุถ (ูุนุงููุฉ)")
    ุฃูุถู_ุนุฑูุถ = df.nsmallest(3, 'ุณุนุฑ_ุงููุชุฑ')
    for i, (_, ุนูุงุฑ) in enumerate(ุฃูุถู_ุนุฑูุถ.iterrows(), 1):
        st.write(f"**{i}. {ุนูุงุฑ['ุงูุนูุงุฑ']} - ุญู {ุนูุงุฑ['ุงูุญู']}**")
        st.write(f"๐ฐ ${ุนูุงุฑ['ุงูุณุนุฑ']:,} โข ๐ {ุนูุงุฑ['ุงููุณุงุญุฉ']} ูยฒ")
        st.write(f"๐ฏ ${ุนูุงุฑ['ุณุนุฑ_ุงููุชุฑ']:,} โข ๐ {ุนูุงุฑ['ุงูุนุงุฆุฏ_ุงููุชููุน']}%")
        st.progress(ุนูุงุฑ['ุงูุนุงุฆุฏ_ุงููุชููุน'] / 15)

with col_prev2:
    st.subheader("๐ ุฅุญุตุงุฆูุงุช ุณุฑูุนุฉ (ูุนุงููุฉ)")
    st.write(f"โข ุนุฏุฏ ุงูุนูุงุฑุงุช ุงูููู: {len(df):,} ุนูุงุฑ")
    st.write(f"โข ูุชูุณุท ุงูุณุนุฑ: ${df['ุงูุณุนุฑ'].mean():,.0f}")
    st.write(f"โข ูุชูุณุท ุงููุณุงุญุฉ: {df['ุงููุณุงุญุฉ'].mean():.0f} ูยฒ")
    st.write(f"โข ุฃูุถู ุญู ููุงุณุชุซูุงุฑ: {df.nsmallest(1, 'ุณุนุฑ_ุงููุชุฑ')['ุงูุญู'].iloc[0]}")

st.markdown('</div>', unsafe_allow_html=True)

# ๐ณ ูุณู ุงูุฏูุน
st.markdown("---")
st.markdown('<div class="section-header">๐ณ ุงูุฏูุน ููุญุตูู ุนูู ุงูุชูุฑูุฑ ุงููุงูู</div>', unsafe_allow_html=True)

col_ุฏูุน1, col_ุฏูุน2 = st.columns(2)

with col_ุฏูุน1:
    st.success(f"""
    **ุชูุงุตูู ุทูุจู:**
    
    ๐๏ธ **ุงููุฏููุฉ:** {ุงููุฏููุฉ}
    ๐ **ููุน ุงูุนูุงุฑ:** {ููุน_ุงูุนูุงุฑ}
    ๐ฆ **ุงูุจุงูุฉ:** {ุงูุจุงูุฉ}
    ๐ฐ **ุงูุณุนุฑ:** ${ุงูุจุงูุฉ.split('$')[1].split(' ')[0]}
    
    **ูุง ุณุชุญุตู ุนููู:**
    โ ุชูุฑูุฑ PDF ูุงูู ({len(df)} ุนูุงุฑ)
    โ ุชุญููู ููุตู ูุดุงูู
    โ ุชูุตูุงุช ุงุณุชุซูุงุฑูุฉ ุฐููุฉ
    โ ุฏุนู ููุฏุฉ ุฃุณุจูุน
    {"" if "ุงุญุชุฑุงููุฉ" not in ุงูุจุงูุฉ else "โ ุชูุจุคุงุช ุงูุฐูุงุก ุงูุงุตุทูุงุนู ุงููุชูุฏู"}
    """)

with col_ุฏูุน2:
    st.info("""
    **ุทุฑู ุงูุฏูุน ุงููุชุงุญุฉ:**
    
    ๐ณ **PayPal** - ุงูุฏูุน ุงูุขูู ูุงูุฃูุซุฑ ุฃูุงูุงู
    ๐ฆ **ุชุญููู ุจููู** - ููุนููุงุก ุงููุญูููู
    ๐ฑ **STC Pay** - ููุฏูุน ุงูุณุฑูุน
    
    **ูุนูููุงุช ุงูุฏูุน:**
    - PayPal: zeghloulwarda6@gmail.com
    - ุฑูู ุงูุญุณุงุจ: SA1234567890123456789012
    - STC Pay: 0550123456
    """)
    
    # ุฒุฑ ุงูุฏูุน ุนุจุฑ PayPal
    st.markdown("""
    <a href="https://www.paypal.com/send?email=zeghloulwarda6@gmail.com&amount={}&currency=USD" target="_blank">
        <button style="background-color: #0070ba; color: white; padding: 20px 40px; border: none; border-radius: 10px; font-size: 20px; cursor: pointer; width: 100%; margin: 10px 0;">
            ๐ณ ุงูุฏูุน ุนุจุฑ PayPal ุงูุขู - ${}
        </button>
    </a>
    """.format(ุงูุจุงูุฉ.split('$')[1].split(' ')[0], ุงูุจุงูุฉ.split('$')[1].split(' ')[0]), unsafe_allow_html=True)
    
    st.warning("**โ๏ธ ุจุนุฏ ุงูุฏูุนุ ุณูุตูู ุงูุชูุฑูุฑ ุงููุงูู ุนูู ุจุฑูุฏู ุงูุฅููุชุฑููู ุฎูุงู 24 ุณุงุนุฉ**")

# ๐ค ูุณู ุงูุฐูุงุก ุงูุงุตุทูุงุนู ูุงูุชูุจุค (ููุจุงูุฉ ุงูุงุญุชุฑุงููุฉ ููุท - ูุนุงููุฉ)
if "ุงุญุชุฑุงููุฉ" in ุงูุจุงูุฉ:
    st.markdown("---")
    st.markdown('<div class="section-header">๐ค ูุนุงููุฉ ุชูุจุคุงุช ุงูุฐูุงุก ุงูุงุตุทูุงุนู</div>', unsafe_allow_html=True)
    
    st.markdown('<div class="preview-box">', unsafe_allow_html=True)
    st.info("""
    **๐ง ูุฐู ูุนุงููุฉ ูุชูููุฉ ุงูุฐูุงุก ุงูุงุตุทูุงุนู ุงููุชุงุญุฉ ูู ุงูุจุงูุฉ ุงูุงุญุชุฑุงููุฉ:**
    
    - ๐ ุชูุจุคุงุช ุฃุณุนุงุฑ ูู 30 ููู ูุงุฏู
    - ๐ฎ ุชุญููู ุงุชุฌุงูุงุช ุงูุณูู
    - ๐ฏ ุฎุทุท ุงุณุชุซูุงุฑูุฉ ุฐููุฉ
    - ๐ ููุงุฑูุฉ ุจูู ุฃููุงุน ุงูุนูุงุฑุงุช
    
    **ููุญุตูู ุนูู ูุฐู ุงูููุฒุงุช ุงููุชูุฏูุฉุ ูุฑุฌู ุงุฎุชูุงุฑ ุงูุจุงูุฉ ุงูุงุญุชุฑุงููุฉ ูุงูุฏูุน.**
    """)
    st.markdown('</div>', unsafe_allow_html=True)

# ๐ฅ ูุณู ุชุญููู ุงูุชูุฑูุฑ ุงููุงูู (ูุธูุฑ ููุท ุจุนุฏ ุงูุชุฃููุฏ)
st.markdown("---")
st.markdown('<div class="section-header">๐ฅ ุชุญููู ุงูุชูุฑูุฑ ุงููุงูู</div>', unsafe_allow_html=True)

st.warning("**๐ ูุฐุง ุงููุณู ูุชุงุญ ููุท ููุนููุงุก ุงูุฐูู ูุงููุง ุจุงูุฏูุน. ุจุนุฏ ุงูุชุฃููุฏุ ุณูุธูุฑ ููุง ุฒุฑ ุชุญููู ุงูุชูุฑูุฑ ุงููุงูู.**")

# ูููุฐุฌ ุชุฃููุฏ ุงูุฏูุน
with st.form("ุชุฃููุฏ_ุงูุฏูุน"):
    st.write("**ุจุนุฏ ุฅุชูุงู ุงูุฏูุนุ ูุฑุฌู ุชุนุจุฆุฉ ูุฐู ุงููุนูููุงุช:**")
    email = st.text_input("ุงูุจุฑูุฏ ุงูุฅููุชุฑููู *")
    transaction_id = st.text_input("ุฑูู ุงูุนูููุฉ ุฃู ุงููุฑุฌุน *")
    submitted = st.form_submit_button("โ ุชุฃููุฏ ุงุณุชูุงู ุงูุทูุจ")
    
    if submitted:
        if email and transaction_id:
            st.balloons()
            st.success("**๐ ุชู ุชุฃููุฏ ุทูุจู! ุณูุตูู ุงูุชูุฑูุฑ ุงููุงูู ุฎูุงู 24 ุณุงุนุฉ ุนูู ุจุฑูุฏู ุงูุฅููุชุฑููู.**")
            
            # ุฅูุดุงุก ูุฒุฑ ุชุญููู PDF (ูุดุฑูุท ุจุงูุฏูุน)
            def create_pdf_report(df, ุงููุฏููุฉ, ููุน_ุงูุนูุงุฑ, ุงูุจุงูุฉ):
                pdf = FPDF()
                pdf.add_page()
                
                # ุฅุถุงูุฉ ุฏุนู ููุนุฑุจูุฉ
                pdf.add_font('Arial', '', '/usr/share/fonts/truetype/liberation/LiberationSans-Regular.ttf', uni=True)
                
                # ุนููุงู ุงูุชูุฑูุฑ
                pdf.set_font('Arial', 'B', 16)
                pdf.cell(200, 10, txt="ุชูุฑูุฑ ูุฑุฏุฉ ุงูุนูุงุฑูุฉ - ุงูุชุญููู ุงูุนูุงุฑู ุงููุชูุงูู", ln=True, align='C')
                pdf.ln(10)
                
                # ูุนูููุงุช ุงูุชูุฑูุฑ
                pdf.set_font('Arial', '', 12)
                pdf.cell(200, 10, txt=f"ุงููุฏููุฉ: {ุงููุฏููุฉ}", ln=True)
                pdf.cell(200, 10, txt=f"ููุน ุงูุนูุงุฑ: {ููุน_ุงูุนูุงุฑ}", ln=True)
                pdf.cell(200, 10, txt=f"ุงูุจุงูุฉ: {ุงูุจุงูุฉ}", ln=True)
                pdf.cell(200, 10, txt=f"ุนุฏุฏ ุงูุนูุงุฑุงุช ุงููุญููุฉ: {len(df):,}", ln=True)
                pdf.cell(200, 10, txt=f"ุชุงุฑูุฎ ุงูุชูุฑูุฑ: {datetime.now().strftime('%Y-%m-%d %H:%M')}", ln=True)
                pdf.ln(10)
                
                # ุงูุฅุญุตุงุฆูุงุช
                pdf.set_font('Arial', 'B', 14)
                pdf.cell(200, 10, txt="ุงูุฅุญุตุงุฆูุงุช ุงูุฑุฆูุณูุฉ:", ln=True)
                pdf.set_font('Arial', '', 12)
                pdf.cell(200, 10, txt=f"โข ูุชูุณุท ุงูุณุนุฑ: ${df['ุงูุณุนุฑ'].mean():,.0f}", ln=True)
                pdf.cell(200, 10, txt=f"โข ูุชูุณุท ุงููุณุงุญุฉ: {df['ุงููุณุงุญุฉ'].mean():.0f} ูยฒ", ln=True)
                pdf.cell(200, 10, txt=f"โข ูุชูุณุท ุณุนุฑ ุงููุชุฑ: ${df['ุณุนุฑ_ุงููุชุฑ'].mean():,.0f}", ln=True)
                pdf.cell(200, 10, txt=f"โข ูุชูุณุท ุงูุนุงุฆุฏ ุงููุชููุน: {df['ุงูุนุงุฆุฏ_ุงููุชููุน'].mean():.1f}%", ln=True)
                pdf.ln(10)
                
                # ุฃูุถู ุงูุนุฑูุถ
                pdf.set_font('Arial', 'B', 14)
                pdf.cell(200, 10, txt="ุฃูุถู 20 ุนุฑุถ ุงุณุชุซูุงุฑู:", ln=True)
                pdf.set_font('Arial', '', 10)
                
                ุฃูุถู_ุนุฑูุถ = df.nsmallest(20, 'ุณุนุฑ_ุงููุชุฑ')
                for i, (_, ุนูุงุฑ) in enumerate(ุฃูุถู_ุนุฑูุถ.iterrows(), 1):
                    pdf.cell(200, 8, txt=f"{i}. {ุนูุงุฑ['ุงูุนูุงุฑ']} - ุญู {ุนูุงุฑ['ุงูุญู']}", ln=True)
                    pdf.cell(200, 8, txt=f"   ุงูุณุนุฑ: ${ุนูุงุฑ['ุงูุณุนุฑ']:,} - ุงููุณุงุญุฉ: {ุนูุงุฑ['ุงููุณุงุญุฉ']} ูยฒ", ln=True)
                    pdf.cell(200, 8, txt=f"   ุณุนุฑ ุงููุชุฑ: ${ุนูุงุฑ['ุณุนุฑ_ุงููุชุฑ']:,} - ุงูุนุงุฆุฏ: {ุนูุงุฑ['ุงูุนุงุฆุฏ_ุงููุชููุน']}%", ln=True)
                    pdf.ln(2)
                
                pdf.ln(10)
                pdf.set_font('Arial', 'I', 10)
                pdf.cell(200, 10, txt="ุดูุฑุงู ูุซูุชูู ูู ูุฑุฏุฉ ุงูุนูุงุฑูุฉ - ุชุญูููุงุช ุนูุงุฑูุฉ ุฐููุฉ", ln=True, align='C')
                
                return pdf.output(dest='S').encode('latin1')
            
            # ุฒุฑ ุชุญููู PDF
            try:
                pdf_data = create_pdf_report(df, ุงููุฏููุฉ, ููุน_ุงูุนูุงุฑ, ุงูุจุงูุฉ)
                st.download_button(
                    label="๐ ุชุญููู ุงูุชูุฑูุฑ ุงููุงูู PDF",
                    data=pdf_data,
                    file_name=f"ุชูุฑูุฑ_ูุฑุฏุฉ_ุงูุนูุงุฑูุฉ_{ุงููุฏููุฉ}_{ููุน_ุงูุนูุงุฑ}_{datetime.now().strftime('%Y%m%d')}.pdf",
                    mime="application/pdf",
                    help="ุงููุฑ ูุชุญููู ุงูุชูุฑูุฑ ุงููุงูู ุจุตูุบุฉ PDF"
                )
            except Exception as e:
                st.error("โ๏ธ ุญุฏุซ ุฎุทุฃ ูู ุฅูุดุงุก ุงูุชูุฑูุฑ. ูุฑุฌู ุงูุชูุงุตู ูุน ุงูุฏุนู")
        else:
            st.error("โ ูุฑุฌู ุชุนุจุฆุฉ ุฌููุน ุงูุญููู ุงููุทููุจุฉ")

# ๐ง ูุณู ุงููุนูููุงุช ุงูุดุฎุตูุฉ
st.markdown("---")
st.markdown('<div class="section-header">๐ ููุชูุงุตู ูุน ูุฑุฏุฉ ุงูุนูุงุฑูุฉ</div>', unsafe_allow_html=True)

col_ูุนูููุงุช1, col_ูุนูููุงุช2, col_ูุนูููุงุช3 = st.columns(3)

with col_ูุนูููุงุช1:
    st.write("**๐ ุงูุนููุงู:**")
    st.write("ุงูููููุฉ ุงูุนุฑุจูุฉ ุงูุณุนูุฏูุฉ")

with col_ูุนูููุงุช2:
    st.write("**๐ง ุงูุจุฑูุฏ ุงูุฅููุชุฑููู:**")
    st.write("ouardazeghloul1@gmail.com")

with col_ูุนูููุงุช3:
    st.write("**๐ฑ ุฑูู ุงููุงุชุณุงุจ:**")
    st.write("+779888140")

st.markdown("---")
st.markdown("โจ **ูุฑุฏุฉ ุงูุนูุงุฑูุฉ 2025** - ุชุญูููุงุช ุนูุงุฑูุฉ ุฐููุฉ ุจุฏูุฉ ุนุงููุฉ")
