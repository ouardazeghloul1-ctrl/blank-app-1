import streamlit as st
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
from datetime import datetime
import warnings
from io import BytesIO
warnings.filterwarnings('ignore')

# ๐จ ุชุญุณูู ุงูุฃููุงู ูุงูุชุตููู ุงูุจุตุฑู
st.markdown("""
    <style>
        .stApp {
            background-color: #f9fafc;
        }
        h1, h2, h3, h4, h5 {
            color: #003366;
        }
        .css-1v3fvcr {
            background-color: #e6f2ff;
        }
        .stButton>button {
            background-color: #0066cc;
            color: white;
            border-radius: 8px;
            padding: 10px 24px;
            font-weight: bold;
        }
        .stDownloadButton>button {
            background-color: #00a86b;
            color: white;
            border-radius: 6px;
        }
    </style>
""", unsafe_allow_html=True)

# ุฅุนุฏุงุฏุงุช ุงูุนุฑุจูุฉ
plt.rcParams['font.family'] = 'DejaVu Sans'
plt.rcParams['axes.unicode_minus'] = False

st.set_page_config(page_title="ูุฑุฏุฉ ุงูุนูุงุฑูุฉ", page_icon="๐", layout="wide")

# ุงูุนููุงู ุงูุฑุฆูุณู ุงููุญุณู
st.title("๐ก ููุตุฉ ูุฑุฏุฉ ููุชุญููู ุงูุนูุงุฑู ุงูุฐูู ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู")
st.caption("ุญููู ุชุญููู ุนูุงุฑู ูุชูุฏูุฉ ูุชุญุฏูุฏ ุฃูุถู ุงููุฑุต ุงูุงุณุชุซูุงุฑูุฉ ุจุฏูุฉ ุนุงููุฉ ๐ผ")
st.markdown("---")

# ูููุฐุฌ ุฅุฏุฎุงู ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ
col1, col2 = st.columns(2)
with col1:
    ุงููุฏููุฉ = st.selectbox("๐๏ธ ุงุฎุชุฑ ุงููุฏููุฉ", ["ุงูุฑูุงุถ", "ุฌุฏุฉ", "ุงูุฏูุงู", "ููุฉ", "ุงููุฏููุฉ"])
with col2:
    ุงุณู_ุงูุนููู = st.text_input("๐ค ุงุณู ุงูุนููู", placeholder="ุฃุฏุฎู ุงุณู ุงูุนููู")

col3, col4 = st.columns(2)
with col3:
    ููุน_ุงูุนูุงุฑ = st.selectbox("๐ ููุน ุงูุนูุงุฑ", ["ุดูู", "ููู", "ููุงุชุจ", "ูุญูุงุช"])
with col4:
    ุนุฏุฏ_ุงูุนูุงุฑุงุช = st.slider("๐ ุนุฏุฏ ุงูุนูุงุฑุงุช", 50, 500, 100)

# ๐ฏ ุงููุณู ุงูุฌุฏูุฏ - ุชุฎุตูุต ุงูุชูุฑูุฑ
st.markdown("---")
st.subheader("๐ฏ ุชุฎุตูุต ุงูุชูุฑูุฑ ุงููุชูุฏู")

col5, col6 = st.columns(2)
with col5:
    ุงููุฏู_ุงูุงุณุชุซูุงุฑู = st.selectbox(
        "ุงููุฏู ุงูุงุณุชุซูุงุฑู:",
        [
            "๐ ุงุณุชุซูุงุฑ ุทููู ุงููุฏู (5+ ุณููุงุช)",
            "โก ุชุฏุงูู ุนูุงุฑู ุณุฑูุน (6-12 ุดูุฑ)", 
            "๐ ุชุทููุฑ ูุดุฑูุน ุงุณุชุซูุงุฑู",
            "๐ก๏ธ ุชูููุน ุงููุญูุธุฉ ุงูุงุณุชุซูุงุฑูุฉ",
            "๐ฏ ุฃุนูู ุนุงุฆุฏ ุนูู ุงููุฏู ุงููุตูุฑ"
        ]
    )
    
with col6:
    ุงูููุฒุงููุฉ = st.selectbox(
        "ุงูููุฒุงููุฉ ุงููุชููุนุฉ:",
        [
            "๐ฐ ุญุชู 500,000 ุฑูุงู",
            "๐ต 500,000 - 1,000,000 ุฑูุงู", 
            "๐ 1,000,000 - 2,000,000 ุฑูุงู",
            "๐ฆ 2,000,000 - 5,000,000 ุฑูุงู",
            "๐ ุฃูุซุฑ ูู 5,000,000 ุฑูุงู"
        ]
    )

ูุณุชูู_ุงูุชูุตูู = st.radio(
    "๐ ูุณุชูู ุงูุชูุตูู ุงููุทููุจ:",
    ["๐ ุชูุฑูุฑ ุณุฑูุน (ุชุญููู ุฃุณุงุณู)", "๐ ุชูุฑูุฑ ูุชูุฏู (ุชุญููู ููุตู)", "๐ ุฏุฑุงุณุฉ ุดุงููุฉ (ุชูุตูุงุช ุงุณุชุฑุงุชูุฌูุฉ)"]
)

# ุฒุฑ ุงูุชุดุบูู
if st.button("๐ ุฃูุดุฆ ุงูุชูุฑูุฑ ุงููุชุฎุตุต", type="primary"):
    with st.spinner("ุฌุงุฑู ุฅูุดุงุก ุงูุชูุฑูุฑ ุงููุชุฎุตุต..."):
        # ูุญุงูุงุฉ ุฅูุดุงุก ุงูุจูุงูุงุช ุงููุชุฎุตุตุฉ
        data = {
            'ุงูุนูุงุฑ': [f'ุนูุงุฑ {i+1}' for i in range(ุนุฏุฏ_ุงูุนูุงุฑุงุช)],
            'ุงูุณุนุฑ': np.random.randint(300000, 2000000, ุนุฏุฏ_ุงูุนูุงุฑุงุช),
            'ุงููุณุงุญุฉ': np.random.randint(80, 400, ุนุฏุฏ_ุงูุนูุงุฑุงุช),
            'ุงูุญู': np.random.choice(['ุงููุฎูู', 'ุงูุฑูุถุฉ', 'ุงูุตูุง', 'ุงูุฒูุฑุงุก', 'ุงูุฑุจูุฉ'], ุนุฏุฏ_ุงูุนูุงุฑุงุช),
            'ุงูุนุงุฆุฏ_ุงููุชููุน_ูช': np.random.uniform(5, 25, ุนุฏุฏ_ุงูุนูุงุฑุงุช),
            'ูุณุชูู_ุงูุฎุทูุฑุฉ': np.random.choice(['ููุฎูุถ', 'ูุชูุณุท', 'ูุฑุชูุน'], ุนุฏุฏ_ุงูุนูุงุฑุงุช)
        }
        
        df = pd.DataFrame(data)
        
        # ๐จ ุชุฃุซูุฑ ูุณุชูู ุงูุชูุตูู ุนูู ูููุฉ ุงูุจูุงูุงุช
        if "ุณุฑูุน" in ูุณุชูู_ุงูุชูุตูู:
            df = df.sample(30)
            st.info("๐ ูุถุน ุงูุชูุฑูุฑ ุงูุณุฑูุน: ุชุญููู 30 ุนูุงุฑุงู ูุฎุชุงุฑุงู ุจุนูุงูุฉ")
        elif "ูุชูุฏู" in ูุณุชูู_ุงูุชูุตูู:  # โ ุชู ุชุตุญูุญ ุงูุฎุทุฃ ููุง
            df = df.sample(80)
            st.info("๐ ูุถุน ุงูุชูุฑูุฑ ุงููุชูุฏู: ุชุญููู 80 ุนูุงุฑุงู ุจุชูุงุตูู ุดุงููุฉ")
        else:
            st.info("๐ ูุถุน ุงูุฏุฑุงุณุฉ ุงูุดุงููุฉ: ุชุญููู ูุงูู ูุฌููุน ุงูุนูุงุฑุงุช ุงููุชุงุญุฉ")
        
        # ๐ฌ ููุฑุฉ "ูุจุฐุฉ ุนู ุงูุชูุฑูุฑ"
        st.markdown(f"""
        #### ๐งญ ูุฐุง ุงูุชูุฑูุฑ ุฃููุดุฆ ุฎุตูุตูุง ูู **{ุงุณู_ุงูุนููู if ุงุณู_ุงูุนููู else 'ุนููููุง ุงููุฑูู'}**
        **ุงููุฏู ุงูุงุณุชุซูุงุฑู:** {ุงููุฏู_ุงูุงุณุชุซูุงุฑู}  
        **ุงูููุฒุงููุฉ ุงููุชููุนุฉ:** {ุงูููุฒุงููุฉ}  
        **ููุน ุงูุนูุงุฑ:** {ููุน_ุงูุนูุงุฑ}  
        **ุงููุฏููุฉ:** {ุงููุฏููุฉ}
        """)
        
        # ุนุฑุถ ุงููุชุงุฆุฌ ุงููุชุฎุตุตุฉ
        st.success(f"โ ุชู ุฅูุดุงุก ุงูุชูุฑูุฑ ุงููุชุฎุตุต ูููุฏู: {ุงููุฏู_ุงูุงุณุชุซูุงุฑู}")
        
        # ุงูุฅุญุตุงุฆูุงุช ุงููุชูุฏูุฉ
        st.subheader("๐ ุงููุชุงุฆุฌ ุงููุชุฎุตุตุฉ")
        
        col1, col2, col3, col4 = st.columns(4)
        with col1:
            st.metric("๐ฐ ูุชูุณุท ุงูุณุนุฑ", f"{df['ุงูุณุนุฑ'].mean():,.0f} ุฑูุงู")
        with col2:
            st.metric("๐ ูุชูุณุท ุงููุณุงุญุฉ", f"{df['ุงููุณุงุญุฉ'].mean():.0f} ูยฒ")
        with col3:
            st.metric("๐ ูุชูุณุท ุงูุนุงุฆุฏ", f"{df['ุงูุนุงุฆุฏ_ุงููุชููุน_ูช'].mean():.1f}%")
        with col4:
            ุนูุงุฑุงุช_ููุฎูุถุฉ_ุฎุทูุฑุฉ = len(df[df['ูุณุชูู_ุงูุฎุทูุฑุฉ'] == 'ููุฎูุถ'])
            st.metric("๐ก๏ธ ุนูุงุฑุงุช ุขููุฉ", f"{ุนูุงุฑุงุช_ููุฎูุถุฉ_ุฎุทูุฑุฉ} ุนูุงุฑ")
        
        # โจ ุงูููุฎุต ุงููุตู ุงูุทุจูุนู
        ูุชูุณุท_ุงูุณุนุฑ = df['ุงูุณุนุฑ'].mean()
        ูุชูุณุท_ุงูุนุงุฆุฏ = df['ุงูุนุงุฆุฏ_ุงููุชููุน_ูช'].mean()
        
        st.markdown(f"""
        ### ๐ ุฎูุงุตุฉ ุงูุชูุฑูุฑ:
        - ูุชูุณุท ุณุนุฑ ุงูุนูุงุฑ ูู **{ุงููุฏููุฉ}** ูู ุญูุงูู **{ูุชูุณุท_ุงูุณุนุฑ:,.0f} ุฑูุงู**.
        - ูุชูุณุท ุงูุนุงุฆุฏ ุงููุชููุน ูู **{ูุชูุณุท_ุงูุนุงุฆุฏ:.1f}%**.
        - ุจูุงุกู ุนูู ูุฏูู **({ุงููุฏู_ุงูุงุณุชุซูุงุฑู})** ููุตู ุจุงูุชุฑููุฒ ุนูู ุงูุฃุญูุงุก ุฐุงุช ุงูุฎุทูุฑุฉ ุงูููุฎูุถุฉ ูุชุญููู ุชูุงุฒู ุจูู ุงูุนุงุฆุฏ ูุงูุฃูุงู.
        - ุชู ุชุญููู **{len(df)} ุนูุงุฑ** ูู **{ุงููุฏููุฉ}** ูุชูุฏูู ุฃูุถู ุงูุชูุตูุงุช.
        """)
        
        # ุงูุชูุตูุงุช ุงูุงุณุชุซูุงุฑูุฉ ุญุณุจ ุงููุฏู
        st.subheader("๐ก ุงูุชูุตูุงุช ุงูุงุณุชุฑุงุชูุฌูุฉ")
        
        if "ุทููู ุงููุฏู" in ุงููุฏู_ุงูุงุณุชุซูุงุฑู:
            st.info("""
            **๐ฏ ุชูุตูุงุช ุงูุงุณุชุซูุงุฑ ุทููู ุงููุฏู:**
            โข ุฑูุฒ ุนูู ุงูุนูุงุฑุงุช ูู ุงูุฃุญูุงุก ุงูุฑุงููุฉ (ุงููุฎููุ ุงูุตูุง)
            โข ุงุฎุชุฑ ุนูุงุฑุงุช ุจูุณุงุญุงุช ูุจูุฑุฉ (+200ูยฒ) ูุชุญููู ุงุณุชูุฑุงุฑ ุทููู
            โข ุงุณุชุซูุฑ ูู ููุงุทู ุฐุงุช ุฎุทุท ุชุทููุฑ ูุณุชูุจููุฉ
            โข ุงูุนุงุฆุฏ ุงููุชููุน: 8-15% ุณูููุงู ุนูู ุงููุฏู ุงูุทููู
            """)
        elif "ุณุฑูุน" in ุงููุฏู_ุงูุงุณุชุซูุงุฑู:
            st.info("""
            **โก ุชูุตูุงุช ุงูุชุฏุงูู ุงูุณุฑูุน:**
            โข ุงุจุญุซ ุนู ุนูุงุฑุงุช ุชุญุช ุงูุณุนุฑ ุงูุณููู ุจูุณุจุฉ 10-15%
            โข ุฑูุฒ ุนูู ุงูููุงุทู ุฐุงุช ุงูุทูุจ ุงููุชุฒุงูุฏ (ุงูุฑูุถุฉุ ุงูุฒูุฑุงุก)
            โข ุงุฎุชุฑ ุนูุงุฑุงุช ุณููุฉ ุงูุจูุน (ุดููุ ูุญูุงุช ุชุฌุงุฑูุฉ)
            โข ุงุณุชูุฏู ุนุงุฆุฏ ุณุฑูุน 15-25% ุฎูุงู 6-12 ุดูุฑ
            """)
        elif "ุชุทููุฑ" in ุงููุฏู_ุงูุงุณุชุซูุงุฑู:
            st.info("""
            **๐๏ธ ุชูุตูุงุช ุงูุชุทููุฑ ุงูุงุณุชุซูุงุฑู:**
            โข ุงุฎุชุฑ ุฃุฑุงุถู ุฃู ุนูุงุฑุงุช ูุงุจูุฉ ููุชุทููุฑ
            โข ุฑูุฒ ุนูู ุงูููุงุทู ุฐุงุช ุงูุจููุฉ ุงูุชุญุชูุฉ ุงููุชุทูุฑุฉ
            โข ุงุญุณุจ ุชูุงููู ุงูุชุทููุฑ ุจุฏูุฉ ูุจู ุงูุงุณุชุซูุงุฑ
            โข ุงูุนุงุฆุฏ ุงููุชููุน: 25-40% ููุดุงุฑูุน ุงูุชุทููุฑ
            """)
        else:
            st.info("""
            **๐ก๏ธ ุชูุตูุงุช ุนุงูุฉ ููุงุณุชุซูุงุฑ ุงูุขูู:**
            โข ูููุน ุงุณุชุซูุงุฑุงุชู ุจูู ุนุฏุฉ ุฃุญูุงุก
            โข ุญุงูุธ ุนูู ุชูุงุฒู ุจูู ุงูุนุงุฆุฏ ููุณุชูู ุงูุฎุทูุฑุฉ
            โข ุงุณุชุดุฑ ุฎุจูุฑุงู ูุจู ุงุชุฎุงุฐ ุงููุฑุงุฑุงุช ุงููุจูุฑุฉ
            """)
        
        # ๐ ุงูุฑุณูู ุงูุจูุงููุฉ ุงููุชูุฏูุฉ
        st.subheader("๐ ุงูุชุญููู ุงูุจุตุฑู ุงููุชูุฏู")
        
        # ุงูุฑุณู ุงูุจูุงูู 1: ุงูุนูุงูุฉ ุจูู ุงููุณุงุญุฉ ูุงูุณุนุฑ
        fig, ax = plt.subplots(figsize=(12, 6))
        sns.scatterplot(data=df, x='ุงููุณุงุญุฉ', y='ุงูุณุนุฑ', hue='ูุณุชูู_ุงูุฎุทูุฑุฉ', 
                       palette={'ููุฎูุถ': 'green', 'ูุชูุณุท': 'orange', 'ูุฑุชูุน': 'red'}, 
                       alpha=0.7, s=100)
        plt.title(f'ุงูุนูุงูุฉ ุจูู ุงููุณุงุญุฉ ูุงูุณุนุฑ ุญุณุจ ูุณุชูู ุงูุฎุทูุฑุฉ\n{ุงููุฏููุฉ} - {ุงููุฏู_ุงูุงุณุชุซูุงุฑู}')
        plt.xlabel('ุงููุณุงุญุฉ (ูยฒ)')
        plt.ylabel('ุงูุณุนุฑ (ุฑูุงู)')
        st.pyplot(fig)
        
        # ุงูุฑุณู ุงูุจูุงูู 2: ุชูุฒูุน ุงูุนุงุฆุฏ ุญุณุจ ุงูุฎุทูุฑุฉ
        fig2, ax2 = plt.subplots(figsize=(10, 5))
        sns.boxplot(data=df, x='ูุณุชูู_ุงูุฎุทูุฑุฉ', y='ุงูุนุงุฆุฏ_ุงููุชููุน_ูช', palette='coolwarm')
        plt.title(f'ุชูุฒูุน ุงูุนุงุฆุฏ ุงููุชููุน ุญุณุจ ูุณุชูู ุงูุฎุทูุฑุฉ\n{ุงููุฏููุฉ}')
        plt.xlabel('ูุณุชูู ุงูุฎุทูุฑุฉ')
        plt.ylabel('ุงูุนุงุฆุฏ ุงููุชููุน (%)')
        st.pyplot(fig2)
        
        # ุฃูุถู 5 ุนูุงุฑุงุช ููุตู ุจูุง
        st.subheader("๐ ุฃูุถู 5 ุนูุงุฑุงุช ููุตู ุจูุง")
        ุฃูุถู_ุงูุนูุงุฑุงุช = df.nlargest(5, 'ุงูุนุงุฆุฏ_ุงููุชููุน_ูช')
        st.dataframe(ุฃูุถู_ุงูุนูุงุฑุงุช[['ุงูุนูุงุฑ', 'ุงูุญู', 'ุงูุณุนุฑ', 'ุงููุณุงุญุฉ', 'ุงูุนุงุฆุฏ_ุงููุชููุน_ูช', 'ูุณุชูู_ุงูุฎุทูุฑุฉ']])
        
        # ๐ค ุฎูุงุฑุงุช ุชุญููู ุงูุชูุฑูุฑ ูุน ุงูุชุงุฑูุฎ
        st.subheader("๐ฅ ุชุญููู ุงูุชูุฑูุฑ")
        
        now = datetime.now().strftime("%Y-%m-%d_%H-%M")
        
        col7, col8 = st.columns(2)
        
        with col7:
            # ุชุญููู Excel
            excel_buffer = BytesIO()
            ุฃูุถู_ุงูุนูุงุฑุงุช.to_excel(excel_buffer, index=False)
            st.download_button(
                label="๐ ุชุญููู ุงูุจูุงูุงุช Excel",
                data=excel_buffer.getvalue(),
                file_name=f"ุชูุฑูุฑ_{ุงุณู_ุงูุนููู}_{ุงููุฏููุฉ}_{now}.xlsx",
                mime="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
            )
        
        with col8:
            # ุชุญููู CSV
            csv_buffer = BytesIO()
            ุฃูุถู_ุงูุนูุงุฑุงุช.to_csv(csv_buffer, index=False, encoding='utf-8-sig')
            st.download_button(
                label="๐ ุชุญููู ุงูุจูุงูุงุช CSV",
                data=csv_buffer.getvalue(),
                file_name=f"ุชูุฑูุฑ_{ุงุณู_ุงูุนููู}_{ุงููุฏููุฉ}_{now}.csv",
                mime="text/csv"
            )

# ูุณู ุงูุฃุณุนุงุฑ
st.markdown("---")
st.subheader("๐ฐ ุงูุชุณุนูุฑ ุงููุชุฎุตุต")

col7, col8, col9 = st.columns(3)
with col7:
    st.metric("ุงูุจุงูุฉ ุงูุฃุณุงุณูุฉ", "500$", "ุชุญููู ูุชุฎุตุต + ุชูุตูุงุช")
with col8:
    st.metric("ุงูุจุงูุฉ ุงููุชูุฏูุฉ", "800$", "ุชูุตูุงุช ุงุณุชุฑุงุชูุฌูุฉ + ูุชุงุจุนุฉ")
with col9:
    st.metric("ุงูุจุงูุฉ ุงููููุฒุฉ", "1,200$", "ุฏุฑุงุณุฉ ุฌุฏูู ุดุงููุฉ + ุงุณุชุดุงุฑุฉ")

# โค๏ธ ููุณุฉ ุดุฎุตูุฉ ูู ุงูููุงูุฉ
st.markdown("---")
st.markdown("โจ ุดูุฑูุง ูุงุณุชุฎุฏุงูู ููุตุฉ **ูุฑุฏุฉ ุงูุนูุงุฑูุฉ**! ูุชุทูุน ูุฎุฏูุชู ูุฌุฏุฏูุง ๐")
st.markdown("๐ ููุชูุงุตู: warda@realestate.com | ๐ผ ูุชุฎุตุตูู ูู ุงูุชุญููู ุงูุงุณุชุซูุงุฑู ุงููุชูุฏู")
