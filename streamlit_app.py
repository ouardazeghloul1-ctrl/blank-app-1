mport streamlit as st
import pandas as pd
import numpy as np
from datetime import datetime, timedelta
import plotly.express as px
import plotly.graph_objects as go
from plotly.subplots import make_subplots
import hashlib
import time

# ุฅุนุฏุงุฏ ุงูุตูุญุฉ
st.set_page_config(page_title="ุงูุชุญููู ุงูุนูุงุฑู ุงูุฐูุจู | Warda Intelligence", layout="wide")

# ุชูุณูู ูุงุฌูุฉ ูุงุฎุฑุฉ
st.markdown("""
    <style>
    .main { background-color: #0E1117; color: gold; }
    .stApp { background-color: #0E1117; }
    h1, h2, h3, h4, h5, h6 { color: gold !important; }
    .stSelectbox label, .stSlider label, .stRadio label { color: gold !important; }
    .stButton>button {
        background-color: gold; color: black; font-weight: bold;
        border-radius: 10px; padding: 0.6em 1.2em; border: none;
        width: 100%;
    }
    .analysis-card {
        background: linear-gradient(135deg, #1a1a1a, #2d2d2d);
        padding: 20px; border-radius: 15px; border: 1px solid gold;
        margin: 10px 0; color: white;
    }
    .price-up { color: #00ff00; font-weight: bold; }
    .price-down { color: #ff4444; font-weight: bold; }
    .package-card {
        background: linear-gradient(135deg, #2d2d2d, #1a1a1a);
        padding: 15px; border-radius: 10px; border: 2px solid #d4af37;
        margin: 10px 0; text-align: center;
    }
    .admin-panel {
        background: linear-gradient(135deg, #1a2a3a, #2a3a4a);
        padding: 20px; border-radius: 15px; border: 2px solid #00ff00;
        margin: 10px 0;
    }
    .report-section {
        background: linear-gradient(135deg, #1e1e1e, #2a2a2a);
        padding: 25px; border-radius: 15px; border-left: 5px solid gold;
        margin: 15px 0; color: white;
    }
    .metric-card {
        background: linear-gradient(135deg, #2a2a2a, #3a3a3a);
        padding: 15px; border-radius: 10px; border: 1px solid #d4af37;
        margin: 10px; text-align: center;
    }
    </style>
""", unsafe_allow_html=True)

# ุงูุนููุงู ุงูุฑุฆูุณู
st.markdown("<h1 style='text-align: center; color: gold;'>๐๏ธ ููุตุฉ ุงูุชุญููู ุงูุนูุงุฑู ุงูุฐูุจู - Warda Intelligence</h1>", unsafe_allow_html=True)
st.markdown("<p style='text-align: center; color: #d4af37;'>ุชุญููู ุฐูู ูุฎุตุต ููู ูุฆุฉ - ูุฑุงุฑุงุช ุงุณุชุซูุงุฑูุฉ ูุฏุฑูุณุฉ</p>", unsafe_allow_html=True)

# === ูุธุงู ุงูุจุงูุงุช ูุงูุฃุณุนุงุฑ ===
PACKAGES = {
    "ูุฌุงููุฉ": {
        "price": 0,
        "features": [
            "ุชุญููู ุณูู ุฃุณุงุณู",
            "ุฃุณุนุงุฑ ูุชูุณุทุฉ ููููุทูุฉ", 
            "ุชูุฑูุฑ ูุตู ุจุณูุท",
            "ุตุงูุญ ูุนูุงุฑ ูุงุญุฏ"
        ]
    },
    "ูุถูุฉ": {
        "price": 29,
        "features": [
            "ูู ูููุฒุงุช ุงููุฌุงููุฉ +",
            "ุชุญููู ุชูุจุคู 6 ุฃุดูุฑ",
            "ููุงุฑูุฉ ูุน 5 ูุดุงุฑูุน ูุดุงุจูุฉ",
            "ูุตุงุฆุญ ุงุณุชุซูุงุฑูุฉ ูุชูุฏูุฉ",
            "ุชูุฑูุฑ PDF ุชูุงุนูู",
            "ุฑุณูู ุจูุงููุฉ ูุชุญุฑูุฉ",
            "ุชุญููู ุงูููุงูุณูู",
            "ุฏุฑุงุณุฉ ุงูุฌุฏูู ุงููุจุฏุฆูุฉ"
        ]
    },
    "ุฐูุจูุฉ": {
        "price": 79,
        "features": [
            "ูู ูููุฒุงุช ุงููุถูุฉ +", 
            "ุชุญููู ุฐูุงุก ุงุตุทูุงุนู ูุชูุฏู",
            "ุชูุจุคุงุช ููุฏุฉ ุณูุฉ ูุงููุฉ",
            "ุฏุฑุงุณุฉ ุงูุฌุฏูู ุงูุงูุชุตุงุฏูุฉ ุงูุดุงููุฉ",
            "ุชุญููู 10 ููุงูุณูู ุฑุฆูุณููู",
            "ูุตุงุฆุญ ูุฎุตุตุฉ ุญุณุจ ุงููุฆุฉ",
            "ูุคุดุฑุงุช ุฃุฏุงุก ููุตูุฉ",
            "ุชุญููู ุงููุฎุงุทุฑ ุงููุชูุฏู"
        ]
    },
    "ูุงุณูุฉ": {
        "price": 149,
        "features": [
            "ูู ูููุฒุงุช ุงูุฐูุจูุฉ +",
            "ุชุญููู ุดูููู ูุชูุงูู", 
            "ุชูุงุฑูุฑ ููุงุฑูุฉ ูุน ูู ุงููุฏู",
            "ุชุญููู ุงููุฎุงุทุฑุฉ ุงููุชูุฏู",
            "ุฎุทุฉ ุงุณุชุซูุงุฑูุฉ ุชูุตูููุฉ",
            "ูุญุงูุงุฉ ุณููุงุฑูููุงุช ูุชุนุฏุฏุฉ",
            "ุชุญููู ุชูููุช ุงูุณูู",
            "ุชูุตูุงุช ุงุณุชุฑุงุชูุฌูุฉ ุดุงููุฉ"
        ]
    }
}

# === ุจูุงูุงุช ุณูููุฉ ูุชูุฏูุฉ ===
def generate_advanced_market_data(city, property_type, status):
    """ุฅูุดุงุก ุจูุงูุงุช ุณูููุฉ ูุชูุฏูุฉ ูููุตูุฉ"""
    
    # ุฃุณุนุงุฑ ุฃุณุงุณูุฉ ููุตูุฉ
    base_prices = {
        "ุงูุฑูุงุถ": {
            "ุดูุฉ": {"ุณููู": 4500, "ูุงุฎุฑ": 6500, "ุงูุชุตุงุฏู": 3200},
            "ูููุง": {"ุณููู": 3200, "ูุงุฎุฑ": 4800, "ุงูุชุตุงุฏู": 2400},
            "ุฃุฑุถ": {"ุณููู": 1800, "ุชุฌุงุฑู": 3500, "ุงุณุชุซูุงุฑู": 2200},
            "ูุญู ุชุฌุงุฑู": {"ูุฑูุฒู": 8000, "ุชุฌุงุฑู": 6000, "ุญููู": 4500}
        },
        "ุฌุฏุฉ": {
            "ุดูุฉ": {"ุณููู": 3800, "ูุงุฎุฑ": 5500, "ุงูุชุตุงุฏู": 2800},
            "ูููุง": {"ุณููู": 2800, "ูุงุฎุฑ": 4200, "ุงูุชุตุงุฏู": 2000},
            "ุฃุฑุถ": {"ุณููู": 1500, "ุชุฌุงุฑู": 2800, "ุงุณุชุซูุงุฑู": 1800},
            "ูุญู ุชุฌุงุฑู": {"ูุฑูุฒู": 6500, "ุชุฌุงุฑู": 5000, "ุญููู": 3800}
        }
    }
    
    city_data = base_prices.get(city, base_prices["ุงูุฑูุงุถ"])
    property_data = city_data.get(property_type, {"ุณููู": 3000})
    avg_price = np.mean(list(property_data.values()))
    
    # ุชุฃุซูุฑ ุงูุญุงูุฉ ุนูู ุงูุณุนุฑ
    price_multiplier = 1.12 if status == "ููุจูุน" else 0.88 if status == "ููุดุฑุงุก" else 0.95
    
    return {
        'ุงูุณุนุฑ_ุงูุญุงูู': avg_price * price_multiplier,
        'ูุชูุณุท_ุงูุณูู': avg_price,
        'ุฃุนูู_ุณุนุฑ': avg_price * 1.35,
        'ุฃูู_ุณุนุฑ': avg_price * 0.75,
        'ุญุฌู_ุงูุชุฏุงูู_ุดูุฑู': np.random.randint(150, 600),
        'ูุนุฏู_ุงูููู_ุงูุดูุฑู': np.random.uniform(0.8, 3.5),
        'ุนุฑุถ_ุงูุนูุงุฑุงุช': np.random.randint(80, 250),
        'ุทุงูุจ_ุงูุดุฑุงุก': np.random.randint(120, 400),
        'ูุนุฏู_ุงูุฅุดุบุงู': np.random.uniform(75, 95),
        'ุงูุนุงุฆุฏ_ุงูุชุฃุฌูุฑู': np.random.uniform(6, 12),
        'ูุคุดุฑ_ุงูุณูููุฉ': np.random.uniform(60, 90)
    }

# === ุชุญูููุงุช ูุชูุฏูุฉ ููู ูุฆุฉ ===
def get_advanced_analysis_by_user_type(user_type, city, property_type, area, status):
    """ุชุญููู ูุชูุฏู ูููุตู ุญุณุจ ูุฆุฉ ุงููุณุชุฎุฏู"""
    
    analyses = {
        "ูุณุชุซูุฑ": {
            "title": "๐ ุงูุชุญููู ุงูุงุณุชุซูุงุฑู ุงูุดุงูู",
            "sections": {
                "ุงูุชุญููู_ุงููุงูู": """
                ## ๐ฐ ุงูุชุญููู ุงููุงูู ุงููุชูุฏู
                
                ### ๐ ูุคุดุฑุงุช ุงูุฃุฏุงุก ุงูุฑุฆูุณูุฉ (KPIs)
                | ุงููุคุดุฑ | ุงููููุฉ | ุงูุชูููู |
                |---------|--------|----------|
                | ุงูุนุงุฆุฏ ุนูู ุงูุงุณุชุซูุงุฑ (ROI) | 9.5% ุณูููุงู | ๐ข ููุชุงุฒ |
                | ุตุงูู ุงููููุฉ ุงูุญุงููุฉ (NPV) | +$45,000 | ๐ข ุฅูุฌุงุจู |
                | ูุนุฏู ุงูุนุงุฆุฏ ุงูุฏุงุฎูู (IRR) | 11.2% | ๐ข ุฌูุฏ |
                | ูุชุฑุฉ ุงุณุชุฑุฏุงุฏ ุฑุฃุณ ุงููุงู | 8.2 ุณูุฉ | ๐ก ูุชูุณุทุฉ |
                | ูุณุจุฉ ุงูุฏูู ุฅูู ุงูุญููู | 65% | ๐ข ููุจููุฉ |
                
                ### ๐ธ ุชุญููู ุงูุชุฏููุงุช ุงูููุฏูุฉ
                **ุงูุณูุฉ ุงูุฃููู:**
                - ุงูุฅูุฑุงุฏุงุช ุงูุดูุฑูุฉ ุงููุชููุนุฉ: $2,800
                - ุงููุตุฑููุงุช ุงูุชุดุบูููุฉ: $1,200  
                - ุตุงูู ุงูุชุฏูู ุงูุดูุฑู: $1,600
                - ุตุงูู ุงูุชุฏูู ุงูุณููู: $19,200
                
                **ุชููุนุงุช 5 ุณููุงุช:**
                - ุฅุฌูุงูู ุงูุฅูุฑุงุฏุงุช: $168,000
                - ุฅุฌูุงูู ุงููุตุฑููุงุช: $72,000
                - ุตุงูู ุงูุฑุจุญ ุงูุชุฑุงููู: $96,000
                """,
                
                "ุงุณุชุฑุงุชูุฌูุงุช_ุงูุงุณุชุซูุงุฑ": """
                ## ๐ฏ ุงุณุชุฑุงุชูุฌูุงุช ุงูุงุณุชุซูุงุฑ ุงููุชูุฏูุฉ
                
                ### ๐ ุงูุงุณุชุฑุงุชูุฌูุฉ ุงููุซูู: ุงูุดุฑุงุก ูุงูุชุฃุฌูุฑ ุทููู ุงูุฃุฌู
                
                **ุงููุฒุงูุง:**
                โ ุชุฏููุงุช ููุฏูุฉ ุดูุฑูุฉ ุซุงุจุชุฉ
                โ ุงุฑุชูุงุน ุงููููุฉ ุงูุณูููุฉ ูุน ุงูููุช  
                โ ุญูุงูุฉ ูู ุงูุชุถุฎู
                โ ุฅุนูุงุกุงุช ุถุฑูุจูุฉ ูุญุชููุฉ
                
                **ุฎุทุฉ ุงูุชูููุฐ:**
                1. **ุงูุดูุฑ 1-3:** ุงูุจุญุซ ูุงูุชูุงูุถ ุนูู 3-5 ุนูุงุฑุงุช
                2. **ุงูุดูุฑ 4-6:** ุงูุชูููู ูุงูุชุฌููุฒุงุช
                3. **ุงูุดูุฑ 7-9:** ุงูุชุฃุฌูุฑ ูุฅุฏุงุฑุฉ ุงูููุชููุงุช
                4. **ุงูุดูุฑ 10-12:** ุงูุชูููู ูุงูุชุนุฏูู
                
                ### ๐ ูุญูุธุฉ ุงูุงุณุชุซูุงุฑ ุงูููุชุฑุญุฉ
                | ููุน ุงูุนูุงุฑ | ุงููุณุจุฉ | ุงููุจูุบ | ุงูุนุงุฆุฏ ุงููุชููุน |
                |-------------|---------|---------|-----------------|
                | ุดูู ุณูููุฉ | 40% | $200,000 | 8-10% |
                | ูุญูุงุช ุชุฌุงุฑูุฉ | 30% | $150,000 | 10-12% |
                | ูููุงุช | 20% | $100,000 | 7-9% |
                | ุฃุฑุงุถู | 10% | $50,000 | 12-15% |
                """,
                
                "ุฅุฏุงุฑุฉ_ุงููุฎุงุทุฑ": """
                ## ๐ก๏ธ ุฅุฏุงุฑุฉ ุงููุฎุงุทุฑ ุงููุชูุฏูุฉ
                
                ### โ๏ธ ุชุญููู ุงููุฎุงุทุฑ ุงูุฑุฆูุณูุฉ
                
                **ูุฎุงุทุฑ ุงูุณูู (30%)**
                - ุชููุจุงุช ุฃุณุนุงุฑ ุงูุนูุงุฑุงุช
                - ุชุบูุฑ ุธุฑูู ุงูุงูุชุตุงุฏ ุงูููู
                - ููุงูุณุฉ ุฌุฏูุฏุฉ ูู ุงูููุทูุฉ
                
                **ูุฎุงุทุฑ ุงูุชุดุบูู (25%)**  
                - ุตุนูุจุฉ ูู ุฅูุฌุงุฏ ูุณุชุฃุฌุฑูู
                - ุชูุงููู ุตูุงูุฉ ุบูุฑ ูุชููุนุฉ
                - ูุดุงูู ูุงููููุฉ ูุฅุฏุงุฑูุฉ
                
                **ูุฎุงุทุฑ ุงูุชูููู (20%)**
                - ุงุฑุชูุงุน ุฃุณุนุงุฑ ุงููุงุฆุฏุฉ
                - ุตุนูุจุฉ ุฅุนุงุฏุฉ ุงูุชูููู
                - ุชุบูุฑ ุดุฑูุท ุงููุฑูุถ
                
                ### ๐ก๏ธ ุงุณุชุฑุงุชูุฌูุงุช ุงูุชุฎููู
                1. **ุงูุชูููุน ุงูุฌุบุฑุงูู:** ุงูุงุณุชุซูุงุฑ ูู 3 ููุงุทู ูุฎุชููุฉ
                2. **ุชุญูุท ุณุนุฑู:** ุนููุฏ ุฎูุงุฑุงุช ููุจูุน
                3. **ุงุญุชูุงุทู ููุฏู:** 6 ุฃุดูุฑ ูู ุงููุตุฑููุงุช
                4. **ุชุฃููู ุดุงูู:** ุถุฏ ุฌููุน ุงููุฎุงุทุฑ
                """,
                
                "ุงููุฑุต_ุงููุณุชูุจููุฉ": """
                ## ๐ ุงููุฑุต ุงูุงุณุชุซูุงุฑูุฉ ุงููุณุชูุจููุฉ
                
                ### ๐ฏ ุงูููุงุทู ุงููุงุนุฏุฉ ูู ุงูุฑูุงุถ
                
                **๐ ุงูููุทูุฉ ุงูุดูุงููุฉ (ูุดุฑูุน ุงููุฏูุฉ)**
                - ูุนุฏู ููู ูุชููุน: 15% ุณูููุงู
                - ูุดุงุฑูุน ุชุทููุฑ ูุจุฑู ููุฏ ุงูุฅูุดุงุก
                - ุทูุจ ูุชุฒุงูุฏ ุนูู ุงููุญุฏุงุช ุงูุณูููุฉ
                
                **๐๏ธ ุงูููุทูุฉ ุงููุฑูุฒูุฉ (ุงููุฑุจุน)**
                - ุฃุณุนุงุฑ ูุณุชูุฑุฉ ููุถูููุฉ
                - ุทูุจ ุฏุงุฆู ูู ุงูููุธููู ุงูุญูููููู
                - ุฅุดุบุงู ูุฑุชูุน ุนูู ูุฏุงุฑ ุงูุณูุฉ
                
                **๐ ุชููุนุงุช ุงูุฐูุงุก ุงูุงุตุทูุงุนู**
                - ููู ุงูุณูู ุงูุนูุงุฑู: 7.8% ุฎูุงู 2024
                - ุงุฑุชูุงุน ุฃุณุนุงุฑ ุงูููุงุฏ: 4.2% 
                - ุฒูุงุฏุฉ ุงูุทูุจ ุงูุณููู: 12.5%
                """
            }
        }
    }
    
    return analyses.get(user_type, analyses["ูุณุชุซูุฑ"])

# === ุชูููุฏ ุชูุฑูุฑ ูุชูุฏู ูุน ุตูุญุงุช ูุชุนุฏุฏุฉ ===
def generate_advanced_report(user_type, city, property_type, area, status, package, property_count):
    """ุชูููุฏ ุชูุฑูุฑ ูุชูุฏู ูุน ุตูุญุงุช ูุฌุฏุงูู ููุคุดุฑุงุช ูุจูุฑุฉ"""
    
    # ุญุณุงุจ ุงูุณุนุฑ
    base_price = PACKAGES[package]["price"]
    total_price = base_price * property_count
    
    # ุจูุงูุงุช ุงูุณูู ุงููุชูุฏูุฉ
    market_data = generate_advanced_market_data(city, property_type, status)
    
    # ุงูุชุญููู ุงููุชูุฏู
    advanced_analysis = get_advanced_analysis_by_user_type(user_type, city, property_type, area, status)
    
    # ุฅูุดุงุก ุงูุชูุฑูุฑ ุงููุชุนุฏุฏ ุงูุตูุญุงุช
    report_content = []
    
    # ุงูุตูุญุฉ 1: ุงูุบูุงู ูุงูููุฏูุฉ
    cover_page = f"""
    ๐๏ธ ุชูุฑูุฑ Warda Intelligence ุงููุชูุฏู
    {'=' * 60}
    
    ๐ **ุงูุชูุฑูุฑ ุงูุงุณุชุซูุงุฑู ุงูุดุงูู**
    ๐ฏ ูุฎุตุต ููุฆุฉ: {user_type}
    ๐๏ธ ุงูููุทูุฉ: {city}
    ๐ ููุน ุงูุนูุงุฑ: {property_type}
    
    ๐ ุชุงุฑูุฎ ุงูุฅุตุฏุงุฑ: {datetime.now().strftime('%Y-%m-%d')}
    โฐ ููุช ุงูุฅูุดุงุก: {datetime.now().strftime('%H:%M')}
    ๐ข ุฑูู ุงูุชูุฑูุฑ: WR-{datetime.now().strftime('%Y%m%d%H%M')}
    
    ๐ผ **ูุนูููุงุช ุงูุนููู:**
    โโ ๐ท๏ธ ุงููุฆุฉ: {user_type}
    โโ ๐๏ธ ุงููุฏููุฉ: {city} 
    โโ ๐ ููุน ุงูุนูุงุฑ: {property_type}
    โโ ๐ ุงููุณุงุญุฉ: {area} ูยฒ
    โโ ๐ ุงูุญุงูุฉ: {status}
    โโ ๐ข ุนุฏุฏ ุงูุนูุงุฑุงุช: {property_count}
    โโ ๐ ุงูุจุงูุฉ: {package}
    โโ ๐ฐ ุงููููุฉ: {total_price} ุฏููุงุฑ
    
    ๐ **ููุฎุต ุงูุฃุฏุงุก:**
    โโ ๐ ุชุตููู ุงูุงุณุชุซูุงุฑ: {'๐ข ููุชุงุฒ' if market_data['ุงูุนุงุฆุฏ_ุงูุชุฃุฌูุฑู'] > 8 else '๐ก ุฌูุฏ'}
    โโ ๐ธ ุงูุนุงุฆุฏ ุงููุชููุน: {market_data['ุงูุนุงุฆุฏ_ุงูุชุฃุฌูุฑู']:.1f}% ุณูููุงู
    โโ ๐ ููู ุฑุฃุณ ุงููุงู: {market_data['ูุนุฏู_ุงูููู_ุงูุดูุฑู']*12:.1f}% ุณูููุงู
    โโ ๐ก๏ธ ูุณุชูู ุงููุฎุงุทุฑุฉ: {np.random.randint(15, 35)}%
    โโ โญ ุงูุชูุตูุฉ: {'๐ข ุดุฑุงุก ูุณุชุนุฌู' if market_data['ูุนุฏู_ุงูููู_ุงูุดูุฑู'] > 2 else '๐ก ุดุฑุงุก ูุฏุฑูุณ'}
    
    {'=' * 60}
    """
    report_content.append(cover_page)
    
    # ุงูุตูุญุฉ 2: ุงูุชุญููู ุงููุงูู
    financial_page = f"""
    ๐ ุงูุตูุญุฉ 2: ุงูุชุญููู ุงููุงูู ุงููุชูุฏู
    {'=' * 60}
    
    {advanced_analysis['sections']['ุงูุชุญููู_ุงููุงูู']}
    
    ๐น **ูุคุดุฑุงุช ุงูุณูู ุงููุงููุฉ:**
    
    ๐ **ููุงุฑูุฉ ุงูุฃุฏุงุก ูุน ุงููุคุดุฑุงุช ุงูููุงุณูุฉ:**
    | ุงููุคุดุฑ | ุฃุฏุงุคู | ูุชูุณุท ุงูุณูู | ุงูุชุตููู |
    |---------|--------|-------------|----------|
    | ุงูุนุงุฆุฏ ุนูู ุงูุงุณุชุซูุงุฑ | {market_data['ุงูุนุงุฆุฏ_ุงูุชุฃุฌูุฑู']:.1f}% | 7.2% | ๐ข +{market_data['ุงูุนุงุฆุฏ_ุงูุชุฃุฌูุฑู']-7.2:.1f}% |
    | ูุนุฏู ุงูููู | {market_data['ูุนุฏู_ุงูููู_ุงูุดูุฑู']*12:.1f}% | 6.5% | ๐ข +{(market_data['ูุนุฏู_ุงูููู_ุงูุดูุฑู']*12)-6.5:.1f}% |
    | ุงูุณูููุฉ | {market_data['ูุคุดุฑ_ุงูุณูููุฉ']:.0f}% | 70% | ๐ข +{market_data['ูุคุดุฑ_ุงูุณูููุฉ']-70:.0f}% |
    | ุงูุฅุดุบุงู | {market_data['ูุนุฏู_ุงูุฅุดุบุงู']:.1f}% | 82% | ๐ข +{market_data['ูุนุฏู_ุงูุฅุดุบุงู']-82:.1f}% |
    
    ๐ฐ **ุชุญููู ุงููููุฉ ุงูุณูููุฉ:**
    โโ ๐ต ุงููููุฉ ุงูุญุงููุฉ: {market_data['ุงูุณุนุฑ_ุงูุญุงูู'] * area:,.0f} ุฑูุงู
    โโ ๐ ุงููููุฉ ุจุนุฏ ุณูุฉ: {market_data['ุงูุณุนุฑ_ุงูุญุงูู'] * area * 1.08:,.0f} ุฑูุงู
    โโ ๐ฏ ุงููููุฉ ุจุนุฏ 3 ุณููุงุช: {market_data['ุงูุณุนุฑ_ุงูุญุงูู'] * area * 1.25:,.0f} ุฑูุงู
    โโ ๐ ุงููููุฉ ุจุนุฏ 5 ุณููุงุช: {market_data['ุงูุณุนุฑ_ุงูุญุงูู'] * area * 1.45:,.0f} ุฑูุงู
    
    {'=' * 60}
    """
    report_content.append(financial_page)
    
    # ุงูุตูุญุฉ 3: ุงุณุชุฑุงุชูุฌูุงุช ุงูุงุณุชุซูุงุฑ
    strategy_page = f"""
    ๐ ุงูุตูุญุฉ 3: ุงุณุชุฑุงุชูุฌูุงุช ุงูุงุณุชุซูุงุฑ ุงููุชูุฏูุฉ  
    {'=' * 60}
    
    {advanced_analysis['sections']['ุงุณุชุฑุงุชูุฌูุงุช_ุงูุงุณุชุซูุงุฑ']}
    
    ๐ฒ **ุณููุงุฑูููุงุช ุงูุงุณุชุซูุงุฑ:**
    
    **๐ ุงูุณููุงุฑูู ุงููุชูุงุฆู (+15%):**
    โโ ููู ุงูุณูู: 12% ุณูููุงู
    โโ ุงูุนูุงุฆุฏ: 11-14% 
    โโ ุงูุณูููุฉ: ุนุงููุฉ ุฌุฏุงู
    โโ ุงูุชูุตูุฉ: ุฒูุงุฏุฉ ุงูุงุณุชุซูุงุฑ 20%
    
    **โ๏ธ ุงูุณููุงุฑูู ุงููุชูุณุท (+8%):**
    โโ ููู ุงูุณูู: 7% ุณูููุงู
    โโ ุงูุนูุงุฆุฏ: 8-10%
    โโ ุงูุณูููุฉ: ูุชูุณุทุฉ
    โโ ุงูุชูุตูุฉ: ุงูุญูุงุธ ุนูู ุงููุณุชูู ุงูุญุงูู
    
    **๐ ุงูุณููุงุฑูู ุงููุชุญูุธ (+3%):**
    โโ ููู ุงูุณูู: 2% ุณูููุงู  
    โโ ุงูุนูุงุฆุฏ: 5-7%
    โโ ุงูุณูููุฉ: ููุฎูุถุฉ
    โโ ุงูุชูุตูุฉ: ุชูููู ุงูุชุนุฑุถ 15%
    
    {'=' * 60}
    """
    report_content.append(strategy_page)
    
    # ุงูุตูุญุฉ 4: ุฅุฏุงุฑุฉ ุงููุฎุงุทุฑ
    risk_page = f"""
    ๐ ุงูุตูุญุฉ 4: ุฅุฏุงุฑุฉ ุงููุฎุงุทุฑ ุงููุชูุฏูุฉ
    {'=' * 60}
    
    {advanced_analysis['sections']['ุฅุฏุงุฑุฉ_ุงููุฎุงุทุฑ']}
    
    ๐ฏ **ูุตูููุฉ ุงููุฎุงุทุฑ ูุงูุนุงุฆุฏ:**
    
    **๐ข ููุทูุฉ ุงูุฎุถุฑุงุก (ูุฎุงุทุฑุฉ ููุฎูุถุฉ - ุนุงุฆุฏ ูุชูุณุท)**
    โโ ุงูุนูุงุฑุงุช ุงูุณูููุฉ ูู ุงูุฃุญูุงุก ุงูุฑุงููุฉ
    โโ ุงููุญูุงุช ุงูุชุฌุงุฑูุฉ ูู ุงููุฑุงูุฒ ุงูุฑุฆูุณูุฉ
    โโ ูุชูุณุท ุงูุนุงุฆุฏ: 6-8% ุณูููุงู
    โโ ุงูุชูุตูุฉ: 60% ูู ุงููุญูุธุฉ
    
    **๐ก ููุทูุฉ ุงูุตูุฑุงุก (ูุฎุงุทุฑุฉ ูุชูุณุทุฉ - ุนุงุฆุฏ ุฌูุฏ)**
    โโ ุงูุฃุฑุงุถู ูู ููุงุทู ุงูุชุทููุฑ
    โโ ุงููุดุงุฑูุน ุชุญุช ุงูุฅูุดุงุก
    โโ ูุชูุณุท ุงูุนุงุฆุฏ: 8-12% ุณูููุงู  
    โโ ุงูุชูุตูุฉ: 30% ูู ุงููุญูุธุฉ
    
    **๐ด ููุทูุฉ ุงูุญูุฑุงุก (ูุฎุงุทุฑุฉ ุนุงููุฉ - ุนุงุฆุฏ ูุฑุชูุน)**
    โโ ุงูุนูุงุฑุงุช ุงููุชุฎุตุตุฉ
    โโ ุงูููุงุทู ุงููุงููุฉ ุญุฏูุซุงู
    โโ ูุชูุณุท ุงูุนุงุฆุฏ: 12-18% ุณูููุงู
    โโ ุงูุชูุตูุฉ: 10% ูู ุงููุญูุธุฉ
    
    {'=' * 60}
    """
    report_content.append(risk_page)
    
    # ุงูุตูุญุฉ 5: ุงููุฑุต ุงููุณุชูุจููุฉ
    opportunities_page = f"""
    ๐ ุงูุตูุญุฉ 5: ุงููุฑุต ุงูุงุณุชุซูุงุฑูุฉ ุงููุณุชูุจููุฉ
    {'=' * 60}
    
    {advanced_analysis['sections']['ุงููุฑุต_ุงููุณุชูุจููุฉ']}
    
    ๐ **ุฃูุถู 5 ูุฑุต ุงุณุชุซูุงุฑูุฉ ูู {city}:**
    
    **๐ฅ ุงููุฑุตุฉ ุงูุฃููู: ูุดุฑูุน ูููู (ุงูููุทูุฉ ุงูุดูุงููุฉ)**
    โโ ๐ ูุนุฏู ุงูููู ุงููุชููุน: 18% ุณูููุงู
    โโ ๐ฐ ุญุฌู ุงูุงุณุชุซูุงุฑุงุช: $500 ูููุงุฑ
    โโ ๐ฏ ุงูุชูููุช: 2024-2026
    โโ โ๏ธ ุงููุฎุงุทุฑุฉ: ูุชูุณุทุฉ
    โโ ๐ก ุงูุชูุตูุฉ: ุงูุงุณุชุซูุงุฑ ุงููุจูุฑ
    
    **๐ฅ ุงููุฑุตุฉ ุงูุซุงููุฉ: ุงูุฏุฑุนูุฉ ุงูุชุงุฑูุฎูุฉ**
    โโ ๐ ูุนุฏู ุงูููู ุงููุชููุน: 14% ุณูููุงู  
    โโ ๐ฐ ุญุฌู ุงูุงุณุชุซูุงุฑุงุช: $50 ูููุงุฑ
    โโ ๐ฏ ุงูุชูููุช: 2024-2025
    โโ โ๏ธ ุงููุฎุงุทุฑุฉ: ููุฎูุถุฉ
    โโ ๐ก ุงูุชูุตูุฉ: ุงูุงุณุชุซูุงุฑ ุงููุชูุณุท
    
    **๐ฅ ุงููุฑุตุฉ ุงูุซุงูุซุฉ: ุงููุทุงุน ุงููุงูู (ุงููุฑูุฒ ุงููุงูู)**
    โโ ๐ ูุนุฏู ุงูููู ุงููุชููุน: 12% ุณูููุงู
    โโ ๐ฐ ุญุฌู ุงูุงุณุชุซูุงุฑุงุช: $30 ูููุงุฑ
    โโ ๐ฏ ุงูุชูููุช: 2024-2027
    โโ โ๏ธ ุงููุฎุงุทุฑุฉ: ููุฎูุถุฉ
    โโ ๐ก ุงูุชูุตูุฉ: ุงูุงุณุชุซูุงุฑ ุงูุขูู
    
    **๐ ุงููุฑุตุฉ ุงูุฑุงุจุนุฉ: ุงููุทุงุน ุงูุชุนูููู (ูุฏููุฉ ุงูุฌุงูุนุงุช)**
    โโ ๐ ูุนุฏู ุงูููู ุงููุชููุน: 10% ุณูููุงู
    โโ ๐ฐ ุญุฌู ุงูุงุณุชุซูุงุฑุงุช: $20 ูููุงุฑ
    โโ ๐ฏ ุงูุชูููุช: 2024-2028
    โโ โ๏ธ ุงููุฎุงุทุฑุฉ: ููุฎูุถุฉ ุฌุฏุงู
    โโ ๐ก ุงูุชูุตูุฉ: ุงูุงุณุชุซูุงุฑ ุทููู ุงูุฃุฌู
    
    **๐๏ธ ุงููุฑุตุฉ ุงูุฎุงูุณุฉ: ุงูุฅุณูุงู ุงูุงูุชุตุงุฏู**
    โโ ๐ ูุนุฏู ุงูููู ุงููุชููุน: 9% ุณูููุงู
    โโ ๐ฐ ุญุฌู ุงูุงุณุชุซูุงุฑุงุช: $40 ูููุงุฑ
    โโ ๐ฏ ุงูุชูููุช: 2024-2026
    โโ โ๏ธ ุงููุฎุงุทุฑุฉ: ููุฎูุถุฉ
    โโ ๐ก ุงูุชูุตูุฉ: ุงูุงุณุชุซูุงุฑ ุงูุฌูุงุนู
    
    {'=' * 60}
    """
    report_content.append(opportunities_page)
    
    return "\n\n".join(report_content), total_price

# === ุงููุงุฌูุฉ ุงูุฑุฆูุณูุฉ ===
col1, col2 = st.columns([1, 1])

with col1:
    st.markdown("### ๐ค ุจูุงูุงุช ุงููุณุชุฎุฏู")
    
    user_type = st.selectbox("ุงุฎุชุฑ ูุฆุชู:", 
                           ["ูุณุชุซูุฑ", "ูุณูุท ุนูุงุฑู", "ุดุฑูุฉ ุชุทููุฑ", "ูุฑุฏ", "ุจุงุญุซ ุนู ูุฑุตุฉ", "ูุงูู ุนูุงุฑ"])
    
    city = st.selectbox("ุงููุฏููุฉ:", 
                       ["ุงูุฑูุงุถ", "ุฌุฏุฉ", "ุงูุฏูุงู", "ููุฉ ุงูููุฑูุฉ", "ุงููุฏููุฉ ุงููููุฑุฉ", "ุงูุฎุจุฑ", "ุชุจูู", "ุงูุทุงุฆู"])
    
    property_type = st.selectbox("ููุน ุงูุนูุงุฑ:", 
                                ["ุดูุฉ", "ูููุง", "ุฃุฑุถ", "ูุญู ุชุฌุงุฑู"])
    
    status = st.selectbox("ุงูุญุงูุฉ:", ["ููุจูุน", "ููุดุฑุงุก", "ููุฅูุฌุงุฑ"])
    
    area = st.slider("ุงููุณุงุญุฉ (ูยฒ):", 50, 1000, 120)

with col2:
    st.markdown("### ๐ ุงุฎุชูุงุฑ ุงูุจุงูุฉ")
    
    # ุนุฏุฏ ุงูุนูุงุฑุงุช ูุน ุชุญุฏูุซ ุงูุณุนุฑ ุชููุงุฆูุงู
    property_count = st.slider("๐ข ุนุฏุฏ ุงูุนูุงุฑุงุช ููุชุญููู:", 1, 50, 1,
                              help="ูููุง ุฒุงุฏ ุนุฏุฏ ุงูุนูุงุฑุงุชุ ุฒุงุฏุช ุฏูุฉ ุงูุชุญููู ูุงูุณุนุฑ")
    
    # ุนุฑุถ ุงูุจุงูุงุช
    chosen_pkg = st.radio("ุงุฎุชุฑ ุจุงูุชู:", list(PACKAGES.keys()))
    
    # ุญุณุงุจ ุงูุณุนุฑ ุงูุฏููุงูููู
    base_price = PACKAGES[chosen_pkg]["price"]
    total_price = base_price * property_count
    
    # ุนุฑุถ ุชูุงุตูู ุงูุจุงูุฉ
    st.markdown(f"""
    <div class='package-card'>
    <h3>ุจุงูุฉ {chosen_pkg}</h3>
    <h4>{total_price} ุฏููุงุฑ</h4>
    </div>
    """, unsafe_allow_html=True)
    
    # ุนุฑุถ ุงููููุฒุงุช
    st.markdown("**ุงููููุฒุงุช:**")
    for feature in PACKAGES[chosen_pkg]["features"]:
        st.write(f"โ {feature}")

# === ูุธุงู ุงูุฏูุน ===
st.markdown("---")
st.markdown(f"### ๐ฐ ุงูุณุนุฑ ุงูููุงุฆู: **{total_price} ุฏููุงุฑ**")

# ุฒุฑ ุงูุฏูุน ุจุงู ุจุงู
paypal_html = f"""
<form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
<input type="hidden" name="cmd" value="_xclick">
<input type="hidden" name="business" value="warda.intelligence@gmail.com">
<input type="hidden" name="item_name" value="ุชูุฑูุฑ {chosen_pkg} - {property_count} ุนูุงุฑ">
<input type="hidden" name="amount" value="{total_price}">
<input type="hidden" name="currency_code" value="USD">
<input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_buynowCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!" style="display: block; margin: 0 auto;">
</form>
"""

st.markdown(paypal_html, unsafe_allow_html=True)

# === ุฒุฑ ูุงุญุฏ ูุฅูุดุงุก ุงูุชูุฑูุฑ ===
st.markdown("---")
st.markdown("### ๐ ุฅูุดุงุก ุงูุชูุฑูุฑ")

col1, col2 = st.columns(2)

with col1:
    # ุฒุฑ ูููุณุคูู (ุจุฏูู ุฏูุน)
    if st.button("๐ฏ ุฅูุดุงุก ุงูุชูุฑูุฑ (ูููุณุคูู)", use_container_width=True):
        with st.spinner("๐ ุฌุงุฑู ุฅูุดุงุก ุงูุชูุฑูุฑ ุงููุชูุฏู..."):
            time.sleep(3)
            
            # ุฅูุดุงุก ุงูุชูุฑูุฑ ุงููุชูุฏู
            report, final_price = generate_advanced_report(
                user_type, city, property_type, area, status, chosen_pkg, property_count
            )
            
            # ุญูุธ ุงูุชูุฑูุฑ ูู ุงูุฌูุณุฉ
            st.session_state.current_report = report
            st.session_state.report_generated = True
            st.success("โ ุชู ุฅูุดุงุก ุงูุชูุฑูุฑ ุงููุชูุฏู!")

with col2:
    # ุฒุฑ ููุนููู (ุจุนุฏ ุงูุฏูุน)
    if st.button("๐ฅ ุชุญููู ุงูุชูุฑูุฑ (ุจุนุฏ ุงูุฏูุน)", use_container_width=True):
        if hasattr(st.session_state, 'current_report'):
            st.success("โ ุชู ุชุญููู ุงูุชูุฑูุฑ")
        else:
            st.warning("โ๏ธ ูุฑุฌู ุฅุชูุงู ุนูููุฉ ุงูุฏูุน ุฃููุงู")

# === ุนุฑุถ ุงูุชูุฑูุฑ ูุฒุฑ ุงูุชุญููู ===
if st.session_state.get('report_generated', False):
    st.markdown("---")
    st.markdown("## ๐ ุงูุชูุฑูุฑ ุงูููุงุฆู ุงููุชูุฏู")
    
    # ุนุฑุถ ุงูุชูุฑูุฑ
    st.text_area("ูุญุชูู ุงูุชูุฑูุฑ:", st.session_state.current_report, height=600)
    
    # ุฒุฑ ุชุญููู ุงูุชูุฑูุฑ
    st.download_button(
        label="๐ฅ ุชุญููู ุงูุชูุฑูุฑ ุงููุงูู (PDF)",
        data=st.session_state.current_report,
        file_name=f"ุชูุฑูุฑ_ูุชูุฏู_{user_type}_{city}_{datetime.now().strftime('%Y%m%d_%H%M')}.txt",
        mime="text/plain",
        use_container_width=True
    )
    
    st.success("๐ ุชู ุฅูุดุงุก ุงูุชูุฑูุฑ ุงููุชูุฏู ุจูุฌุงุญ! ูุญุชูู ุนูู 5 ุตูุญุงุช ูู ุงูุชุญููู ุงูุดุงูู")
    st.balloons()

# === ููุญุฉ ุงููุณุคูู ===
admin_password = st.sidebar.text_input("ูููุฉ ูุฑูุฑ ุงููุณุคูู:", type="password")
if admin_password == "WardaAdmin2024":
    st.sidebar.success("๐ ูุฑุญุจุงู ุจู ูู ููุญุฉ ุงูุชุญูู!")
    
    # ููุญุฉ ุชุญูู ุงููุณุคูู
    st.sidebar.markdown("### ๐๏ธ ููุญุฉ ุชุญูู ุงููุณุคูู")
    
    if st.sidebar.button("๐ ุฅูุดุงุก ุฑุงุจุท ูุคุซุฑูู ุฌุฏูุฏ"):
        today = datetime.now().strftime("%Y%m%d")
        influencer_token = hashlib.md5(f"FREE1_{today}_{np.random.randint(1000,9999)}".encode()).hexdigest()[:10]
        st.session_state.influencer_url = f"https://warda-intelligence.streamlit.app/?promo={influencer_token}"
        st.sidebar.success("โ ุชู ุฅูุดุงุก ุงูุฑุงุจุท ุงูุฌุฏูุฏ")
    
    if hasattr(st.session_state, 'influencer_url'):
        st.sidebar.markdown(f"**ุฑุงุจุท ุงููุคุซุฑูู:**")
        st.sidebar.code(st.session_state.influencer_url)

# === ุฑุงุจุท ุงููุคุซุฑูู (ููุฒูุงุฑ ุงูุนุงุฏููู) ===
st.markdown("---")
st.markdown("### ๐ ุนุฑุถ ุงููุคุซุฑูู")

# ุงูุชุญูู ูู ุฑุงุจุท ุงููุคุซุฑูู
query_params = st.experimental_get_query_params()
if query_params.get('promo'):
    promo_token = query_params['promo'][0]
    st.success("๐ ุชู ุชูุนูู ุงูุนุฑุถ ุงููุฌุงูู ูููุคุซุฑูู!")
    
    # ุงุณุชุฎุฏุงู ุจูุงูุงุช ุงูุชุฑุงุถูุฉ ููุชูุฑูุฑ ุงููุฌุงูู
    free_user_type = "ูุคุซุฑ"
    free_city = "ุงูุฑูุงุถ" 
    free_property_type = "ุดูุฉ"
    free_area = 120
    free_status = "ููุจูุน"
    free_package = "ุฐูุจูุฉ"
    free_count = 1
    
    if st.button("๐ ุงูุญุตูู ุนูู ุงูุชูุฑูุฑ ุงููุฌุงูู", use_container_width=True):
        report, _ = generate_advanced_report(
            free_user_type, free_city, free_property_type, free_area, free_status, free_package, free_count
        )
        
        st.download_button(
            label="๐ฅ ุชุญููู ุงูุชูุฑูุฑ ุงููุฌุงูู",
            data=report,
            file_name=f"ุชูุฑูุฑ_ูุฌุงูู_ููุคุซุฑ_{datetime.now().strftime('%Y%m%d')}.txt",
            mime="text/plain",
            use_container_width=True
        )
else:
    st.info("""
    **ูููุคุซุฑูู:** 
    ููุญุตูู ุนูู ุชูุฑูุฑ ูุฌุงููุ ูุฑุฌู ุงุณุชุฎุฏุงู ุงูุฑุงุจุท ุงูุฎุงุต ุงูุฐู ุชู ุชูููุฑู ูู ุฅุฏุงุฑุฉ ุงูููุตุฉ.
    """)

# === ูุนูููุงุช ุงูุงุชุตุงู ===
st.markdown("---")
st.markdown("### ๐ ููุชูุงุตู ูุน Warda Intelligence")

col1, col2 = st.columns(2)

with col1:
    st.markdown("""
    **๐ฌ ูุงุชุณุงุจ:**
    +213779888140
    
    **๐ง ุงูุจุฑูุฏ:**
    info@warda-intelligence.com
    """)

with col2:
    st.markdown("""
    **๐ ุงููููุน:**
    www.warda-intelligence.com
    
    **๐ ุณุงุนุงุช ุงูุนูู:**
    9:00 ุต - 6:00 ู
    """)
