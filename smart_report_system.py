# smart_report_system.py - ุงููุธุงู ุงูุฐูู ููุชูุงุฑูุฑ ุญุณุจ ุงููุฆุฉ ูุงูุจุงูุฉ
import pandas as pd
import numpy as np
from datetime import datetime, timedelta
import matplotlib.pyplot as plt
from io import BytesIO
import arabic_reshaper
from bidi.algorithm import get_display
import math

def safe_num(val, fmt=",.0f", default="N/A"):
    """ุชุฑุฌุน ูููุฉ ููุณูุฉ ุฃู ูููุฉ ุงูุชุฑุงุถูุฉ ุฅุฐุง ูุงู val ุบูุฑ ุตุงูุญ."""
    try:
        if val is None:
            return default
        if isinstance(val, (list, tuple, set)):
            return default
        if isinstance(val, float) and math.isnan(val):
            return default
        return format(val, fmt)
    except Exception:
        return default

class SmartReportSystem:
    def __init__(self):
        self.user_profiles = {
            "ูุณุชุซูุฑ": self._investor_report,
            "ูุณูุท ุนูุงุฑู": self._broker_report, 
            "ุดุฑูุฉ ุชุทููุฑ": self._developer_report,
            "ูุฑุฏ": self._individual_report,
            "ุจุงุญุซ ุนู ูุฑุตุฉ": self._opportunity_seeker_report,
            "ูุงูู ุนูุงุฑ": self._property_owner_report
        }
        
        self.package_features = {
            "ูุฌุงููุฉ": {"pages": 15, "analysis_depth": "basic", "charts": 3},
            "ูุถูุฉ": {"pages": 35, "analysis_depth": "advanced", "charts": 8},
            "ุฐูุจูุฉ": {"pages": 60, "analysis_depth": "premium", "charts": 15},
            "ูุงุณูุฉ": {"pages": 90, "analysis_depth": "vip", "charts": 25}
        }
        
        # ๐ฏ ูุธุงู ุงููุฏู ุงูุฐูู - ูุชูุงูู ูุน ุงูุณูุฑูุจุฑ
        self.city_insights = {
            "ุงูุฑูุงุถ": {
                "growth_trend": 2.8,
                "strength": "ุฑุคูุฉ 2030 ูุงููุดุงุฑูุน ุงููุจุฑู",
                "opportunity": "ุงูุชุญูู ุงูุงูุชุตุงุฏู ูุงูููู ุงูุณูุงูู",
                "description": "ุงูุนุงุตูุฉ ุงูุงูุชุตุงุฏูุฉ ูุงูููุจ ุงููุงุจุถ ููููููุฉ"
            },
            "ุฌุฏุฉ": {
                "growth_trend": 2.2,
                "strength": "ุงููููุน ุงูุงุณุชุฑุงุชูุฌู ูุงููุดุงุฑูุน ุงูุณูุงุญูุฉ", 
                "opportunity": "ุงูุงุณุชุซูุงุฑุงุช ุงููุจุฑู ูุงูุจููุฉ ุงูุชุญุชูุฉ",
                "description": "ุนุฑูุณ ุงูุจุญุฑ ุงูุฃุญูุฑ ูุงูุนุงุตูุฉ ุงูุชุฌุงุฑูุฉ"
            },
            "ููุฉ": {
                "growth_trend": 2.5,
                "strength": "ุงููููุน ุงูุฏููู ูุงูุทูุจ ุงููุณุชูุฑ",
                "opportunity": "ุงููุดุงุฑูุน ุงูุชููููุฉ ูุงูุฎุฏูุงุช",
                "description": "ุฃุทูุฑ ุจูุงุน ุงูุฃุฑุถ ูุงูุนุงุตูุฉ ุงูุฏูููุฉ ุงูุนุงูููุฉ"
            },
            "ุงููุฏููุฉ": {
                "growth_trend": 2.1,
                "strength": "ุงูุงุณุชูุฑุงุฑ ุงูุณููู ูุงููููุน ุงูุฏููู",
                "opportunity": "ุงูุชูุณุน ุงูุนูุฑุงูู ูุงูุฎุฏูุงุช",
                "description": "ูุฏููุฉ ุงููุจู ุตูู ุงููู ุนููู ูุณูู - ุทูุจุฉ ุงูุทูุจุฉ"
            },
            "ุงูุฏูุงู": {
                "growth_trend": 1.9,
                "strength": "ุงูุชูููุน ุงูุงูุชุตุงุฏู ูุงููููุน ุงูุงุณุชุฑุงุชูุฌู",
                "opportunity": "ุงููุดุงุฑูุน ุงูุตูุงุนูุฉ ูุงูููุฌุณุชูุฉ",
                "description": "ุนุงุตูุฉ ุงูููุทูุฉ ุงูุดุฑููุฉ ูุงูููุจ ุงููุงุจุถ ููุทุงูุฉ"
            }
        }
        
        # ๐ ูุธุงู ุงููุญุชูู ุงูููุณุน
        self.extended_content = {
            "ูุณุชุซูุฑ": self._extended_investor_content,
            "ูุณูุท ุนูุงุฑู": self._extended_broker_content,
            "ุดุฑูุฉ ุชุทููุฑ": self._extended_developer_content,
            "ูุฑุฏ": self._extended_individual_content,
            "ุจุงุญุซ ุนู ูุฑุตุฉ": self._extended_opportunity_content,
            "ูุงูู ุนูุงุฑ": self._extended_owner_content
        }
    
    def _get_city_insight(self, city):
        """ุงูุญุตูู ุนูู ุชุญููู ุงููุฏููุฉ"""
        return self.city_insights.get(city, {
            "growth_trend": 2.0,
            "strength": "ุงููููุน ุงูุงุณุชุฑุงุชูุฌู ูุงูุจููุฉ ุงูุชุญุชูุฉ",
            "opportunity": "ุงููุฑุต ุงูุงุณุชุซูุงุฑูุฉ ุงููุชุนุฏุฏุฉ",
            "description": "ูุฏููุฉ ูุงุนุฏุฉ ุฐุงุช ุฅููุงูุงุช ููู ุนุงููุฉ"
        })
    
    # ๐ฝ ๐ฝ ๐ฝ ๐ฝ ๐ฝ ๐ฝ ๐ฝ ๐ฝ ๐ฝ ๐ฝ ๐ฝ ๐ฝ ๐ฝ ๐ฝ ๐ฝ ๐ฝ ๐ฝ ๐ฝ ๐ฝ ๐ฝ
    # ๐ฝ ุงูุฏูุงู ุงูุฌุฏูุฏุฉ ูุญุณูุฉ ุจูุบุฉ ุงูุฎุจุฑุงุก ูุน ุฏุนู ุงููุฏู ๐ฝ
    # ๐ฝ ๐ฝ ๐ฝ ๐ฝ ๐ฝ ๐ฝ ๐ฝ ๐ฝ ๐ฝ ๐ฝ ๐ฝ ๐ฝ ๐ฝ ๐ฝ ๐ฝ ๐ฝ ๐ฝ ๐ฝ ๐ฝ ๐ฝ
    
    def _analyze_risks(self, real_data, market_data, user_city):
        """ุชุญููู ุงููุฎุงุทุฑ ุงููุชูุฏู ูุน ูุฑุงุนุงุฉ ุงููุฏููุฉ"""
        if real_data.empty:
            return f"๐ **ุชุญููู ุงููุฎุงุทุฑ ูู {user_city}:**\nูุง ุชุชููุฑ ุญุงูููุง ุจูุงูุงุช ูุงููุฉ ูุฅุฌุฑุงุก ุชุญููู ูุฎุงุทุฑ ุฏููู. ููุตู ุจุฌูุน ูุฒูุฏ ูู ุงูุจูุงูุงุช ุงูุณูููุฉ ูู {user_city}."
        
        risk_counts = real_data['ูุณุชูู_ุงูุฎุทูุฑุฉ'].value_counts()
        total_properties = len(real_data)
        city_insight = self._get_city_insight(user_city)

        return f"""
        ๐ก๏ธ **ุชุญููู ุงููุฎุงุทุฑ ุงููุชูุฏู ูู {user_city}:**
        
        ุจูุงุกู ุนูู ุชุญููู {total_properties} ุนูุงุฑ ูู {user_city}ุ ุชูุฒุนุช ุงููุฎุงุทุฑ ูุงูุชุงูู:
        
        ๐ **ุชูุฒูุน ูุณุชููุงุช ุงููุฎุงุทุฑุฉ:**
        โข ๐ข **ูุฎุงุทุฑ ููุฎูุถุฉ:** {risk_counts.get('ููุฎูุถ', 0)} ุนูุงุฑ ({risk_counts.get('ููุฎูุถ', 0)/total_properties*100:.1f}%)
        - ูุฑุต ุงุณุชุซูุงุฑูุฉ ุขููุฉ ูู {user_city}
        
        โข ๐ก **ูุฎุงุทุฑ ูุชูุณุทุฉ:** {risk_counts.get('ูุชูุณุท', 0)} ุนูุงุฑ ({risk_counts.get('ูุชูุณุท', 0)/total_properties*100:.1f}%)
        - ุชูุงุฒู ุฌูุฏ ุจูู ุงูุนูุงุฆุฏ ูุงููุฎุงุทุฑุฉ ูู {user_city}
        
        โข ๐ด **ูุฎุงุทุฑ ูุฑุชูุนุฉ:** {risk_counts.get('ูุฑุชูุน', 0)} ุนูุงุฑ ({risk_counts.get('ูุฑุชูุน', 0)/total_properties*100:.1f}%)
        - ุชุญุชุงุฌ ุฅูู ุฎุจุฑุฉ ูุชูุฏูุฉ ูู ุฅุฏุงุฑุฉ ุงููุฎุงุทุฑ ูู {user_city}

        ๐ก **ุชูุตูุฉ ุงูุฎุจุฑุงุก ูู {user_city}:**
        "ููุตู ุจุชูุฒูุน ุงููุญูุธุฉ ุจูุณุจุฉ 60% ูุฎุงุทุฑ ููุฎูุถุฉุ 30% ูุชูุณุทุฉุ 10% ูุฑุชูุนุฉ 
        ูุชุญููู ุชูุงุฒู ูุซุงูู ุจูู ุงูุฃูุงู ูุงูุนุงุฆุฏ ูู ุณูู {user_city}."
        """

    def _find_investment_opportunities(self, real_data, user_city):
        """ุงูุชุดุงู ูุฑุต ุงูุงุณุชุซูุงุฑ ุงูุฐููุฉ ูุน ุงูุชุฑููุฒ ุนูู ุงููุฏููุฉ"""
        if real_data.empty:
            return f"๐ฏ **ูุฑุต ุงูุงุณุชุซูุงุฑ ูู {user_city}:**\nุญุงูููุง ูุง ุชูุฌุฏ ูุฑุต ุงุณุชุซูุงุฑูุฉ ูุงุถุญุฉ ูู {user_city}. ููุตู ุจูุฑุงูุจุฉ ุงูุณูู ุจุงุณุชูุฑุงุฑ ูุงูุชุดุงู ุงููุฑุต ุงูุฌุฏูุฏุฉ."
        
        best_opportunities = real_data.nlargest(3, 'ุงูุนุงุฆุฏ_ุงููุชููุน')
        city_insight = self._get_city_insight(user_city)
        
        result = f"""
        ๐ **ุฃูุถู ุงููุฑุต ุงูุงุณุชุซูุงุฑูุฉ ุงููููุฒุฉ ูู {user_city}:**
        
        """

        for idx, (_, opp) in enumerate(best_opportunities.iterrows(), 1):
            risk_level = opp.get('ูุณุชูู_ุงูุฎุทูุฑุฉ', 'ุบูุฑ ูุญุฏุฏ')
            risk_icon = "๐ข" if risk_level == "ููุฎูุถ" else "๐ก" if risk_level == "ูุชูุณุท" else "๐ด"
            
            result += f"""
        {idx}. **{opp['ุงูุนูุงุฑ']}** {risk_icon}
           ๐ ุงูููุทูุฉ: {opp['ุงูููุทูุฉ']} ูู {user_city}
           ๐ฐ ุงูุนุงุฆุฏ ุงููุชููุน: {opp['ุงูุนุงุฆุฏ_ุงููุชููุน']}%
           ๐ ุงูููุน: {opp['ููุน_ุงูุนูุงุฑ']}
           โ๏ธ ูุณุชูู ุงููุฎุงุทุฑุฉ: {risk_level}
           
        """
        
        result += f"""
        ๐ฏ **ููุงุฐุง ุชุนุชุจุฑ ูุฐู ูุฑุตุงู ูููุฒุฉ ูู {user_city}ุ**
        ูุฐู ุงูุนูุงุฑุงุช ูู {user_city} ุชูุชุงุฒ ุจุฃุนูู ุนูุงุฆุฏ ูุชููุนุฉ ูู ุงูุณูู ูุน ุชูุงุฒู ุฌูุฏ ูู ูุณุชููุงุช ุงููุฎุงุทุฑุฉุ 
        ููุง ูุฌุนููุง ุฎูุงุฑุงุช ูุซุงููุฉ ูููุณุชุซูุฑูู ุงูุจุงุญุซูู ุนู ุชุญููู ุฃูุตู ุนุงุฆุฏ ูููู ูู {user_city}.
        """
        
        return result

    def _analyze_roi(self, real_data, market_data, user_city):
        """ุชุญููู ุงูุนูุงุฆุฏ ุงูุงุณุชุซูุงุฑูุฉ ุงููุชูุฏู ูุน ุชุญููู ุงููุฏููุฉ"""
        if real_data.empty:
            return f"๐ **ุชุญููู ุงูุนูุงุฆุฏ ูู {user_city}:**\nูุง ุชูุฌุฏ ุจูุงูุงุช ูุงููุฉ ูุฅุฌุฑุงุก ุชุญููู ุงูุนูุงุฆุฏ ุงูุฏููู ูู {user_city}."
        
        avg_roi = real_data['ุงูุนุงุฆุฏ_ุงููุชููุน'].mean()
        max_roi = real_data['ุงูุนุงุฆุฏ_ุงููุชููุน'].max()
        min_roi = real_data['ุงูุนุงุฆุฏ_ุงููุชููุน'].min()
        roi_std = real_data['ุงูุนุงุฆุฏ_ุงููุชููุน'].std()
        city_insight = self._get_city_insight(user_city)
        
        return f"""
        ๐ **ุชุญููู ุงูุนูุงุฆุฏ ุงูุงุณุชุซูุงุฑูุฉ ุงููุชูุฏู ูู {user_city}:**
        
        ๐ **ูุคุดุฑุงุช ุงูุฃุฏุงุก ุงูุฑุฆูุณูุฉ:**
        โข ๐ฏ **ูุชูุณุท ุงูุนูุงุฆุฏ:** {safe_num(avg_roi, '.1f')}% ุณูููุงู ูู {user_city}
        โข ๐ **ุฃุนูู ุนุงุฆุฏ:** {safe_num(max_roi, '.1f')}% (ูุฑุต ุงุณุชุซูุงุฆูุฉ ูู {user_city})
        โข ๐ **ุฃุฏูู ุนุงุฆุฏ:** {safe_num(min_roi, '.1f')}% (ุงุณุชุซูุงุฑุงุช ุขููุฉ ูู {user_city})
        โข ๐ **ูุนุฏู ุงูุชุฐุจุฐุจ:** {safe_num(roi_std, '.1f')}% (ูุคุดุฑ ุงุณุชูุฑุงุฑ ุณูู {user_city})

        ๐ก **ุชุญููู ุงูุฎุจุฑุงุก ูู {user_city}:**
        "ูุนุฏู ุงูุนูุงุฆุฏ ุงูุญุงูู ูู {user_city} ุนูุฏ {safe_num(avg_roi, '.1f')}% ูุนุชุจุฑ ููุชุงุฒุงู ููุงุฑูุฉ ุจุงูุจุฏุงุฆู ุงูุงุณุชุซูุงุฑูุฉ ุงูุฃุฎุฑูุ 
        ุฎุงุตุฉ ูุน ุงูุชุถุฎู ุงูุญุงูู. ููุตู ุจุงูุชุฑููุฒ ุนูู ุงููุฑุต ุงูุชู ุชุชุฌุงูุฒ {safe_num(avg_roi + roi_std, '.1f')}% ูู {user_city}."
        """

    def _property_valuation(self, real_data, user_info):
        """ุชูููู ุงูุนูุงุฑ ุงููุชูุฏู"""
        user_city = user_info.get('city', 'ุงููุฏููุฉ ุงููุณุชูุฏูุฉ')
        if real_data.empty:
            return f"๐ฐ **ุชูููู ุงูุนูุงุฑ ูู {user_city}:**\nุฌุงุฑู ุชุทููุฑ ููุงุฐุฌ ุชูููู ูุชูุฏูุฉ. ููุตู ุจูุฑุงุฌุนุฉ ุงูุฎุจุฑุงุก ุงููุชุฎุตุตูู ูู {user_city}."
        
        avg_price = real_data['ุงูุณุนุฑ'].mean()
        avg_psm = real_data['ุณุนุฑ_ุงููุชุฑ'].mean() if 'ุณุนุฑ_ุงููุชุฑ' in real_data.columns else avg_price / real_data['ุงููุณุงุญุฉ'].mean()
        
        return f"""
        ๐ **ุชูููู ุงูุนูุงุฑ ุงููุชูุฏู ูู {user_city}:**
        
        ๐ **ูุนุงููุฑ ุงูุชูููู ุงูุญุงููุฉ:**
        โข ๐ฐ **ุงููููุฉ ุงูุณูููุฉ ุงููุชูุณุทุฉ:** {safe_num(avg_price)} ุฑูุงู
        โข ๐ **ุณุนุฑ ุงููุชุฑ ุงููุฑุจุน:** {safe_num(avg_psm)} ุฑูุงู/ูยฒ
        โข ๐๏ธ **ุญุฌู ุงูุนููุฉ:** {len(real_data)} ุนูุงุฑ ูู {user_city}

        ๐ฏ **ูููุฌูุฉ ุงูุชูููู:**
        ูุณุชุฎุฏู ูููุฌูุฉ ูุชูุงููุฉ ุชุดูู:
        - ุงูุชุญููู ุงูููุงุฑู ููุณูู (CMA) ูู {user_city}
        - ุชูููู ุชูููุฉ ุงูุฅุญูุงู ูู {user_city}
        - ุชุญููู ุงูุฏุฎู ูุงูุชุฏููุงุช ุงูููุฏูุฉ
        - ูุคุดุฑุงุช ุงููููุฉ ุงููุณุชูุจููุฉ ูู {user_city}

        ๐ก **ูุตูุญุฉ ุงูุฎุจุฑุงุก:**
        "ุงูุชูููู ุงูุฏููู ูู {user_city} ูุญุชุงุฌ ุฅูู ูุนุงููุฉ ููุฏุงููุฉ ูุชุญููู ุงูุนูุงูู ุงูููุนูุฉ ูุซู ุงููููุน ุงูุงุณุชุฑุงุชูุฌู ูุงูุฌูุฏุฉ ุงูุฅูุดุงุฆูุฉ."
        """

    def _optimal_selling_timing(self, market_data, user_city):
        """ุงูุชูููุช ุงูุฃูุซู ููุจูุน ุงููุชูุฏู"""
        city_insight = self._get_city_insight(user_city)
        growth_trend = market_data.get('ูุนุฏู_ุงูููู_ุงูุดูุฑู', city_insight['growth_trend'])
        seasonality = market_data.get('ููุณููุฉ_ุงูุทูุจ', 'ูุฑุชูุน')
        
        return f"""
        โฐ **ุชุญููู ุงูุชูููุช ุงูุฃูุซู ููุจูุน ูู {user_city}:**
        
        ๐ **ุงูุชุญููู ุงูุฒููู ุงูุญุงูู:**
        โข ๐ **ุงุชุฌุงู ุงูููู:** {safe_num(growth_trend, '.1f')}% ุดูุฑูุงู ูู {user_city}
        โข ๐ฏ **ููุณููุฉ ุงูุทูุจ:** {seasonality}
        โข ๐ **ูุคุดุฑ ุงูุณูููุฉ:** {market_data.get('ูุคุดุฑ_ุงูุณูููุฉ', 85)}%

        ๐๏ธ **ุงูุชูููุชุงุช ุงูููุชุฑุญุฉ ูู {user_city}:**
        โข ๐ฅ **ุงูุฃูุซู (3-6 ุฃุดูุฑ):** ูุน ุงุณุชูุฑุงุฑ ุงูููู ุงูุญุงูู ูู {user_city}
        โข ๐ฅ **ุงูุฌูุฏ (1-3 ุฃุดูุฑ):** ูุชุญููู ุณูููุฉ ุณุฑูุนุฉ ูู {user_city}
        โข ๐ฅ **ุงููุญุชูู (6-12 ุดูุฑ):** ูุชุญููู ุฃูุตู ูููุฉ ูู {user_city}

        ๐ก **ุงุณุชุฑุงุชูุฌูุฉ ุงูุฎุจุฑุงุก:**
        "ูู ุธู ุงูููู ุงูุญุงูู ูู {user_city} ุจูุณุจุฉ {safe_num(growth_trend, '.1f')}%ุ ููุตู ุจุงูุจูุน ุฎูุงู 3-6 ุฃุดูุฑ 
        ูุชุญููู ุชูุงุฒู ุจูู ุงููููุฉ ูุงูุณูููุฉ ูู ุณูู {user_city}."
        """

    def _value_improvement_tips(self, user_info, real_data):
        """ูุตุงุฆุญ ุชุญุณูู ุงููููุฉ ุงููุชูุฏูุฉ"""
        user_city = user_info.get('city', 'ุงููุฏููุฉ ุงููุณุชูุฏูุฉ')
        return f"""
        ๐ง **ุฎุทุฉ ุชุญุณูู ุงููููุฉ ุงูุนูุงุฑูุฉ ูู {user_city}:**
        
        ๐ฏ **ุชุญุณููุงุช ุนุงููุฉ ุงูุฃุซุฑ:**
        โข ๐๏ธ **ุชุทููุฑ ุงููุงุฌูุงุช:** ุชุฒูุฏ ุงููููุฉ ุญุชู 15% ูู {user_city}
        โข ๐ก **ุงูุชุญูู ููุทุงูุฉ ุงูุฐููุฉ:** ุชูููุฑ 20% ูู ุงูุชูุงููู
        โข ๐ฟ **ุชุญุณูู ููุงุกุฉ ุงูุทุงูุฉ:** ุฒูุงุฏุฉ ุงูุฌุงุฐุจูุฉ ุงูุงุณุชุซูุงุฑูุฉ ูู {user_city}
        โข ๐๏ธ **ุชุญุฏูุซ ุงููุฑุงูู:** ุฑูุน ูุณุชูู ุงูุฎุฏูุงุช

        ๐ **ุชุญููู ุงูุฌุฏูู ูู {user_city}:**
        โข ๐ฐ **ุงูุนุงุฆุฏ ุนูู ุงูุงุณุชุซูุงุฑ:** 25-40% ููุชุญุณููุงุช ุงูุฐููุฉ
        โข โฑ๏ธ **ูุชุฑุฉ ุงูุงุณุชุฑุฏุงุฏ:** 6-18 ุดูุฑ
        โข ๐ **ุฒูุงุฏุฉ ุงููููุฉ ุงูุณูููุฉ:** 10-25%

        ๐ก **ูุตูุญุฉ ุงูุฎุจุฑุงุก:**
        "ุฑูุฒ ุนูู ุงูุชุญุณููุงุช ุงูุชู ุชุฒูุฏ ูู ุฌูุฏุฉ ุงูุญูุงุฉ ูุชููู ุงูุชูุงููู ุงูุชุดุบูููุฉ ูู {user_city}ุ 
        ููู ุงูุฃูุซุฑ ุฌุงุฐุจูุฉ ูููุดุชุฑูู ูุงููุณุชุฃุฌุฑูู ุนูู ุญุฏ ุณูุงุก."
        """

    def _find_suitable_living_areas(self, real_data, user_info):
        """ุงูุจุญุซ ุนู ููุงุทู ุณูู ููุงุณุจุฉ ูุชูุฏู"""
        user_city = user_info.get('city', 'ุงููุฏููุฉ ุงููุณุชูุฏูุฉ')
        if real_data.empty:
            return f"๐ก **ุงูููุงุทู ุงูุณูููุฉ ูู {user_city}:**\nุฌุงุฑู ุชุทููุฑ ุชุญููู ุงูููุงุทู. ููุตู ุจุฒูุงุฑุฉ ุงูููุงุทู ูู {user_city} ุดุฎุตูุงู."
        
        top_areas = real_data['ุงูููุทูุฉ'].value_counts().head(5)
        
        areas_analysis = f"""
        ๐๏ธ **ุฏููู ุงูููุงุทู ุงูุณูููุฉ ูู {user_city}:**
        
        ๐ **ุงูููุงุทู ุงูุฃูุซุฑ ุทูุจุงู:**
        """
        
        for area, count in top_areas.items():
            areas_analysis += f"โข ๐๏ธ **{area}:** {count} ุนูุงุฑ ูุชุงุญ\n"
        
        areas_analysis += f"""
        ๐ฏ **ูุนุงููุฑ ุงูุงุฎุชูุงุฑ ูู {user_city}:**
        โข ๐ ุงููุฑุจ ูู ุงูุฎุฏูุงุช ุงูุฃุณุงุณูุฉ
        โข ๐ ุชููุฑ ูุณุงุฆู ุงูููู
        โข ๐ซ ุฌูุฏุฉ ุงููุฏุงุฑุณ ูุงููุฑุงูู
        โข ๐ณ ุงูุจููุฉ ุงูุชุญุชูุฉ ูุงููุณุงุญุงุช ุงูุฎุถุฑุงุก

        ๐ก **ูุตูุญุฉ ุงูุฎุจุฑุงุก:**
        "ุงุฎุชุฑ ุงูููุทูุฉ ูู {user_city} ุงูุชู ุชูุงุณุจ ููุท ุญูุงุชู ูุชููุฑ ุชูุงุฒูุงู ุจูู ุงูุฎุฏูุงุช ูุงูุชูููุฉ. 
        ุงูููุงุทู ุงููุชูุณุทุฉ ุงูุณุนุฑ ูู {user_city} ุบุงูุจุงู ูุง ุชููู ุงูุฃูุถู ูููุฉ."
        """
        
        return areas_analysis

    def _financing_analysis(self, user_info, market_data):
        """ุชุญููู ุงูุชูููู ุงููุชูุฏู"""
        user_city = user_info.get('city', 'ุงููุฏููุฉ ุงููุณุชูุฏูุฉ')
        loan_rates = market_data.get('ุฃุณุนุงุฑ_ุงูุชูููู', {'ุจููู': 4.5, 'ุตูุฏูู': 3.5})
        
        return f"""
        ๐ณ **ุชุญููู ุฎูุงุฑุงุช ุงูุชูููู ุงููุชูุฏู ูู {user_city}:**
        
        ๐ฆ **ููุงุฑูุฉ ุฎูุงุฑุงุช ุงูุชูููู:**
        โข ๐๏ธ **ุงูุชูููู ุงูุจููู:** {loan_rates.get('ุจููู', 4.5)}% ูุงุฆุฏุฉ
        - ููุงุณุจุฉ ูููุดุชุฑูู ุฐูู ุงูุฏุฎู ุงูุซุงุจุช ูู {user_city}
        
        โข ๐ **ุตูุฏูู ุงูุชูููุฉ ุงูุนูุงุฑูุฉ:** {loan_rates.get('ุตูุฏูู', 3.5)}% ูุงุฆุฏุฉ
        - ุดุฑูุท ููุณุฑุฉ ููููุงุทููู ูู {user_city}
        
        โข ๐ผ **ุงูุชูููู ุงูุฅุณูุงูู:** {loan_rates.get('ุฅุณูุงูู', 4.2)}% ุฑุจุญ
        - ูุชูุงูู ูุน ุงูุดุฑูุนุฉ ุงูุฅุณูุงููุฉ

        ๐ **ูุตุงุฆุญ ุงูุชูููู ุงูุฐูู ูู {user_city}:**
        โข ๐ฐ **ุงูููุฏู ุงูุฃูุซู:** 20-30% ูู ูููุฉ ุงูุนูุงุฑ
        โข ๐ **ูุฏุฉ ุงูุชูููู:** 15-20 ุณูุฉ ููุชูุงุฒู ุงููุงูู
        โข ๐ **ูุณุจุฉ ุงูุฏุฎู ุฅูู ุงููุฑุถ:** ูุง ุชุชุฌุงูุฒ 40%

        ๐ก **ุงุณุชุดุงุฑุฉ ุงูุฎุจุฑุงุก:**
        "ููุตู ุจุงุฎุชูุงุฑ ุงูุชูููู ุงูุฐู ููุงุณุจ ุชููุนุงุชู ุงููุงููุฉ ุงููุณุชูุจููุฉ ููููุฑ ูุฑููุฉ ูู ุงูุณุฏุงุฏ ูู {user_city}."
        """

    def _compare_housing_options(self, real_data):
        """ููุงุฑูุฉ ุฎูุงุฑุงุช ุงูุณูู ุงููุชูุฏูุฉ"""
        if real_data.empty:
            return "๐ **ููุงุฑูุฉ ุงูุฎูุงุฑุงุช:**\nุฌุงุฑู ุชุทููุฑ ุฃุฏูุงุช ุงูููุงุฑูุฉ ุงููุชูุฏูุฉ."
        
        type_stats = real_data.groupby('ููุน_ุงูุนูุงุฑ').agg({
            'ุงูุณุนุฑ': ['mean', 'min', 'max'],
            'ุงููุณุงุญุฉ': 'mean',
            'ุงูุนุงุฆุฏ_ุงููุชููุน': 'mean'
        }).round(0)
        
        comparison = """
        ๐ **ููุงุฑูุฉ ูุชูุฏูุฉ ูุฃููุงุน ุงูุนูุงุฑุงุช:**
        
        """
        
        for prop_type in type_stats.index:
            stats = type_stats.loc[prop_type]
            comparison += f"""
        ๐ **{prop_type}:**
           ๐ฐ ุงูุณุนุฑ ุงููุชูุณุท: {safe_num(stats[('ุงูุณุนุฑ', 'mean')])} ุฑูุงู
           ๐ ุงููุณุงุญุฉ ุงููุชูุณุทุฉ: {safe_num(stats[('ุงููุณุงุญุฉ', 'mean')], '.0f')} ูยฒ
           ๐ ุงูุนุงุฆุฏ ุงููุชููุน: {safe_num(stats[('ุงูุนุงุฆุฏ_ุงููุชููุน', 'mean')], '.1f')}%
           ๐ฏ ูุทุงู ุงูุฃุณุนุงุฑ: {safe_num(stats[('ุงูุณุนุฑ', 'min')])} - {safe_num(stats[('ุงูุณุนุฑ', 'max')])} ุฑูุงู
        
        """
        
        comparison += """
        ๐ก **ุชุญููู ุงูุฎุจุฑุงุก:**
        "ูู ููุน ุนูุงุฑู ููุงุณุจ ุงุญุชูุงุฌุงุช ูุฎุชููุฉ. ุงูุดูู ูููุณุชุซูุฑูู ุงูุตุบุงุฑุ ุงูููู ููุนุงุฆูุงุชุ 
        ูุงููุญูุงุช ุงูุชุฌุงุฑูุฉ ูููุณุชุซูุฑูู ุงููุญุชุฑููู. ุงุฎุชุฑ ูุง ููุงุณุจ ุฃูุฏุงูู ุงููุงููุฉ ูููุท ุญูุงุชู."
        """
        
        return comparison
    
    # ๐ผ ๐ผ ๐ผ ๐ผ ๐ผ ๐ผ ๐ผ ๐ผ ๐ผ ๐ผ ๐ผ ๐ผ ๐ผ ๐ผ ๐ผ ๐ผ ๐ผ ๐ผ ๐ผ ๐ผ
    # ๐ผ ุงูุชูุช ุงูุฏูุงู ุงูุฌุฏูุฏุฉ ุงููุญุณูุฉ - ููุง ุชุจุฏุฃ ุฏูุงู ุงูุชูุฑูุฑ ุงูุฃุตููุฉ ๐ผ
    # ๐ผ ๐ผ ๐ผ ๐ผ ๐ผ ๐ผ ๐ผ ๐ผ ๐ผ ๐ผ ๐ผ ๐ผ ๐ผ ๐ผ ๐ผ ๐ผ ๐ผ ๐ผ ๐ผ ๐ผ
    
    def arabic_text(self, text):
        """ุชุญููู ุงููุต ุงูุนุฑุจู ููุนุฑุถ ุงูุตุญูุญ"""
        return get_display(arabic_reshaper.reshape(str(text)))
    
    def generate_smart_report(self, user_info, market_data, real_data, package_level):
        """ุฅูุดุงุก ุงูุชูุฑูุฑ ุงูุฐูู ุญุณุจ ุงููุฆุฉ ูุงูุจุงูุฉ"""
        user_type = user_info.get('user_type', 'ูุณุชุซูุฑ')
        report_generator = self.user_profiles.get(user_type, self._investor_report)
        
        return report_generator(user_info, market_data, real_data, package_level)
    
    def generate_extended_report(self, user_info, market_data, real_data, package_level):
        """๐ ุฅูุดุงุก ุชูุฑูุฑ ููุณุน ูููุฃ ุนุฏุฏ ุงูุตูุญุงุช ุงููุทููุจ"""
        user_type = user_info.get('user_type', 'ูุณุชุซูุฑ')
        target_pages = self.package_features.get(package_level, {}).get('pages', 15)
        
        # ุงูุญุตูู ุนูู ุงููุญุชูู ุงูุฃุณุงุณู
        basic_report = self.generate_smart_report(user_info, market_data, real_data, package_level)
        
        # ุงูุญุตูู ุนูู ุงููุญุชูู ุงูููุณุน
        extended_generator = self.extended_content.get(user_type, self._extended_investor_content)
        extended_content = extended_generator(user_info, market_data, real_data, package_level, target_pages)
        
        # ุฏูุฌ ุงููุญุชูู
        full_report = basic_report + "\n\n" + extended_content
        return full_report
    
    def _investor_report(self, user_info, market_data, real_data, package_level):
        """ุชูุฑูุฑ ุงููุณุชุซูุฑ - ูุฑูุฒ ุนูู ุงูุนูุงุฆุฏ ูุงููุฎุงุทุฑ"""
        # ๐ฏ ุงุณุชุฎุฏุงู ุงููุฏููุฉ ุงููุนููุฉ ูู user_info
        user_city = user_info.get('city', 'ุงููุฏููุฉ ุงููุณุชูุฏูุฉ')
        city_insight = self._get_city_insight(user_city)
        
        report_content = {
            "title": f"ุงูุชูุฑูุฑ ุงูุงุณุชุซูุงุฑู ุงูุฐูู - ุชุญููู ุงูุนูุงุฆุฏ ูุงููุฎุงุทุฑ ุงููุชูุฏู ูู {user_city}",
            "sections": []
        }
        
        # ๐ ุชุญููู ุงูุนูุงุฆุฏ
        roi_analysis = self._analyze_roi(real_data, market_data, user_city)
        report_content["sections"].append({
            "title": "๐ ุชุญููู ุงูุนูุงุฆุฏ ุงูุงุณุชุซูุงุฑูุฉ ุงููุชูุฏู",
            "content": roi_analysis
        })
        
        # ๐ฏ ูุฑุต ุงูุงุณุชุซูุงุฑ
        opportunities = self._find_investment_opportunities(real_data, user_city)
        report_content["sections"].append({
            "title": "๐ ุฃูุถู ุงููุฑุต ุงูุงุณุชุซูุงุฑูุฉ ุงููููุฒุฉ",
            "content": opportunities
        })
        
        # ๐ ุชุญููู ุงููุฎุงุทุฑ
        risk_analysis = self._analyze_risks(real_data, market_data, user_city)
        report_content["sections"].append({
            "title": "๐ก๏ธ ุชุญููู ุงููุฎุงุทุฑ ุงููุชูุฏู",
            "content": risk_analysis
        })
        
        return self._format_report(report_content, package_level, "ูุณุชุซูุฑ", user_city)
    
    # ๐ ุงููุญุชูู ุงูููุณุน ูููุณุชุซูุฑ
    def _extended_investor_content(self, user_info, market_data, real_data, package_level, target_pages):
        """ูุญุชูู ููุณุน ูููุณุชุซูุฑ ูููุก ุงูุตูุญุงุช"""
        user_city = user_info.get('city', 'ุงููุฏููุฉ ุงููุณุชูุฏูุฉ')
        city_insight = self._get_city_insight(user_city)
        extended_sections = []
        
        # ุฅุถุงูุฉ ุฃูุณุงู ุฅุถุงููุฉ ุญุณุจ ุงูุจุงูุฉ
        if package_level in ["ูุถูุฉ", "ุฐูุจูุฉ", "ูุงุณูุฉ"]:
            extended_sections.extend([
                self._create_advanced_roi_analysis(real_data, user_city),
                self._create_market_trends_analysis(market_data, user_city),
                self._create_portfolio_strategy(user_info, real_data, user_city),
                self._create_financing_comparison(user_city)
            ])
        
        if package_level in ["ุฐูุจูุฉ", "ูุงุณูุฉ"]:
            extended_sections.extend([
                self._create_risk_management_plan(real_data, user_city),
                self._create_18month_forecast(market_data, user_city),
                self._create_competitor_analysis(real_data, user_city)
            ])
        
        if package_level == "ูุงุณูุฉ":
            extended_sections.extend([
                self._create_international_comparison(user_city),
                self._create_7year_investment_plan(user_info, market_data, user_city),
                self._create_advanced_analytics(real_data, user_city)
            ])
        
        # ุชูุณูู ุงููุญุชูู ุงูููุณุน
        extended_content = "\n\n" + "="*80 + "\n"
        extended_content += f"๐ ุงููุญุชูู ุงูุชุญูููู ุงูููุณุน - Warda Intelligence - {user_city}\n"
        extended_content += "="*80 + "\n\n"
        
        for section in extended_sections:
            extended_content += section + "\n\n" + "-"*50 + "\n\n"
        
        return extended_content
    
    def _create_advanced_roi_analysis(self, real_data, user_city):
        """ุชุญููู ุงูุนูุงุฆุฏ ุงููุชูุฏู ูุน ุงูุชุฑููุฒ ุนูู ุงููุฏููุฉ"""
        if real_data.empty:
            return f"๐ **ุชุญููู ุงูุนูุงุฆุฏ ุงููุชูุฏู ูู {user_city}:**\nูุง ุชูุฌุฏ ุจูุงูุงุช ูุงููุฉ ูุชุญููู ูุชูุฏู"
        
        # ุชุญููู ูุชูุฏู ููุนูุงุฆุฏ
        roi_stats = real_data['ุงูุนุงุฆุฏ_ุงููุชููุน'].describe()
        high_roi_properties = real_data[real_data['ุงูุนุงุฆุฏ_ุงููุชููุน'] > real_data['ุงูุนุงุฆุฏ_ุงููุชููุน'].quantile(0.8)]
        city_insight = self._get_city_insight(user_city)
        
        analysis = f"""
        ๐ **ุชุญููู ุงูุนูุงุฆุฏ ุงูุงุณุชุซูุงุฑูุฉ ุงููุชูุฏู ูู {user_city}:**

        ๐ฏ **ุงูุฅุญุตุงุฆูุงุช ุงูุชูุตูููุฉ:**
        โข ๐ **ุงููุชูุณุท ุงูุญุณุงุจู:** {safe_num(roi_stats['mean'], '.1f')}%
        - ููุซู ุงูุนุงุฆุฏ ุงููุชููุน ููุนุธู ุงูุนูุงุฑุงุช ูู {user_city}
        
        โข โ๏ธ **ุงููุณูุท ุงูุฅุญุตุงุฆู:** {safe_num(roi_stats['50%'], '.1f')}%
        - ูุนูุณ ุงููููุฉ ุงููุณุทู ุงูุญููููุฉ ูุณูู {user_city}
        
        โข ๐ **ุฃุนูู 20% ุฃุฏุงุก:** {safe_num(roi_stats['80%'], '.1f')}%
        - ุนุชุจุฉ ุงููุฑุต ุงูุงุณุชุซูุงุฑูุฉ ุงููุชููุฒุฉ ูู {user_city}
        
        โข ๐ **ูุนุฏู ุงูุชุฐุจุฐุจ:** {safe_num(roi_stats['std'], '.1f')}%
        - ูุคุดุฑ ุงุณุชูุฑุงุฑ ุณูู {user_city} ูุชูุงุณู ุงูุนูุงุฆุฏ

        ๐ **ุงูุนูุงุฑุงุช ุฐุงุช ุฃุนูู ุนูุงุฆุฏ ูู {user_city} ({len(high_roi_properties)} ุนูุงุฑ):**
        """
        
        for idx, (_, prop) in enumerate(high_roi_properties.head(5).iterrows(), 1):
            analysis += f"""
        {idx}. **{prop['ุงูุนูุงุฑ']}** ูู {prop['ุงูููุทูุฉ']}
           ๐ ุงูุนุงุฆุฏ: {prop['ุงูุนุงุฆุฏ_ุงููุชููุน']}%
           ๐ ุงูููุน: {prop['ููุน_ุงูุนูุงุฑ']}
           ๐ฐ ุงูุณุนุฑ: {safe_num(prop['ุงูุณุนุฑ'])} ุฑูุงู
        """
        
        analysis += f"""
        
        ๐ก **ุฑุคูุฉ ุงูุฎุจุฑุงุก ูู {user_city}:**
        "ุงููุฑุต ุงูุชู ุชุชุฌุงูุฒ ุนุชุจุฉ ุงูู{safe_num(roi_stats['80%'], '.1f')}% ูู {user_city} ุชูุซู ููุงุท ุฏุฎูู ุงุณุชุซูุงุฑูุฉ ุงุณุชุซูุงุฆูุฉ 
        ูู ุงูุณูู ุงูุญุงููุ ุฎุงุตุฉ ูุน ุงุณุชูุฑุงุฑ ูุคุดุฑ ุงูุชุฐุจุฐุจ ุนูุฏ {safe_num(roi_stats['std'], '.1f')}%."
        """
        
        return analysis
    
    def _create_market_trends_analysis(self, market_data, user_city):
        """ุชุญููู ุงุชุฌุงูุงุช ุงูุณูู ุงููุชูุฏู"""
        city_insight = self._get_city_insight(user_city)
        growth = market_data.get('ูุนุฏู_ุงูููู_ุงูุดูุฑู', city_insight['growth_trend'])
        liquidity = market_data.get('ูุคุดุฑ_ุงูุณูููุฉ', 85)
        annual_growth = ((1 + growth/100)**12 - 1) * 100
        
        analysis = f"""
        ๐ **ุชุญููู ุงุชุฌุงูุงุช ุงูุณูู ุงููุชูุฏู ูู {user_city}:**

        ๐ **ูุคุดุฑุงุช ุงูููู ูุงูุงุชุฌุงู:**
        โข ๐ **ุงูููู ุงูุดูุฑู:** {safe_num(growth, '.1f')}%
        - ูุดูุฑ ุฅูู ููุฉ ุงูุฏูุน ุงูุญุงููุฉ ูู ุณูู {user_city}
        
        โข ๐๏ธ **ุงูููู ุงูุณููู ุงููุชููุน:** {safe_num(annual_growth, '.1f')}%
        - ูุนูุณ ุงูุงุชุฌุงู ุงูุงุณุชุฑุงุชูุฌู ุทููู ุงููุฏู ูู {user_city}
        
        โข ๐ง **ูุคุดุฑ ุงูุณูููุฉ:** {safe_num(liquidity, '.0f')}%
        - ู่กก้ ุณูููุฉ ุงูุจูุน ูุงูุดุฑุงุก ูู ุณูู {user_city}

        ๐ฏ **ุงูุชููุนุงุช ูุงูุชุญููู ูู {user_city}:**
        โข โฑ๏ธ **ุงููุฏู ุงููุตูุฑ (3 ุฃุดูุฑ):** {'๐ข ุฅูุฌุงุจู ูููู' if growth > 3 else '๐ก ุฅูุฌุงุจู ููุนุชุฏู' if growth > 2 else '๐ด ูุณุชูุฑ ุจุญุฐุฑ'}
        โข ๐ **ุงููุฏู ุงููุชูุณุท (12 ุดูุฑ):** {'๐ ููู ุงุณุชุซูุงุฆู' if annual_growth > 35 else '๐ ููู ููู' if annual_growth > 25 else 'โ๏ธ ููู ูุนุชุฏู'}
        โข ๐ฐ **ุงูุณูููุฉ ุงูุณูููุฉ:** {'๐ข ุนุงููุฉ ูููุชุงุฒุฉ' if liquidity > 85 else '๐ก ุฌูุฏุฉ ูููุจููุฉ' if liquidity > 70 else '๐ด ูุชูุณุทุฉ ุชุญุชุงุฌ ุญุฐุฑ'}

        ๐ก **ุชุญููู ุงูุฎุจุฑุงุก:**
        "ุณูู {user_city} ุงูุญุงูู ููุธูุฑ ูุคุดุฑุงุช { 'ูููุฉ ุฌุฏุงู' if growth > 3 else 'ุฌูุฏุฉ' if growth > 2 else 'ูุณุชูุฑุฉ' } ูุน ุณูููุฉ { 'ููุชุงุฒุฉ' if liquidity > 85 else 'ุฌูุฏุฉ' if liquidity > 70 else 'ูุชูุณุทุฉ' }ุ 
        ููุง ูููุฑ ุจูุฆุฉ { 'ูุซุงููุฉ' if growth > 3 and liquidity > 85 else 'ููุงุณุจุฉ' if growth > 2 and liquidity > 70 else 'ุญุฐุฑุฉ' } ูุนูููุงุช ุงูุงุณุชุซูุงุฑ ุงูุนูุงุฑู ูู {user_city}."
        """
        
        return analysis
    
    def _create_portfolio_strategy(self, user_info, real_data, user_city):
        """ุงุณุชุฑุงุชูุฌูุฉ ุงููุญูุธุฉ ุงูุงุณุชุซูุงุฑูุฉ ุงููุชูุฏูุฉ"""
        if real_data.empty:
            return f"๐ผ **ุงุณุชุฑุงุชูุฌูุฉ ุงููุญูุธุฉ ูู {user_city}:**\nุฌุงุฑู ุชุทููุฑ ุงุณุชุฑุงุชูุฌูุงุช ูุชูุฏูุฉ ุจูุงุกู ุนูู ุชุญููู ุณูู {user_city}."
        
        # ุชุญููู ุงูุชูุฒูุน ุงูุฃูุซู
        area_diversity = real_data['ุงูููุทูุฉ'].nunique()
        type_diversity = real_data['ููุน_ุงูุนูุงุฑ'].nunique()
        risk_distribution = real_data['ูุณุชูู_ุงูุฎุทูุฑุฉ'].value_counts(normalize=True) * 100
        city_insight = self._get_city_insight(user_city)
        
        strategy = f"""
        ๐ผ **ุงุณุชุฑุงุชูุฌูุฉ ุงููุญูุธุฉ ุงูุงุณุชุซูุงุฑูุฉ ุงููุชูุฏูุฉ ูู {user_city}:**

        ๐ฏ **ุฅุณุชุฑุงุชูุฌูุฉ ุงูุชูููุน ุงููุซูู:**
        โข ๐บ๏ธ **ุงูุชูููุน ุงูุฌุบุฑุงูู:** {min(area_diversity, 5)} ููุงุทู ูุฎุชููุฉ ูู {user_city}
        - ูููู ุงููุฎุงุทุฑ ุงููุธุงููุฉ ููุฒูุฏ ูุฑุต ุงูููู ูู {user_city}
        
        โข ๐๏ธ **ุงูุชูููุน ุงูููุนู:** {min(type_diversity, 3)} ุฃููุงุน ุนูุงุฑูุฉ
        - ูุญูู ุชูุงุฒูุงู ุจูู ุงูุนูุงุฆุฏ ูุงูุณูููุฉ ูู {user_city}
        
        โข โ๏ธ **ุชูุฒูุน ุงููุฎุงุทุฑ ุงูุฐูู:**
           ๐ข {safe_num(risk_distribution.get('ููุฎูุถ', 0), '.1f')}% ููุฎูุถุฉ ุงููุฎุงุทุฑุฉ (ุฃุณุงุณ ุงููุญูุธุฉ)
           ๐ก {safe_num(risk_distribution.get('ูุชูุณุท', 0), '.1f')}% ูุชูุณุทุฉ ุงููุฎุงุทุฑุฉ (ููู ูุชูุงุฒู)
           ๐ด {safe_num(risk_distribution.get('ูุฑุชูุน', 0), '.1f')}% ูุฑุชูุนุฉ ุงููุฎุงุทุฑุฉ (ุนูุงุฆุฏ ุงุณุชุซูุงุฆูุฉ)

        ๐ **ุงูุชูุฒูุน ุงูุฌุบุฑุงูู ุงูุฃูุซู ูู {user_city}:**
        โข ๐ฅ **ุงูููุงุทู ุงูุฑุงุฆุฏุฉ (40%):** ุงูุชุฑููุฒ ุนูู ุงูููุงุทู ุฐุงุช ุงูุจููุฉ ุงูุชุญุชูุฉ ุงููุชุทูุฑุฉ ูู {user_city}
        โข ๐ฅ **ุงูููุงุทู ุงููุงุดุฆุฉ (30%):** ุงูุงุณุชุซูุงุฑ ูู ุงูููุงุทู ุฐุงุช ุฅููุงูุงุช ุงูููู ุงููุณุชูุจููุฉ ูู {user_city}  
        โข ๐ฅ **ุงูููุงุทู ุงููุณุชูุฑุฉ (30%):** ุงููุญุงูุธุฉ ุนูู ุชุฏููุงุช ููุฏูุฉ ููุชุธูุฉ ูู {user_city}

        ๐ก **ุฎุทุฉ ุฅุฏุงุฑุฉ ุงููุญูุธุฉ ูู {user_city}:**
        โข ๐ **ุฅุนุงุฏุฉ ุงูุชูุงุฒู:** ุฑุจุน ุณููู ูููุงูุจุฉ ุชุบูุฑุงุช ุณูู {user_city}
        โข ๐ **ุงููุชุงุจุนุฉ:** ุดูุฑูุงู ููุคุดุฑุงุช ุงูุฃุฏุงุก ูุงูุงุชุฌุงูุงุช ูู {user_city}
        โข ๐ฐ **ุงูุณูููุฉ:** ุงูุงุญุชูุงุธ ุจู 10-15% ูุงูุชูุงุต ุงููุฑุต ุงูุงุณุชุซูุงุฆูุฉ ูู {user_city}
        โข ๐ฏ **ุงูุชูููู:** ูุตู ุณููู ุดุงูู ููุฃุฏุงุก ูุงูุงุณุชุฑุงุชูุฌูุฉ ูู {user_city}

        ๐ **ูุตูุญุฉ ุงูุฎุจุฑุงุก:**
        "ุงููุญูุธุฉ ุงููุชูุงุฒูุฉ ูู {user_city} ููุณุช ุงูุฃูุซุฑ ุชููุนุงูุ ุจู ุงูุฃูุซุฑ ุชูุงุณูุงู ูุน ุฃูุฏุงูู ุงูุงุณุชุซูุงุฑูุฉ ูุชุญูู ุงููุฎุงุทุฑ ูู {user_city}."
        """
        
        return strategy
    
    # ๐ ุฃูุณุงู ุฅุถุงููุฉ ููุจุงูุงุช ุงูุฃุนูู
    def _create_18month_forecast(self, market_data, user_city):
        """ุชููุนุงุช 18 ุดูุฑุงู ูุชูุฏูุฉ"""
        city_insight = self._get_city_insight(user_city)
        current_growth = market_data.get('ูุนุฏู_ุงูููู_ุงูุดูุฑู', city_insight['growth_trend'])
        
        forecast = f"""
        ๐ฎ **ุชููุนุงุช 18 ุดูุฑุงู ุงููุงุฏูุฉ - ุชุญููู ุงุณุชุดุฑุงูู ูู {user_city}:**

        ๐ **ุงูุฌุฏุงูู ุงูุฒูููุฉ ุงููุชููุนุฉ ูุฃุฏุงุก ุงููุญูุธุฉ:**
        """
        
        months = [3, 6, 12, 18]
        for months_ahead in months:
            growth_factor = (1 + current_growth/100) ** months_ahead
            cumulative_growth = (growth_factor - 1) * 100
            forecast += f"""
        โข ๐๏ธ **ุจุนุฏ {months_ahead} ุดูุฑ ูู {user_city}:** 
           ๐ ููู ูุชููุน: +{safe_num(cumulative_growth, '.1f')}%
           ๐ฐ ูููุฉ ุงููุญูุธุฉ: ุชุชุถุงุนู ร{growth_factor:.2f}
           ๐ฏ ุงููุฑุญูุฉ: {'ุชุฃุณูุณูุฉ' if months_ahead <= 6 else 'ููู' if months_ahead <= 12 else 'ูุถูุฌ'}
            """
        
        forecast += f"""
        
        ๐ฏ **ุงูุงุณุชุฑุงุชูุฌูุฉ ุงูุฒูููุฉ ุงูููุชุฑุญุฉ ูู {user_city}:**
        
        **ุงูุฃุดูุฑ 1-6: ๐ ูุฑุญูุฉ ุงูุชุฃุณูุณ ูุงูุจูุงุก**
        โข ุงูุชุฑููุฒ ุนูู ุงูุตููุงุช ุณุฑูุนุฉ ุงูุชูููุฐ ูู {user_city}
        โข ุจูุงุก ูุงุนุฏุฉ ุงููุญูุธุฉ ุงูุฃุณุงุณูุฉ ูู {user_city}
        โข ุชุญููู ุชูุฒูุน ุฌุบุฑุงูู ูุชูุงุฒู ูู {user_city}
        
        **ุงูุฃุดูุฑ 7-12: ๐ ูุฑุญูุฉ ุงูุชูุณุน ูุงูููู**  
        โข ุงูุฏุฎูู ูู ุงูููุงุทู ุงููุงุดุฆุฉ ูู {user_city}
        โข ุชูููุน ุฃููุงุน ุงูุนูุงุฑุงุช ูู {user_city}
        โข ุชุญููู ุนูุงุฆุฏ ุชุดุบูููุฉ ูู {user_city}
        
        **ุงูุฃุดูุฑ 13-18: ๐ ูุฑุญูุฉ ุงูุชุญุณูู ูุงููุถูุฌ**
        โข ุชุญุณูู ูููู ุงููุญูุธุฉ ูู {user_city}
        โข ุงูุชุฑููุฒ ุนูู ุงูุฌูุฏุฉ ูุงูููุงุกุฉ ูู {user_city}
        โข ุงูุงุณุชุนุฏุงุฏ ูุฏูุฑุงุช ุงูุณูู ุงููุงุฏูุฉ ูู {user_city}

        ๐ก **ุฑุคูุฉ ุงูุฎุจุฑุงุก:**
        "ุงูุงุณุชุซูุงุฑ ุงูุนูุงุฑู ูู {user_city} ูุนุจุฉ ุตุจุฑ ูุงุณุชุฑุงุชูุฌูุฉ. ุงูุฎุทุฉ ุงููุงุถุญุฉ ูุงูุชูููุฐ ุงููุชุณู ููุง ููุชุงุญ ุงููุฌุงุญ ูู ุงูุฃูุฏ ุงููุชูุณุท ูู {user_city}."
        """
        
        return forecast
    
    def _create_7year_investment_plan(self, user_info, market_data, user_city):
        """ุฎุทุฉ ุงุณุชุซูุงุฑูุฉ 7 ุณููุงุช ุงุณุชุฑุงุชูุฌูุฉ"""
        city_insight = self._get_city_insight(user_city)
        
        plan = f"""
        ๐๏ธ **ุฎุทุฉ ุงูุงุณุชุซูุงุฑ ุงูุงุณุชุฑุงุชูุฌูุฉ 7 ุณููุงุช - ุงูุฑุคูุฉ ุงูุดุงููุฉ ูู {user_city}:**

        ๐ **ุงููุฑุงุญู ุงูุงุณุชุฑุงุชูุฌูุฉ ูุงูุฃูุฏุงู:**

        **๐๏ธ ุงูุณูุฉ 1-2: ูุฑุญูุฉ ุงูุชุฃุณูุณ ูุงูุจูุงุก**
        โข ๐ฏ **ุงููุฏู:** ุจูุงุก ูุญูุธุฉ ุฃุณุงุณูุฉ ูููุฉ ูู {user_city}
        โข ๐ **ุงููุคุดุฑุงุช:** ุชุญููู ุนูุงุฆุฏ 6-8% ุณูููุงู ูู {user_city}
        โข ๐ผ **ุงูุงุณุชุฑุงุชูุฌูุฉ:** ุงูุชุฑููุฒ ุนูู ุงูุนูุงุฑุงุช ุฐุงุช ุงูุฏุฎู ุงูุชุฃุฌูุฑู ุงููุณุชูุฑ ูู {user_city}
        โข ๐ **ุงูุฅุฌุฑุงุกุงุช:** 
           - ุฏุฑุงุณุฉ ุณูู {user_city} ุจุนูู
           - ุจูุงุก ุดุจูุฉ ุงูุนูุงูุงุช ุงูููููุฉ ูู {user_city}
           - ุงูุชุนูู ูู ุชุฌุงุฑุจ ุงูุณูู ุงูุฃููู ูู {user_city}

        **๐ ุงูุณูุฉ 3-4: ูุฑุญูุฉ ุงูุชูุณุน ูุงูุชูููุน**  
        โข ๐ฏ **ุงููุฏู:** ุชูููุน ุงููุญูุธุฉ ูุฒูุงุฏุฉ ุงูุนูุงุฆุฏ ูู {user_city}
        โข ๐ **ุงููุคุดุฑุงุช:** ุชุญููู ุนูุงุฆุฏ 8-12% ุณูููุงู ูู {user_city}
        โข ๐ผ **ุงูุงุณุชุฑุงุชูุฌูุฉ:** ุงูุฏุฎูู ูู ูุดุงุฑูุน ุงูุชุทููุฑ ูุงูุนูุงุฑุงุช ุงููุชุฎุตุตุฉ ูู {user_city}
        โข ๐ **ุงูุฅุฌุฑุงุกุงุช:**
           - ุงูุงุณุชูุงุฏุฉ ูู ุงูุฑุงูุนุฉ ุงููุงููุฉ ุงูุฐููุฉ ูู {user_city}
           - ุงูุฏุฎูู ูู ุดุฑุงูุงุช ุงุณุชุฑุงุชูุฌูุฉ ูู {user_city}
           - ุชุทููุฑ ููุงุฑุงุช ุฅุฏุงุฑุฉ ุงููุดุงุฑูุน ูู {user_city}

        **๐ ุงูุณูุฉ 5-7: ูุฑุญูุฉ ุงููุถูุฌ ูุงูุชุญุณูู**
        โข ๐ฏ **ุงููุฏู:** ุชุญุณูู ุฃุฏุงุก ุงููุญูุธุฉ ูุงูุงุณุชุนุฏุงุฏ ูููุฑุญูุฉ ุงูุชุงููุฉ ูู {user_city}
        โข ๐ **ุงููุคุดุฑุงุช:** ุชุญููู ุนูุงุฆุฏ 10-15% ุณูููุงู ูู {user_city}
        โข ๐ผ **ุงูุงุณุชุฑุงุชูุฌูุฉ:** ุงูุชุฑููุฒ ุนูู ุงูุฌูุฏุฉ ูุงูููุงุกุฉ ุงูุชุดุบูููุฉ ูู {user_city}
        โข ๐ **ุงูุฅุฌุฑุงุกุงุช:**
           - ุฅุนุงุฏุฉ ููููุฉ ุงููุญูุธุฉ ุจุงุณุชูุฑุงุฑ ูู {user_city}
           - ุงูุงุณุชุนุฏุงุฏ ูุฏูุฑุงุช ุงูุณูู ุงููุฎุชููุฉ ูู {user_city}
           - ุงูุชุฎุทูุท ููุฎุฑูุฌ ุงูุงุณุชุฑุงุชูุฌู ุฃู ุงูุชูุณุน ูู {user_city}

        ๐ฐ **ุฃูุฏุงู ุงูุฃุฏุงุก ุงูุงุณุชุฑุงุชูุฌูุฉ ูู {user_city}:**
        โข ๐ **ุงูุนูุงุฆุฏ ุงููุณุชูุฏูุฉ:** 8-12% ูุชูุณุท ุณููู
        โข ๐ **ูุนุฏู ุงูููู:** 15-20% ููู ุณููู ูู ูููุฉ ุงููุญูุธุฉ
        โข ๐บ๏ธ **ุงูุชูุฒูุน ุงูุฌุบุฑุงูู:** ุงูุชูุงุฌุฏ ูู 3-5 ููุงุทู ุงุณุชุฑุงุชูุฌูุฉ ูู {user_city}
        โข โ๏ธ **ุงูุชูุงุฒู ุงููุงูู:** ุชุญููู ูุณุจุฉ ูุฏููููุฉ ูุซุงููุฉ 50-60%

        ๐ **ูุตูุญุฉ ุงูุฎุจุฑุงุก:**
        "ุงูุฎุทุฉ ุงูุณุจุนูุฉ ูู {user_city} ููุณุช ูุฌุฑุฏ ุฃุฑูุงูุ ุจู ูู ุฑุญูุฉ ุชุญูู ุงุณุชุฑุงุชูุฌู ุชูุชูู ุจู ูู ูุณุชุซูุฑ ุฅูู ูุงูู ูุญูุธุฉ ุนูุงุฑูุฉ ูุญุชุฑู ูู {user_city}."
        """
        
        return plan

    def _create_risk_management_plan(self, real_data, user_city):
        """ุฎุทุฉ ุฅุฏุงุฑุฉ ุงููุฎุงุทุฑ ุงููุชูุฏูุฉ"""
        return f"""
        ๐ก๏ธ **ุฎุทุฉ ุฅุฏุงุฑุฉ ุงููุฎุงุทุฑ ุงููุชูุฏูุฉ ูู {user_city}:**
        
        ๐ **ุชุญููู ุงููุฎุงุทุฑ ูู {user_city}:**
        โข **ุงููุฎุงุทุฑ ุงูุณูููุฉ:** ุชููุจุงุช ุฃุณุนุงุฑ ุงูุนูุงุฑุงุช ูู {user_city}
        โข **ูุฎุงุทุฑ ุงูุณูููุฉ:** ุตุนูุจุฉ ุงูุจูุน ุงูุณุฑูุน ูู {user_city}
        โข **ูุฎุงุทุฑ ุงูุงุฆุชูุงู:** ุชุบูุฑ ุฃุณุนุงุฑ ุงููุงุฆุฏุฉ
        โข **ูุฎุงุทุฑ ุงูุชุดุบูู:** ุฅุฏุงุฑุฉ ุงูููุชููุงุช ูู {user_city}
        
        ๐ฏ **ุงุณุชุฑุงุชูุฌูุงุช ุงูุชุฎููู:**
        โข ุงูุชูููุน ุงูุฌุบุฑุงูู ุฏุงุฎู {user_city}
        โข ุงูุงุญุชูุงุธ ุจุณูููุฉ ุทุงุฑุฆุฉ
        โข ุชุญูุท ุถุฏ ุชููุจุงุช ุงูุฃุณุนุงุฑ ูู {user_city}
        โข ุชุฃููู ุงูููุชููุงุช ูู {user_city}
        """

    def _create_competitor_analysis(self, real_data, user_city):
        """ุชุญููู ุงูููุงูุณูู"""
        return f"""
        ๐ **ุชุญููู ุงูููุงูุณูู ูู {user_city}:**
        
        ๐ **ููุงุฑูุฉ ุงูุฃุฏุงุก:**
        โข ูุชูุณุท ุงูุฃุณุนุงุฑ ูู {user_city}: {safe_num(real_data['ุงูุณุนุฑ'].mean()) if not real_data.empty else 'N/A'}
        โข ูุซุงูุฉ ุงูููุงูุณุฉ: {real_data['ุงูููุทูุฉ'].nunique() if not real_data.empty else 'N/A'} ููุทูุฉ
        โข ุญุตุฉ ุงูุณูู ุงููุณุชูุฏูุฉ ูู {user_city}
        """

    def _create_international_comparison(self, user_city):
        """ููุงุฑูุฉ ุฏูููุฉ"""
        return f"""
        ๐ **ุงูููุงุฑูุฉ ุงูุฏูููุฉ ูู {user_city}:**
        
        ๐ **ููุงุฑูุฉ ูุน ุงูุฃุณูุงู ุงูุนุงูููุฉ:**
        โข {user_city} vs ุฏุจู: ุชุญููู ุงูุชูุงูุณูุฉ
        โข {user_city} vs ุงูุฑูุงุถ: ููุงุฑูุฉ ุงูุฃุฏุงุก
        โข ูุคุดุฑุงุช ุงูููู ุงูุนุงูููุฉ
        """

    def _create_advanced_analytics(self, real_data, user_city):
        """ุงูุชุญูููุงุช ุงููุชูุฏูุฉ"""
        return f"""
        ๐ **ุงูุชุญูููุงุช ุงููุชูุฏูุฉ ูู {user_city}:**
        
        ๐ฎ **ููุฐุฌุฉ ุงูุจูุงูุงุช:**
        โข ุชุญููู ุงูุงูุญุฏุงุฑ ููุนูุงุฆุฏ ูู {user_city}
        โข ููุงุฐุฌ ุงูุชูุจุค ุจุงูุฃุณุนุงุฑ ูู {user_city}
        โข ุชุญููู ุงูุณูุงุณู ุงูุฒูููุฉ ูู {user_city}
        """

    def _create_financing_comparison(self, user_city):
        """ููุงุฑูุฉ ุงูุชูููู"""
        return f"""
        ๐ฐ **ููุงุฑูุฉ ุฎูุงุฑุงุช ุงูุชูููู ูู {user_city}:**
        
        ๐ฆ **ุงูููุงุฑูุฉ ุงูุดุงููุฉ:**
        โข ุงูุจููู ุงููุญููุฉ ูู {user_city}
        โข ุดุฑูุงุช ุงูุชูููู ูู {user_city}
        โข ุงูููุงุฑูุฉ ูุน ุงูุฃุณูุงู ุงูุฃุฎุฑู
        """

    # ุฏูุงู ุงููุฆุงุช ุงูุฃุฎุฑู ูุน ุงููุญุชูู ุงูููุณุน...
    def _property_owner_report(self, user_info, market_data, real_data, package_level):
        """ุชูุฑูุฑ ูุงูู ุงูุนูุงุฑ - ูุฑูุฒ ุนูู ุชูููู ุงููููุฉ ูุงูุจูุน"""
        user_city = user_info.get('city', 'ุงููุฏููุฉ ุงููุณุชูุฏูุฉ')
        city_insight = self._get_city_insight(user_city)
        
        report_content = {
            "title": f"ุชูุฑูุฑ ูุงูู ุงูุนูุงุฑ ุงููุชูุฏู - ุงุณุชุฑุงุชูุฌูุงุช ุชุนุธูู ุงููููุฉ ูู {user_city}",
            "sections": []
        }
        
        # ๐ ุชูููู ุงููููุฉ ุงูุญุงููุฉ
        valuation = self._property_valuation(real_data, user_info)
        report_content["sections"].append({
            "title": "๐ฐ ุชูููู ูููุฉ ุงูุนูุงุฑ ุงููุชูุฏู",
            "content": valuation
        })
        
        # โฐ ุชูููุช ุงูุจูุน ุงูุฃูุซู
        timing_analysis = self._optimal_selling_timing(market_data, user_city)
        report_content["sections"].append({
            "title": "โฐ ุงูุชูููุช ุงูุฃูุซู ููุจูุน ุงููุชูุฏู",
            "content": timing_analysis
        })
        
        # ๐ ุชุญุณูู ุงููููุฉ
        value_improvement = self._value_improvement_tips(user_info, real_data)
        report_content["sections"].append({
            "title": "๐ง ุฎุทุฉ ุชุญุณูู ุงููููุฉ ุงููุชูุฏูุฉ",
            "content": value_improvement
        })
        
        return self._format_report(report_content, package_level, "ูุงูู ุนูุงุฑ", user_city)
    
    # ๐ ุงููุญุชูู ุงูููุณุน ููุงูู ุงูุนูุงุฑ
    def _extended_owner_content(self, user_info, market_data, real_data, package_level, target_pages):
        """ูุญุชูู ููุณุน ููุงูู ุงูุนูุงุฑ"""
        user_city = user_info.get('city', 'ุงููุฏููุฉ ุงููุณุชูุฏูุฉ')
        extended_sections = []
        
        extended_sections.extend([
            self._create_property_comparison(real_data, user_info),
            self._create_market_timing_analysis(market_data, user_city),
            self._create_value_enhancement_plan(user_info, user_city)
        ])
        
        if package_level in ["ูุถูุฉ", "ุฐูุจูุฉ", "ูุงุณูุฉ"]:
            extended_sections.extend([
                self._create_sales_strategy(user_city),
                self._create_tax_optimization(user_city)
            ])
        
        # ุชูุณูู ุงููุญุชูู ุงูููุณุน
        extended_content = "\n\n" + "="*80 + "\n"
        extended_content += f"๐ ุงููุญุชูู ุงูุชุญูููู ุงูููุณุน - Warda Intelligence - {user_city}\n"
        extended_content += "="*80 + "\n\n"
        
        for section in extended_sections:
            extended_content += section + "\n\n" + "-"*50 + "\n\n"
        
        return extended_content
    
    def _create_property_comparison(self, real_data, user_info):
        """ููุงุฑูุฉ ุงูุนูุงุฑ ูุน ุงูููุงูุณูู ุงููุชูุฏูุฉ"""
        user_city = user_info.get('city', 'ุงููุฏููุฉ ุงููุณุชูุฏูุฉ')
        if real_data.empty:
            return f"๐ **ููุงุฑูุฉ ุงูุนูุงุฑ ุงููุชูุฏูุฉ ูู {user_city}:**\nุฌุงุฑู ุชุทููุฑ ููุงุฐุฌ ุงูููุงุฑูุฉ ุงููุชูุฏูุฉ."
        
        user_type = user_info.get('property_type', 'ุดูุฉ')
        
        comparable = real_data[
            (real_data['ุงููุฏููุฉ'] == user_city) & 
            (real_data['ููุน_ุงูุนูุงุฑ'] == user_type)
        ]
        
        if not comparable.empty:
            avg_price = comparable['ุงูุณุนุฑ'].mean()
            avg_psm = comparable['ุณุนุฑ_ุงููุชุฑ'].mean() if 'ุณุนุฑ_ุงููุชุฑ' in comparable.columns else avg_price / comparable['ุงููุณุงุญุฉ'].mean()
            price_range = comparable['ุงูุณุนุฑ'].max() - comparable['ุงูุณุนุฑ'].min()
            
            comparison = f"""
        ๐ **ููุงุฑูุฉ ุงูุนูุงุฑ ุงููุชูุฏูุฉ ูุน ุงูููุงูุณูู ูู {user_city}:**

        ๐๏ธ **ุชุญููู ุงูุณูู ุงููุญูู ({user_city} - {user_type}):**
        โข ๐ฐ **ุงููุชูุณุท ุงูุณุนุฑู:** {safe_num(avg_price)} ุฑูุงู
        - ููุซู ููุทุฉ ุงูุชูุงุฒู ูู ุณูู {user_city} ุงูุญุงูู
        
        โข ๐ **ุณุนุฑ ุงููุชุฑ ุงููุฑุจุน:** {safe_num(avg_psm)} ุฑูุงู/ูยฒ
        - ูุนูุงุฑ ุฏููู ููููุงุฑูุฉ ุจูู ุงูุนูุงุฑุงุช ูู {user_city}
        
        โข ๐๏ธ **ุญุฌู ุงูููุงูุณุฉ:** {len(comparable)} ุนูุงุฑ ูุดุงุจู
        - ูุดูุฑ ุฅูู ูุณุชูู ุงูููุงูุณุฉ ูู ุณูู {user_city}

        ๐ **ูุคุดุฑุงุช ุงูุชูุงูุณูุฉ ูุงูุณูู ูู {user_city}:**
        โข ๐ **ูุทุงู ุงูุฃุณุนุงุฑ:** {safe_num(comparable['ุงูุณุนุฑ'].min())} - {safe_num(comparable['ุงูุณุนุฑ'].max())} ุฑูุงู
        - ููุถุญ ูุฏู ุชุจุงูู ุงูููู ุงูุณูููุฉ ูู {user_city}
        
        โข ๐บ๏ธ **ุงูุชูุฒูุน ุงูุฌุบุฑุงูู:** {comparable['ุงูููุทูุฉ'].nunique()} ููุทูุฉ ูุฎุชููุฉ
        - ูุนูุณ ุชููุน ุงูุฎูุงุฑุงุช ุงููุชุงุญุฉ ูู {user_city}
        
        โข ๐น **ูุนุฏู ุงูุชุจุงูู ุงูุณุนุฑู:** {safe_num(price_range/avg_price*100, '.1f')}%
        - ูุคุดุฑ ููุฑููุฉ ุงูุฃุณุนุงุฑ ููุฑุต ุงูุชูุงูุถ ูู {user_city}

        ๐ก **ุชุญููู ุงูููุฒุฉ ุงูุชูุงูุณูุฉ ูู {user_city}:**
        "ุงูุนูุงุฑุงุช ูู ุงููุทุงู {safe_num(avg_price * 0.9)} - {safe_num(avg_price * 1.1)} ุฑูุงู 
        ุชูุซู ุงููููุฉ ุงููุซูู ุจูู ุงูุณุนุฑ ูุงูุฌูุฏุฉ ูู ุณูู {user_city} ุงูุญุงูู."
            """
        else:
            comparison = f"๐ **ููุงุฑูุฉ ุงูุนูุงุฑ ุงููุชูุฏูุฉ ูู {user_city}:**\nูุง ุชูุฌุฏ ุนูุงุฑุงุช ูุดุงุจูุฉ ูุงููุฉ ูุฅุฌุฑุงุก ููุงุฑูุฉ ุฏูููุฉ."

        return comparison

    # ุฏูุงู ุงููุฆุงุช ุงูุฃุฎุฑู ุชุจูู ููุง ูู ูุน ุชุญุณููุงุช ุงููุบุฉ...
    def _individual_report(self, user_info, market_data, real_data, package_level):
        """ุชูุฑูุฑ ุงููุฑุฏ - ูุฑูุฒ ุนูู ุงูุณูู ูุงูุชูููู"""
        user_city = user_info.get('city', 'ุงููุฏููุฉ ุงููุณุชูุฏูุฉ')
        city_insight = self._get_city_insight(user_city)
        
        report_content = {
            "title": f"ุชูุฑูุฑ ุงูุจุงุญุซ ุนู ุณูู ุงููุชูุฏู - ุงุณุชุฑุงุชูุฌูุงุช ุงูุงุฎุชูุงุฑ ุงูุฐูู ูู {user_city}",
            "sections": []
        }
        
        # ๐ก ููุงุทู ููุงุณุจุฉ ููุณูู
        suitable_areas = self._find_suitable_living_areas(real_data, user_info)
        report_content["sections"].append({
            "title": "๐ก ุชุญููู ุงูููุงุทู ุงูุณูููุฉ ุงููุชูุฏู",
            "content": suitable_areas
        })
        
        # ๐ฐ ุชุญููู ุงูุชูููู
        financing_analysis = self._financing_analysis(user_info, market_data)
        report_content["sections"].append({
            "title": "๐ฐ ุชุญููู ุฎูุงุฑุงุช ุงูุชูููู ุงููุชูุฏู",
            "content": financing_analysis
        })
        
        # ๐ ููุงุฑูุฉ ุงูุฎูุงุฑุงุช
        options_comparison = self._compare_housing_options(real_data)
        report_content["sections"].append({
            "title": "๐ ููุงุฑูุฉ ุงูุฎูุงุฑุงุช ุงูุณูููุฉ ุงููุชูุฏูุฉ",
            "content": options_comparison
        })
        
        return self._format_report(report_content, package_level, "ูุฑุฏ", user_city)
    
    def _extended_individual_content(self, user_info, market_data, real_data, package_level, target_pages):
        """ูุญุชูู ููุณุน ูููุฑุฏ"""
        user_city = user_info.get('city', 'ุงููุฏููุฉ ุงููุณุชูุฏูุฉ')
        extended_sections = [
            self._create_neighborhood_analysis(real_data, user_info),
            self._create_lifestyle_comparison(user_city),
            self._create_future_planning_guide(user_city)
        ]
        
        # ุชูุณูู ุงููุญุชูู ุงูููุณุน
        extended_content = "\n\n" + "="*80 + "\n"
        extended_content += f"๐ ุงููุญุชูู ุงูุชุญูููู ุงูููุณุน - Warda Intelligence - {user_city}\n"
        extended_content += "="*80 + "\n\n"
        
        for section in extended_sections:
            extended_content += section + "\n\n" + "-"*50 + "\n\n"
        
        return extended_content

    # ุฏูุงู ุงููุฆุงุช ุงูุฃุฎุฑู ุชุจูู ููุง ูู...
    def _broker_report(self, user_info, market_data, real_data, package_level):
        """ุชูุฑูุฑ ุงููุณูุท ุงูุนูุงุฑู"""
        user_city = user_info.get('city', 'ุงููุฏููุฉ ุงููุณุชูุฏูุฉ')
        city_insight = self._get_city_insight(user_city)
        
        report_content = {
            "title": f"ุชูุฑูุฑ ุงููุณูุท ุงูุนูุงุฑู ุงููุชูุฏู - ุงุณุชุฑุงุชูุฌูุงุช ุฒูุงุฏุฉ ุงูุตููุงุช ูู {user_city}",
            "sections": []
        }
        
        # ุงููุญุชูู ุงูุฃุณุงุณู ูููุณูุท
        market_analysis = self._analyze_market_for_brokers(market_data, real_data, user_city)
        report_content["sections"].append({
            "title": "๐ ุชุญููู ุงูุณูู ูููุณุทุงุก",
            "content": market_analysis
        })
        
        return self._format_report(report_content, package_level, "ูุณูุท ุนูุงุฑู", user_city)
    
    def _developer_report(self, user_info, market_data, real_data, package_level):
        """ุชูุฑูุฑ ุดุฑูุฉ ุงูุชุทููุฑ"""
        user_city = user_info.get('city', 'ุงููุฏููุฉ ุงููุณุชูุฏูุฉ')
        city_insight = self._get_city_insight(user_city)
        
        report_content = {
            "title": f"ุชูุฑูุฑ ุดุฑูุฉ ุงูุชุทููุฑ ุงููุชูุฏู - ุงุณุชุฑุงุชูุฌูุงุช ุงูุชุทููุฑ ุงูุนูุงุฑู ูู {user_city}",
            "sections": []
        }
        
        development_analysis = self._analyze_development_opportunities(real_data, user_info, user_city)
        report_content["sections"].append({
            "title": "๐๏ธ ุชุญููู ูุฑุต ุงูุชุทููุฑ ุงูุนูุงุฑู",
            "content": development_analysis
        })
        
        return self._format_report(report_content, package_level, "ุดุฑูุฉ ุชุทููุฑ", user_city)
    
    def _opportunity_seeker_report(self, user_info, market_data, real_data, package_level):
        """ุชูุฑูุฑ ุงูุจุงุญุซ ุนู ูุฑุต"""
        user_city = user_info.get('city', 'ุงููุฏููุฉ ุงููุณุชูุฏูุฉ')
        city_insight = self._get_city_insight(user_city)
        
        report_content = {
            "title": f"ุชูุฑูุฑ ุตุงุฆุฏ ุงููุฑุต ุงููุชูุฏู - ุงูุชุดุงู ุงูููู ุงููุฎููุฉ ูู {user_city}",
            "sections": []
        }
        
        opportunity_analysis = self._find_hidden_opportunities(real_data, market_data, user_city)
        report_content["sections"].append({
            "title": "๐ ุงูุชุดุงู ุงููุฑุต ุงูุงุณุชุซูุงุฑูุฉ ุงููุฎููุฉ",
            "content": opportunity_analysis
        })
        
        return self._format_report(report_content, package_level, "ุจุงุญุซ ุนู ูุฑุตุฉ", user_city)
    
    # ุฏูุงู ูุณุงุนุฏุฉ ุฅุถุงููุฉ...
    def _analyze_market_for_brokers(self, market_data, real_data, user_city):
        """ุชุญููู ุงูุณูู ูููุณุทุงุก"""
        return f"๐ **ุชุญููู ุงูุณูู ูููุณุทุงุก ูู {user_city}:**\nุฌุงุฑู ุชุทููุฑ ุชุญูููุงุช ูุชุฎุตุตุฉ ูููุณุทุงุก ุงูุนูุงุฑููู ูู {user_city}."

    def _analyze_development_opportunities(self, real_data, user_info, user_city):
        """ุชุญููู ูุฑุต ุงูุชุทููุฑ"""
        return f"๐๏ธ **ุชุญููู ูุฑุต ุงูุชุทููุฑ ูู {user_city}:**\nุฌุงุฑู ุชุทููุฑ ุฏุฑุงุณุงุช ุงูุฌุฏูู ุงููุชูุฏูุฉ ูุณูู {user_city}."

    def _find_hidden_opportunities(self, real_data, market_data, user_city):
        """ุงูุชุดุงู ุงููุฑุต ุงููุฎููุฉ"""
        return f"๐ **ุงูุชุดุงู ุงููุฑุต ุงููุฎููุฉ ูู {user_city}:**\nุฌุงุฑู ุชุทููุฑ ุฃุฏูุงุช ุงููุดู ุนู ุงูููู ุงููุฎููุฉ ูู ุณูู {user_city}."

    def _create_neighborhood_analysis(self, real_data, user_info):
        """ุชุญููู ุงูุฃุญูุงุก"""
        user_city = user_info.get('city', 'ุงููุฏููุฉ ุงููุณุชูุฏูุฉ')
        return f"๐๏ธ **ุชุญููู ุงูุฃุญูุงุก ูู {user_city}:**\nุฌุงุฑู ุชุทููุฑ ุชุญููู ููุตู ููุฃุญูุงุก ูุงูููุงุทู ูู {user_city}."

    def _create_lifestyle_comparison(self, user_city):
        """ููุงุฑูุฉ ุฃููุงุท ุงูุญูุงุฉ"""
        return f"๐ก **ููุงุฑูุฉ ุฃููุงุท ุงูุญูุงุฉ ูู {user_city}:**\nุชุญููู ูุชูุฏู ูุฃููุงุท ุงูุญูุงุฉ ูุงูุฎุฏูุงุช ูู ูุฎุชูู ุฃุญูุงุก {user_city}."

    def _create_future_planning_guide(self, user_city):
        """ุฏููู ุงูุชุฎุทูุท ุงููุณุชูุจูู"""
        return f"๐ **ุฏููู ุงูุชุฎุทูุท ุงููุณุชูุจูู ูู {user_city}:**\nุงุณุชุฑุงุชูุฌูุงุช ุงูุชุฎุทูุท ุทููู ุงููุฏู ููุงุณุชูุฑุงุฑ ูู {user_city}."

    def _create_market_timing_analysis(self, market_data, user_city):
        """ุชุญููู ุชูููุช ุงูุณูู"""
        return f"โฐ **ุชุญููู ุชูููุช ุงูุณูู ูู {user_city}:**\nุฏุฑุงุณุฉ ุงูุฃููุงุช ุงููุซูู ููุดุฑุงุก ูุงูุจูุน ูู ุณูู {user_city}."

    def _create_value_enhancement_plan(self, user_info, user_city):
        """ุฎุทุฉ ุชุนุฒูุฒ ุงููููุฉ"""
        return f"๐ง **ุฎุทุฉ ุชุนุฒูุฒ ุงููููุฉ ูู {user_city}:**\nุงุณุชุฑุงุชูุฌูุงุช ูุชูุฏูุฉ ูุฒูุงุฏุฉ ูููุฉ ุงูุนูุงุฑ ูู {user_city}."

    def _create_sales_strategy(self, user_city):
        """ุงุณุชุฑุงุชูุฌูุฉ ุงูุจูุน"""
        return f"๐ฐ **ุงุณุชุฑุงุชูุฌูุฉ ุงูุจูุน ูู {user_city}:**\nุฎุทุท ุชุณููู ูุจูุน ูุชูุฏูุฉ ูุนูุงุฑุงุช {user_city}."

    def _create_tax_optimization(self, user_city):
        """ุชุญุณูู ุงูุถุฑุงุฆุจ"""
        return f"๐ **ุชุญุณูู ุงูุถุฑุงุฆุจ ูู {user_city}:**\nุงุณุชุฑุงุชูุฌูุงุช ูุชูุฏูุฉ ูุชุญุณูู ุงูุนุจุก ุงูุถุฑูุจู ูู {user_city}."

    def _format_report(self, report_content, package_level, user_type, user_city):
        """ุชูุณูู ุงูุชูุฑูุฑ ุงูููุงุฆู ูุน ูุนูููุงุช ุงููุฏููุฉ"""
        package_info = self.package_features.get(package_level, self.package_features["ูุฌุงููุฉ"])
        
        formatted_report = f"""
        ๐ฏ **{report_content['title']}**
        
        ๐ค **ุงููุฆุฉ ุงููุณุชูุฏูุฉ:** {user_type}
        ๐๏ธ **ุงููุฏููุฉ:** {user_city}
        ๐ **ูุณุชูู ุงูุจุงูุฉ:** {package_level}
        ๐ **ุนุฏุฏ ุงูุตูุญุงุช ุงูุชุญููููุฉ:** {package_info['pages']} ุตูุญุฉ
        ๐ **ุนุฏุฏ ุงูุฑุณูู ุงูุจูุงููุฉ:** {package_info['charts']} ุฑุณู ุจูุงูู
        ๐ **ุนูู ุงูุชุญููู:** {package_info['analysis_depth']}
        
        {'='*60}
        ๐ **ููุฎุต ุงูุชูููุฐู:**
        ุชู ุฅุนุฏุงุฏ ูุฐุง ุงูุชูุฑูุฑ ุงููุชุฎุตุต ุฎุตูุตุงู ููุฆุฉ {user_type} ูู {user_city} ูุชูููุฑ ุฑุคูุฉ ุดุงููุฉ 
        ูุงุณุชุฑุงุชูุฌูุงุช ุนูููุฉ ูุชุญููู ุงูุฃูุฏุงู ุงูุนูุงุฑูุฉ ุงููุทููุจุฉ ูู {user_city}.
        {'='*60}
        """
        
        for section in report_content['sections']:
            formatted_report += f"""
        {section['title']}
        {'-'*40}
        {section['content']}
        
        """
        
        formatted_report += f"""
        {'='*60}
        ๐ **ุชุงุฑูุฎ ุงูุฅูุดุงุก:** {datetime.now().strftime('%Y-%m-%d %H:%M')}
        ๐ข **Warda Intelligence** - ุดุฑููู ูู ุงููุฑุงุฑุงุช ุงูุนูุงุฑูุฉ ุงูุฐููุฉ ูู {user_city}
        ๐ **ููุงุณุชูุณุงุฑุงุช:** +966 500 000 000
        ๐ **ุงููููุน:** www.warda-intelligence.com
        
        ๐ฏ **ุงูุฎุชุงู:**
        "ูุคูู ูู Warda Intelligence ุจุฃู ุงูุจูุงูุงุช ุชุญูู ูุตุฉุ ูุงูุฎุจุฑุงุก ูุชุฑุฌููููุง ุฅูู ูุฑุต. 
        ุงุณุชุซูุฑ ูู ูุนุฑูุชู ุงูููู ูุชุจูู ูุณุชูุจูู ุงูุบุฏ ูู {user_city}."
        """
        
        return formatted_report

# ุงุฎุชุจุงุฑ ุงููุธุงู ุงููุญุฏุซ
if __name__ == "__main__":
    smart_system = SmartReportSystem()
    
    # ุจูุงูุงุช ุชุฌุฑูุจูุฉ
    sample_user = {
        "user_type": "ูุณุชุซูุฑ",
        "city": "ุงูุฑูุงุถ", 
        "property_type": "ุดูุฉ",
        "area": 120
    }
    
    sample_market = {
        "ูุนุฏู_ุงูููู_ุงูุดูุฑู": 2.5,
        "ุงูุนุงุฆุฏ_ุงูุชุฃุฌูุฑู": 7.8,
        "ูุคุดุฑ_ุงูุณูููุฉ": 85,
        "ุฃุณุนุงุฑ_ุงูุชูููู": {'ุจููู': 4.5, 'ุตูุฏูู': 3.5, 'ุฅุณูุงูู': 4.2}
    }
    
    sample_data = pd.DataFrame({
        'ุงูุนูุงุฑ': ['ุดูุฉ ุงููุฎูู', 'ูููุง ุงูุฑุจูุฉ', 'ุดูุฉ ุงูุนููุง', 'ุดูุฉ ุงูููู ููุฏ', 'ูููุง ุงูุนุฑูุจุฉ'],
        'ุงููุฏููุฉ': ['ุงูุฑูุงุถ', 'ุงูุฑูุงุถ', 'ุงูุฑูุงุถ', 'ุงูุฑูุงุถ', 'ุงูุฑูุงุถ'],
        'ุงูููุทูุฉ': ['ุงููุฎูู', 'ุงูุฑุจูุฉ', 'ุงูุนููุง', 'ุงูููู ููุฏ', 'ุงูุนุฑูุจุฉ'],
        'ููุน_ุงูุนูุงุฑ': ['ุดูุฉ', 'ูููุง', 'ุดูุฉ', 'ุดูุฉ', 'ูููุง'],
        'ุงูุณุนุฑ': [850000, 2500000, 920000, 780000, 2200000],
        'ุงููุณุงุญุฉ': [120, 350, 110, 100, 320],
        'ุณุนุฑ_ุงููุชุฑ': [7083, 7142, 8363, 7800, 6875],
        'ุงูุนุงุฆุฏ_ุงููุชููุน': [8.5, 6.2, 9.1, 7.8, 5.9],
        'ูุณุชูู_ุงูุฎุทูุฑุฉ': ['ููุฎูุถ', 'ูุชูุณุท', 'ููุฎูุถ', 'ููุฎูุถ', 'ูุฑุชูุน']
    })
    
    # ุงุฎุชุจุงุฑ ุงูุชูุฑูุฑ ุงูููุณุน
    extended_report = smart_system.generate_extended_report(sample_user, sample_market, sample_data, "ุฐูุจูุฉ")
    print("โ ุชู ุฅูุดุงุก ุงูุชูุฑูุฑ ุงูุฐูู ุงูููุณุน ุจูุฌุงุญ!")
    print(f"๐ ุทูู ุงูุชูุฑูุฑ: {len(extended_report)} ุญุฑู")
    print(extended_report[:1500] + "...")  # ุนุฑุถ ุฌุฒุก ูู ุงูุชูุฑูุฑ
