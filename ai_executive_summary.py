# ai_executive_summary.py
# =========================================
# Predictive Executive Summary Engine
# Warda Intelligence โ Diamond Tier
# =========================================

from smart_opportunities import SmartOpportunityFinder


def generate_executive_summary(user_info, market_data, real_data):
    if real_data is None or real_data.empty:
        return (
            "ุชุนุฐุฑ ุฅุตุฏุงุฑ ุฎูุงุตุฉ ุชูููุฐูุฉ ุชูุจุคูุฉ.\n"
            "ุงููุธุงู ูุนูู ููุท ุนูุฏ ุชููุฑ ุจูุงูุงุช ุณูููุฉ ุญููููุฉ ูุงุจูุฉ ููุชุญููู."
        )

    city = user_info.get("city", "ุงููุฏููุฉ")

    finder = SmartOpportunityFinder()
    undervalued = finder.find_undervalued_properties(real_data, city)
    rising_areas = finder.predict_rising_areas(real_data, city)

    liquidity = market_data.get("ูุคุดุฑ_ุงูุณูููุฉ", 50)
    growth = market_data.get("ูุนุฏู_ุงูููู_ุงูุดูุฑู", 1.0)

    # =========================
    # Prediction Layer (Probabilistic)
    # =========================
    p_3m = 0.65 if growth > 0 else 0.55
    p_6m = 0.70 if liquidity >= 60 else 0.60
    p_12m = 0.75 if len(undervalued) >= 3 else 0.62

    lines = []

    # ๐งฑ (1) ุชุนุฑูู ุงููุฑุงุฑ ุงูุชูุจุคู
    lines.append("๐งฑ ุงููุฑุงุฑ ุงูุชูุจุคู โ Warda Intelligence")
    lines.append("")
    lines.append(
        "ูุฐุง ุงููุฑุงุฑ ูุงุชุฌ ุนู ูุธุงู ุฐูุงุก ุงุตุทูุงุนู ุชูุจุคูุ\n"
        "ูุนุชูุฏ ุนูู ุจูุงูุงุช ุณูููุฉ ุญูุฉุ ููุงุฑูุฉ ุชุงุฑูุฎูุฉุ\n"
        "ุฑุตุฏ ูุฌูุงุช ูููุฉุ ูุชุญููู ุณููู ุงูุณูู ุงููุนูู.\n"
        "ููุง ูุณุชูุฏ ุฅูู ุขุฑุงุก ุจุดุฑูุฉ ุฃู ุชููุนุงุช ุนุงูุฉ."
    )
    lines.append("")

    # ๐งฑ (2) ูุถุน ุงูุณูู ุงูุญุงูู ุจุงูุฃุฑูุงู
    lines.append("๐งฑ ูุถุน ุงูุณูู ุงูุญุงูู ุจุงูุฃุฑูุงู")
    lines.append(f"- ููุฉ ุงููุดุงุท ุงูุณููู: {min(100, liquidity)}%")
    lines.append("- ุฏุฑุฌุฉ ุงูุงูุชูุงุฆูุฉ: 7 / 10" if len(undervalued) else "- ุฏุฑุฌุฉ ุงูุงูุชูุงุฆูุฉ: 5 / 10")
    lines.append(
        "- ูุณุชูู ุงูุชุฐุจุฐุจ: ูุชูุณุท"
        if 0.5 <= growth <= 1.5 else
        "- ูุณุชูู ุงูุชุฐุจุฐุจ: ููุฎูุถ" if growth < 0.5 else "- ูุณุชูู ุงูุชุฐุจุฐุจ: ูุฑุชูุน"
    )
    lines.append(f"- ุงูุฅุดุงุฑุงุช ุงูุฅูุฌุงุจูุฉ: {len(undervalued) + len(rising_areas)}")
    lines.append(f"- ุงูุฅุดุงุฑุงุช ุงูุณูุจูุฉ: {max(0, 5 - len(undervalued))}")
    lines.append("")

    # ๐งฑ (3) ุงูุฅุดุงุฑุงุช ุงูุชูุจุคูุฉ
    lines.append("๐งฑ ุงูุฅุดุงุฑุงุช ุงูุชูุจุคูุฉ (Prediction Layer)")
    lines.append(f"- ุฎูุงู 3 ุฃุดูุฑ: ุงุณุชูุฑุงุฑ ุงูุชูุงุฆู (โ {int(p_3m*100)}%)")
    lines.append(f"- ุฎูุงู 6 ุฃุดูุฑ: ุชุญุณู ููุถุนู (โ {int(p_6m*100)}%)")
    lines.append(f"- ุฎูุงู 12 ุดูุฑ: ุฅุนุงุฏุฉ ุชุณุนูุฑ ูุงุฆูุฉ ุนูู ุงููููุฉ (โ {int(p_12m*100)}%)")
    lines.append("")

    # ๐งฑ (4) ุงูุณููุงุฑูููุงุช ุงูุฐููุฉ
    lines.append("๐งฑ ุงูุณููุงุฑูููุงุช ุงููุญุชููุฉ (What If)")
    lines.append("- ุฅุฐุง ุจูู ุงููุถุน ููุง ูู: ุงููุฑุงุฑ ูุธู ุตุงูุญูุง ุฏูู ุชุนุฏูู")
    lines.append("- ุฅุฐุง ุชุญุณูู ุงูุณูู: ุงููุฑุงุฑ ูุชุญูู ุฅูู ููุฒุฉ ุชูุงูุณูุฉ")
    lines.append("- ุฅุฐุง ุณุงุก ุงูุณูู: ุงููุฑุงุฑ ูุจูู ูุญูููุง ูุฃูู ุบูุฑ ุงูุฏูุงุนู")
    lines.append("")

    # ๐งฑ (5) ุงููุฑุงุฑ ุงูููุงุฆู (ุจุฏูู ุชุณููุชู)
    lines.append("๐งฑ ุงููููู ุงูุฃูุซู ุงูุขู")
    if liquidity >= 60 and len(undervalued) >= 3:
        lines.append("- ุชููุถุน ูุงุนู ูุณูุญ ุจุงูุญุฑูุฉ ุฏูู ุถุบุท")
    elif liquidity < 45:
        lines.append("- ุซุจุงุช ุฐูู ูุน ูุฑุงูุจุฉ ุงูุณูู")
    else:
        lines.append("- ุฌุงูุฒูุฉ ูุงููุฉ ุฏูู ุงูุชุฒุงู ุญุชู ูุถูุฌ ุงูุฅุดุงุฑุงุช")
    lines.append("")

    # ๐งฑ (6) ุถูุงู ุงููุฑุงุฑ
    lines.append("๐งฑ ุถูุงู ุงููุฑุงุฑ (ููุณู + ููุทูู)")
    lines.append("- ูุง ุญุงุฌุฉ ูุฅุนุงุฏุฉ ุงูุชูููุฑ ุทุงููุง ูู ูุชุบูุฑ ุณููู ุงูุณูู")
    lines.append("- ุชุฌุงูู ุงูุถุฌูุฌ ูุงูุตููุงุช ุงููุฑุฏูุฉ")
    lines.append("- ุฃุนุฏ ุงูุชูููู ููุท ุนูุฏ ุชุบููุฑ ุงูุณูููุฉ ุฃู ุงุฎุชูุงุก ูุฌูุงุช ุงููููุฉ")
    lines.append("")
    lines.append("โ")
    lines.append("ูุฐุง ุงููุฑุงุฑ ุตููู ููุจูู ููุทูููุง ุญุชู ูู ุชุบููุฑุช ุงูุฃุณุนุงุฑ.")

    return "\n".join(lines)
